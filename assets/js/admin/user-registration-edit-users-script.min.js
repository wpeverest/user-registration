function ur_includes(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r+=1)if(e[r]===t)return!0;return!1}jQuery(function(e){if(UR_Snackbar)var t=new UR_Snackbar;var r=urUsersl10n,a=[],i=r.form_required_fields,s={init:function(){s.initUIBindings(),s.switchCountry(),e("#user-registration-edit-user-body  #user_registration_user_pass").length>0&&this.hide_password_input(),e(".ur-masked-input").inputmask("mask")||e(".ur-masked-input").inputmask()},switchCountry:function(){e(document).on("change",".ur-field-address-country",function(t){t.stopPropagation(),t.preventDefault();var r=e(this),a=r.data("id"),i=r.val();if(r.data("state-enabled")){var s={action:"user_registration_update_state_field",security:user_registration_params.user_registration_update_state_field,country:i},n=r.siblings(".ur-field-address-state-outer-wrapper");e.ajax({type:"POST",url:user_registration_params.ajax_url,data:s,beforeSend:function(){n.empty(),n.append('<span class="ur-front-spinner"></span>')},success:function(t){var r="";t.success&&t.data.has_state&&""!==t.data.state?(r+='<select class="ur-field-address-state select ur-frontend-field" name="'+a+'_state">',r+=t.data.state,r+="</select>"):r+='<input type="text" class="ur-field-address-state input-text ur-frontend-field" name="'+a+'_state"/>',e(document).find(".ur-front-spinner").remove();var i=e(r);n.append(i)}})}})},hide_password_input:function(){e("#user_registration_user_pass_field input").hide();var t='<button type="button" class="button btn-primary set-new-pass-btn">'+r.edit_user_set_new_password+"</button>";e("#user-registration-edit-user-body  .field-user_pass .input-wrapper").append(t)},toggle_password_input_visibility:function(){e("#user_registration_user_pass_field input").val("").show(),e(".set-new-pass-btn").hide();e("#user_registration_user_pass_field .password-input-group").append('<div class="hide-show-password"><span class="dashicons dashicons-visibility hide-show-btn"></span></div>')},toggle_edit_form_visibility:function(t){t?(e(".urm-admin-edit-user").removeClass("user-registration-hidden"),e(".urm-admin-view-user").addClass("user-registration-hidden")):(e(".urm-admin-edit-user").addClass("user-registration-hidden"),e(".urm-admin-view-user").removeClass("user-registration-hidden"))},show_success_message:function(r){return!(!t||!r)&&(e.isArray(r)?r.forEach(function(e){Object.keys(e).forEach(function(r){"string"==typeof e[r]&&t.add({type:"success",message:e[r],duration:5,icon:"exclamation"})})}):t.add({type:"success",message:r,duration:5,icon:"exclamation"}),!0)},show_failure_message:function(r){return!(!t||!r)&&(e.isArray(r)?r.forEach(function(e){Object.keys(e).forEach(function(r){"string"==typeof e[r]&&t.add({type:"failure",message:e[r],duration:6})})}):t.add({type:"failure",message:r,duration:6}),!0)},initUIBindings:function(){e(".save_user_details").on("click",function(t){var r=e(this);s.edit_profile_event(r),r.submit()}),e(document).on("click",".hide-show-btn",function(t){t.preventDefault(),t.stopPropagation();var r=e("#user_registration_user_pass");e(this).toggleClass("dashicons-visibility dashicons-hidden"),r.prop("type",function(e,t){return"password"===t?"text":"password"})}),e(document).on("click",".set-new-pass-btn",function(){s.toggle_password_input_visibility()}),e(document).on("click","#user-registration-edit-user-link",function(e){e.preventDefault(),s.toggle_edit_form_visibility(!0)})},get_fieldwise_data:function(t){var r={},s=t.get(0).tagName.toLowerCase(),n="undefined"!==t.attr("name")?t.attr("name"):"null",o=[];void 0!==t.attr("name")&&""!==t.attr("name")?(r.field_name=t.attr("name"),r.field_name=r.field_name.replace("[]",""),e(t).closest(".ur-repeater-row").length>0&&(e(t).closest(".field-multi_select2").length>0&&(r.field_name=r.field_name.slice(0,-2)),e(t).closest(".field-file").length>0&&(r.field_name=e(t).closest(".field-file").attr("data-ref-id")))):r.field_name="",e(".field-phone, .field-billing_phone").each(function(){var t=e(this).find(".form-row").attr("id");e(this).find(".form-row").find("#"+t).hasClass("ur-smart-phone-field")&&o.push(e(this).find(".form-row").attr("id"))});var l="undefined"!==t.attr("type")?t.attr("type"):"null",d=t.get(0).className.split(" ")[0];switch(r.value="",s){case"input":var u=new Array;switch(l){case"checkbox":!t.closest(".field-privacy_policy").length>0?t.prop("checked")?(u.push(t.val()),r.value=JSON.stringify(u)):r.value="":(r.value=t.prop("checked")?t.val():"",r.field_name=t.closest(".field-privacy_policy").data("ref-id"));break;case"radio":r.value=t.prop("checked")?t.val():"",r.field_name=t.closest(".field-privacy_policy").data("ref-id");break;default:r.value=t.val()}ur_includes(o,n)&&(r.value=t.siblings('input[type="hidden"]').val());break;case"select":r.value=t.val();break;case"textarea":if("wysiwyg"===d)tinyMCE.triggerSave(),r.value=t.val();else r.value=t.val()}return e(document).trigger("user_registration_frontend_form_data_render",[t,r]),r.field_type="undefined"!==t.eq(0).attr("type")?t.eq(0).attr("type"):"null","hidden"===t.attr("data-field-type")&&(r.field_type=l),void 0!==t.attr("data-label")?r.label=t.attr("data-label"):t.prev().length&&"label"===t.prev().get(0).tagName.toLowerCase()?r.label=t.prev().text():r.label=r.field_type,e.inArray(r.field_name,i.join(",").trim())>=0&&a.push(r.field_name),r},get_form_data:function(t){var a=e("form.user-registration-EditProfileForm");if(t===a.closest(".ur-frontend-form").attr("id")||e(".ur-frontend-form").find("form.edit-profile").hasClass("user-registration-EditProfileForm")){var i=this,n=[],o=s.separate_form_handler(""),l={};a.closest("form").find(".ur-repeater-row").each(function(){var t=e(this).closest(".ur-repeater-row").data("repeater-field-name"),r="row_"+e(this).closest(".ur-repeater-row").data("repeater-row");e(this).closest(".user-registration-EditProfileForm").length>0&&(t="user_registration_"+t),l[t]||(l[t]={field_name:t,field_type:"repeater",value:{},label:e(this).closest(".ur-repeater-row").find(".ur-repeater-label").find(".ur-label").text(),extra_params:{field_key:"repeater",label:e(this).closest(".ur-repeater-row").find(".ur-repeater-label").find(".ur-label").text()}}),l[t].value[r]||(l[t].value[r]=[])});var d=new Array;e.each(o,function(){var t=e(this).attr("name"),r=e(this).attr("type"),a=s.separate_form_handler('[name="'+t+'"]'),o=e(this).closest(".ur-repeater-row").data("repeater-field-name");"hidden"===e(this).attr("data-field-type")&&(r="hidden"),e(this).closest(".user-registration-EditProfileForm").length>0&&(o="user_registration_"+o);var u="row_"+e(this).closest(".ur-repeater-row").data("repeater-row");if((a.length<2||a.closest(".ur-repeater-row").length>0)&&e.inArray(r,["radio"])<0){var f=i.get_fieldwise_data(e(this)),c=document.querySelector(".field-invite_code");"invite_code"===f.field_name?"none"!==c.style.display&&n.push(f):e(this).closest(".ur-repeater-row").length>0?e(this).closest(".form-row").find("*[name='"+e(this).attr("name")+"']").length<2||"range"===e(this).attr("type")||e(this).hasClass("ur-smart-phone-field")?l[o].value[u].push(f):-1===d.indexOf(f.field_name+"[]")&&d.push(f.field_name+"[]"):n.push(f)}else e.inArray(t,d)<0&&d.push(t)});for(var u=0;u<d.length;u++){var f=s.separate_form_handler('[name="'+d[u]+'"]'),c=(f.get(0).tagName.toLowerCase(),"undefined"!==f.eq(0).attr("type")?f.eq(0).attr("type"):"null"),p=new Array,_={};if(e.each(f,function(){var t=e(this),r="";switch(t.get(0).tagName.toLowerCase()){case"input":switch(c){case"checkbox":case"radio":r=t.prop("checked")?t.val():"";break;default:r=t.val()}break;case"select":case"textarea":r=t.val()}""!==r&&(t.closest(".ur-repeater-row").length>0?t.closest(".field-radio").length>0?_[t.attr("data-id")]=r:(void 0===_[t.attr("data-id")]&&(_[t.attr("data-id")]=new Array),_[t.attr("data-id")].push(r)):p.push(r))}),"checkbox"==c)if(""!==r.is_payment_compatible)if("multiple_choice"==f.eq(0).attr("data-field")){e(document).trigger("user_registration_frontend_multiple_choice_data_filter",[p,f]),p=f.closest(".field-multiple_choice").data("payment-value");var m=JSON.stringify(p)}else m=JSON.stringify(p);else if("multiple_choice"==f.eq(0).attr("data-field"))for(var g=p,h=(m=0,0);h<g.length;h++)m+=g[h]|0;else m=JSON.stringify(p);else if("radio"==c)if(""!==urUsersl10n.is_payment_compatible)if("subscription_plan"==f.eq(0).attr("data-field")){if(e(document).trigger("user_registration_frontend_subscription_plan_data_filter",[p,f]),selectedSubscriptionPlan=f.closest(".field-subscription_plan").find('input[name="subscription_plan[]"]:checked'),selectedSubscriptionPlan.length>0){var v=selectedSubscriptionPlan.data("value");m=JSON.stringify(v+":"+selectedSubscriptionPlan.val())}}else m=p[0];else m=p[0];else m=f.val();var y=d[u];y=y.replace("[]","");var b={value:m,field_type:c,label:f.eq(0).attr("data-label"),field_name:y};if(Object.keys(_).length>0){new Array;e.each(_,function(t,r){t=e("[name='"+t+"']").length<1&&-1===t.indexOf("[]")?t+"[]":t;var a=e('[name="'+t+'"]').closest(".ur-repeater-row").data("repeater-row"),i=Object.assign({},b);i.value="string"==typeof r?r:JSON.stringify(r),i.field_name=y.slice(0,-2);var s=void 0===l[e("[name='"+t+"']").closest(".ur-repeater-row").data("repeater-field-name")]?"user_registration_"+e("[name='"+t+"']").closest(".ur-repeater-row").data("repeater-field-name"):e("[name='"+t+"']").closest(".ur-repeater-row").data("repeater-field-name");l[s].value["row_"+a].push(i)})}else n.push(b)}return Object.keys(l).forEach(function(t){e("input[name='"+t+"'").length>0&&e("input[name='"+t+"'").val(JSON.stringify(l[t]))}),Object.keys(l).length>0&&e.merge(n,Object.values(l)),e(document).trigger("user_registration_frontend_form_data_filter",[n]),n}},separate_form_handler:function(t){var r=e("form.user-registration-EditProfileForm");return e(".ur-frontend-form").find("form.edit-profile").hasClass("user-registration-EditProfileForm")?r.find(".user-registration-edit-user-form-details").find(".ur-edit-profile-field"+t):r.closest(".ur-frontend-form").find(".ur-form-grid").find(".ur-frontend-field"+t)},edit_profile_event:function(t){e("form.user-registration-EditProfileForm").on("submit",function(a){a.preventDefault(),a.stopImmediatePropagation();var i,n=e(this);if(e.extend(e.validator.messages,{required:r.message_required_fields,url:r.message_url_fields,email:r.message_email_fields,number:r.message_number_fields}),!n.valid())return!1;t.prop("disabled",!0);i=s.get_form_data(e(".user-registration-EditProfileForm ").data("form-id"));try{var o=e("#profile_pic_url").val();i.push({value:o,field_name:"user_registration_profile_pic_url"}),i=JSON.stringify(i)}catch(e){i=""}var l={action:"user_registration_update_profile_details",security:r.user_registration_edit_user_nonce,form_data:i,user_id:n.data("user-id"),is_admin_user:!0};e(document).trigger("user_registration_frontend_before_edit_profile_submit",[l,n]),n.find(".save_user_details").find("span").addClass("ur-spinner"),e.ajax({type:"POST",url:r.ajax_url,dataType:"JSON",data:l,complete:function(r){n.find("span.ur-spinner").removeClass("ur-spinner"),n.closest(".user-registration").find(".user-registration-error").remove(),n.closest(".user-registration").find(".user-registration-message").remove();var a=e('<ul class=""/>'),i="error";try{var o=JSON.parse(r.responseText);void 0!==o.success&&!0===o.success&&(i="success"),null!=typeof o.data.email&&""!=o.data.email&&e(document).find(".user_registration_edit_profile_user_email").val(o.data.email);var l=!1;"object"==typeof o.data.message?e.each(o.data.message,function(t,r){if(r.hasOwnProperty("individual")){var i=[];e.each(n.find(".ur-form-row").find(".ur-field-item").find(".ur-edit-profile-field"),function(t){var r=e(this).attr("id");i.push(r)}),e.each(r,function(e,t){if(e=-1===e.indexOf("user_registration_")?"user_registration_"+e:e,i.includes(e)){var r='<label id="'+e+'-error" class="user-registration-error" for="'+e+'">'+t+"</label>",a=n.find(".ur-form-row");(a=a.find(".ur-field-item").find("input[id='"+e+"'], textarea[id='"+e+"']")).closest(".form-row").append(r),l=!0}})}else a.append("<li>"+r+"</li>")}):(a.append("<li>"+o.data.message+"</li>"),void 0!==o.data.userEmailPendingMessage&&(e(".user-registration-info.user-email-change-update-notice").remove(),s.show_success_message(o.data.userEmailUpdateMessage),e("input#user_registration_user_email").next("div.email-updated").length&&e("input#user_registration_user_email").next("div.email-updated").remove(),e(o.data.userEmailPendingMessage).insertAfter(e("input#user_registration_user_email")),e("input#user_registration_user_email").val(o.data.oldUserEmail)))}catch(e){a.append("<li>"+e.message+"</li>")}l||("error"===i?(s.show_failure_message(o.data.message),s.toggle_edit_form_visibility(!0)):s.show_success_message(o.data.message)),e(document).trigger("user_registration_edit_profile_after_ajax_complete",[r,n]),t.prop("disabled",!1),e(window).scrollTop(e(".user-registration").position()),s.toggle_edit_form_visibility(!1)}}).fail(function(){s.show_failure_message(r.ajax_form_submit_error),t.prop("disabled",!1),s.toggle_edit_form_visibility(!0)})})}};e(document).ready(function(){e("#user-registration-edit-user-body").length&&s.init()})});