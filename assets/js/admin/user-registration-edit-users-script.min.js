function ur_includes(e,r){if(Array.isArray(e))for(var t=0;t<e.length;t+=1)if(e[t]===r)return!0;return!1}jQuery(function(e){if(UR_Snackbar)var r=new UR_Snackbar;var t=urUsersl10n,i=[],a=t.form_required_fields,s={init:function(){s.initUIBindings(),e("#user-registration-edit-user-body  #user_registration_user_pass").length>0&&this.hide_password_input(),e(".ur-masked-input").inputmask("mask")||e(".ur-masked-input").inputmask()},hide_password_input:function(){e("#user_registration_user_pass_field input").hide();var r='<button type="button" class="button btn-primary set-new-pass-btn">'+t.edit_user_set_new_password+"</button>";e("#user-registration-edit-user-body  .field-user_pass .input-wrapper").append(r)},toggle_password_input_visibility:function(){e("#user_registration_user_pass_field input").val("").show(),e(".set-new-pass-btn").hide();e("#user_registration_user_pass_field .password-input-group").append('<div class="hide-show-password"><span class="dashicons dashicons-visibility hide-show-btn"></span></div>')},toggle_edit_form_visibility:function(r){r?(e(".urm-admin-edit-user").removeClass("user-registration-hidden"),e(".urm-admin-view-user").addClass("user-registration-hidden")):(e(".urm-admin-edit-user").addClass("user-registration-hidden"),e(".urm-admin-view-user").removeClass("user-registration-hidden"))},show_success_message:function(t){return!(!r||!t)&&(e.isArray(t)?t.forEach(function(e){Object.keys(e).forEach(function(t){"string"==typeof e[t]&&r.add({type:"success",message:e[t],duration:5,icon:"exclamation"})})}):r.add({type:"success",message:t,duration:5,icon:"exclamation"}),!0)},show_failure_message:function(t){return!(!r||!t)&&(e.isArray(t)?t.forEach(function(e){Object.keys(e).forEach(function(t){"string"==typeof e[t]&&r.add({type:"failure",message:e[t],duration:6})})}):r.add({type:"failure",message:t,duration:6}),!0)},initUIBindings:function(){e(".save_user_details").on("click",function(r){var t=e(this);s.edit_profile_event(t),t.submit()}),e(document).on("click",".hide-show-btn",function(r){r.preventDefault(),r.stopPropagation();var t=e("#user_registration_user_pass");e(this).toggleClass("dashicons-visibility dashicons-hidden"),t.prop("type",function(e,r){return"password"===r?"text":"password"})}),e(document).on("click",".set-new-pass-btn",function(){s.toggle_password_input_visibility()}),e(document).on("click","#user-registration-edit-user-link",function(e){e.preventDefault(),s.toggle_edit_form_visibility(!0)})},get_fieldwise_data:function(r){var t={},s=r.get(0).tagName.toLowerCase(),n="undefined"!==r.attr("name")?r.attr("name"):"null",o=[];void 0!==r.attr("name")&&""!==r.attr("name")?(t.field_name=r.attr("name"),t.field_name=t.field_name.replace("[]",""),e(r).closest(".ur-repeater-row").length>0&&(e(r).closest(".field-multi_select2").length>0&&(t.field_name=t.field_name.slice(0,-2)),e(r).closest(".field-file").length>0&&(t.field_name=e(r).closest(".field-file").attr("data-ref-id")))):t.field_name="",e(".field-phone, .field-billing_phone").each(function(){var r=e(this).find(".form-row").attr("id");e(this).find(".form-row").find("#"+r).hasClass("ur-smart-phone-field")&&o.push(e(this).find(".form-row").attr("id"))});var l="undefined"!==r.attr("type")?r.attr("type"):"null",d=r.get(0).className.split(" ")[0];switch(t.value="",s){case"input":var u=new Array;switch(l){case"checkbox":!r.closest(".field-privacy_policy").length>0?r.prop("checked")?(u.push(r.val()),t.value=JSON.stringify(u)):t.value="":(t.value=r.prop("checked")?r.val():"",t.field_name=r.closest(".field-privacy_policy").data("ref-id"));break;case"radio":t.value=r.prop("checked")?r.val():"",t.field_name=r.closest(".field-privacy_policy").data("ref-id");break;default:t.value=r.val()}ur_includes(o,n)&&(t.value=r.siblings('input[type="hidden"]').val());break;case"select":t.value=r.val();break;case"textarea":if("wysiwyg"===d)tinyMCE.triggerSave(),t.value=r.val();else t.value=r.val()}return e(document).trigger("user_registration_frontend_form_data_render",[r,t]),t.field_type="undefined"!==r.eq(0).attr("type")?r.eq(0).attr("type"):"null","hidden"===r.attr("data-field-type")&&(t.field_type=l),void 0!==r.attr("data-label")?t.label=r.attr("data-label"):r.prev().length&&"label"===r.prev().get(0).tagName.toLowerCase()?t.label=r.prev().text():t.label=t.field_type,e.inArray(t.field_name,a.join(",").trim())>=0&&i.push(t.field_name),t},get_form_data:function(r){var i=e("form.user-registration-EditProfileForm");if(r===i.closest(".ur-frontend-form").attr("id")||e(".ur-frontend-form").find("form.edit-profile").hasClass("user-registration-EditProfileForm")){var a=this,n=[],o=s.separate_form_handler(""),l={};i.closest("form").find(".ur-repeater-row").each(function(){var r=e(this).closest(".ur-repeater-row").data("repeater-field-name"),t="row_"+e(this).closest(".ur-repeater-row").data("repeater-row");e(this).closest(".user-registration-EditProfileForm").length>0&&(r="user_registration_"+r),l[r]||(l[r]={field_name:r,field_type:"repeater",value:{},label:e(this).closest(".ur-repeater-row").find(".ur-repeater-label").find(".ur-label").text(),extra_params:{field_key:"repeater",label:e(this).closest(".ur-repeater-row").find(".ur-repeater-label").find(".ur-label").text()}}),l[r].value[t]||(l[r].value[t]=[])});var d=new Array;e.each(o,function(){var r=e(this).attr("name"),t=e(this).attr("type"),i=s.separate_form_handler('[name="'+r+'"]'),o=e(this).closest(".ur-repeater-row").data("repeater-field-name");"hidden"===e(this).attr("data-field-type")&&(t="hidden"),e(this).closest(".user-registration-EditProfileForm").length>0&&(o="user_registration_"+o);var u="row_"+e(this).closest(".ur-repeater-row").data("repeater-row");if((i.length<2||i.closest(".ur-repeater-row").length>0)&&e.inArray(t,["radio"])<0){var f=a.get_fieldwise_data(e(this)),c=document.querySelector(".field-invite_code");"invite_code"===f.field_name?"none"!==c.style.display&&n.push(f):e(this).closest(".ur-repeater-row").length>0?e(this).closest(".form-row").find("*[name='"+e(this).attr("name")+"']").length<2||"range"===e(this).attr("type")||e(this).hasClass("ur-smart-phone-field")?l[o].value[u].push(f):-1===d.indexOf(f.field_name+"[]")&&d.push(f.field_name+"[]"):n.push(f)}else e.inArray(r,d)<0&&d.push(r)});for(var u=0;u<d.length;u++){var f=s.separate_form_handler('[name="'+d[u]+'"]'),c=(f.get(0).tagName.toLowerCase(),"undefined"!==f.eq(0).attr("type")?f.eq(0).attr("type"):"null"),p=new Array,_={};if(e.each(f,function(){var r=e(this),t="";switch(r.get(0).tagName.toLowerCase()){case"input":switch(c){case"checkbox":case"radio":t=r.prop("checked")?r.val():"";break;default:t=r.val()}break;case"select":case"textarea":t=r.val()}""!==t&&(r.closest(".ur-repeater-row").length>0?r.closest(".field-radio").length>0?_[r.attr("data-id")]=t:(void 0===_[r.attr("data-id")]&&(_[r.attr("data-id")]=new Array),_[r.attr("data-id")].push(t)):p.push(t))}),"checkbox"==c)if(""!==t.is_payment_compatible)if("multiple_choice"==f.eq(0).attr("data-field")){e(document).trigger("user_registration_frontend_multiple_choice_data_filter",[p,f]),p=f.closest(".field-multiple_choice").data("payment-value");var m=JSON.stringify(p)}else m=JSON.stringify(p);else if("multiple_choice"==f.eq(0).attr("data-field"))for(var g=p,h=(m=0,0);h<g.length;h++)m+=g[h]|0;else m=JSON.stringify(p);else if("radio"==c)if(""!==urUsersl10n.is_payment_compatible)if("subscription_plan"==f.eq(0).attr("data-field")){if(e(document).trigger("user_registration_frontend_subscription_plan_data_filter",[p,f]),selectedSubscriptionPlan=f.closest(".field-subscription_plan").find('input[name="subscription_plan[]"]:checked'),selectedSubscriptionPlan.length>0){var v=selectedSubscriptionPlan.data("value");m=JSON.stringify(v+":"+selectedSubscriptionPlan.val())}}else m=p[0];else m=p[0];else m=f.val();var y=d[u];y=y.replace("[]","");var b={value:m,field_type:c,label:f.eq(0).attr("data-label"),field_name:y};if(Object.keys(_).length>0){new Array;e.each(_,function(r,t){r=e("[name='"+r+"']").length<1&&-1===r.indexOf("[]")?r+"[]":r;var i=e('[name="'+r+'"]').closest(".ur-repeater-row").data("repeater-row"),a=Object.assign({},b);a.value="string"==typeof t?t:JSON.stringify(t),a.field_name=y.slice(0,-2);var s=void 0===l[e("[name='"+r+"']").closest(".ur-repeater-row").data("repeater-field-name")]?"user_registration_"+e("[name='"+r+"']").closest(".ur-repeater-row").data("repeater-field-name"):e("[name='"+r+"']").closest(".ur-repeater-row").data("repeater-field-name");l[s].value["row_"+i].push(a)})}else n.push(b)}return Object.keys(l).forEach(function(r){e("input[name='"+r+"'").length>0&&e("input[name='"+r+"'").val(JSON.stringify(l[r]))}),Object.keys(l).length>0&&e.merge(n,Object.values(l)),e(document).trigger("user_registration_frontend_form_data_filter",[n]),n}},separate_form_handler:function(r){var t=e("form.user-registration-EditProfileForm");return e(".ur-frontend-form").find("form.edit-profile").hasClass("user-registration-EditProfileForm")?t.find(".user-registration-edit-user-form-details").find(".ur-edit-profile-field"+r):t.closest(".ur-frontend-form").find(".ur-form-grid").find(".ur-frontend-field"+r)},edit_profile_event:function(r){e("form.user-registration-EditProfileForm").on("submit",function(i){i.preventDefault(),i.stopImmediatePropagation();var a,n=e(this);if(e.extend(e.validator.messages,{required:t.message_required_fields,url:t.message_url_fields,email:t.message_email_fields,number:t.message_number_fields}),!n.valid())return!1;r.prop("disabled",!0);a=s.get_form_data(e(".user-registration-EditProfileForm ").data("form-id"));try{var o=e("#profile_pic_url").val();a.push({value:o,field_name:"user_registration_profile_pic_url"}),a=JSON.stringify(a)}catch(e){a=""}var l={action:"user_registration_update_profile_details",security:t.user_registration_edit_user_nonce,form_data:a,user_id:n.data("user-id"),is_admin_user:!0};e(document).trigger("user_registration_frontend_before_edit_profile_submit",[l,n]),n.find(".save_user_details").find("span").addClass("ur-spinner"),e.ajax({type:"POST",url:t.ajax_url,dataType:"JSON",data:l,complete:function(t){n.find("span.ur-spinner").removeClass("ur-spinner"),n.closest(".user-registration").find(".user-registration-error").remove(),n.closest(".user-registration").find(".user-registration-message").remove();var i=e('<ul class=""/>'),a="error";try{var o=JSON.parse(t.responseText);void 0!==o.success&&!0===o.success&&(a="success");var l=!1;"object"==typeof o.data.message?e.each(o.data.message,function(r,t){if(t.hasOwnProperty("individual")){var a=[];e.each(n.find(".ur-form-row").find(".ur-field-item").find(".ur-edit-profile-field"),function(r){var t=e(this).attr("id");a.push(t)}),e.each(t,function(e,r){if(e=-1===e.indexOf("user_registration_")?"user_registration_"+e:e,a.includes(e)){var t='<label id="'+e+'-error" class="user-registration-error" for="'+e+'">'+r+"</label>",i=n.find(".ur-form-row");(i=i.find(".ur-field-item").find("input[id='"+e+"'], textarea[id='"+e+"']")).closest(".form-row").append(t),l=!0}})}else i.append("<li>"+t+"</li>")}):(i.append("<li>"+o.data.message+"</li>"),void 0!==o.data.userEmailPendingMessage&&(e(".user-registration-info.user-email-change-update-notice").remove(),s.show_success_message(o.data.userEmailUpdateMessage),e("input#user_registration_user_email").next("div.email-updated").length&&e("input#user_registration_user_email").next("div.email-updated").remove(),e(o.data.userEmailPendingMessage).insertAfter(e("input#user_registration_user_email")),e("input#user_registration_user_email").val(o.data.oldUserEmail)))}catch(e){i.append("<li>"+e.message+"</li>")}l||("error"===a?(s.show_failure_message(o.data.message),s.toggle_edit_form_visibility(!0)):s.show_success_message(o.data.message)),e(document).trigger("user_registration_edit_profile_after_ajax_complete",[t,n]),r.prop("disabled",!1),e(window).scrollTop(e(".user-registration").position()),s.toggle_edit_form_visibility(!1)}}).fail(function(){s.show_failure_message(t.ajax_form_submit_error),r.prop("disabled",!1),s.toggle_edit_form_visibility(!0)})})}};e(document).ready(function(){e("#user-registration-edit-user-body").length&&s.init()})});