jQuery(function(){"email_confirmation"==jQuery("#user_registration_general_setting_login_options option:selected").val()&&(jQuery("#user_registration_general_setting_disable_email").attr("checked",!1),jQuery("#user_registration_general_setting_disable_email").attr("disabled",!0)),jQuery("body").on("select2:select","#user_registration_general_setting_login_options",function(){"email_confirmation"==jQuery(this).find("option:selected").val()?(jQuery("#user_registration_general_setting_disable_email").attr("checked",!1),jQuery("#user_registration_general_setting_disable_email").attr("disabled",!0)):jQuery("#user_registration_general_setting_disable_email").attr("disabled",!1)})}),jQuery(function(e){e(document.body).on("init_tooltips",function(){var i={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200,keepAlive:!0};e(".tips, .help_tip, .user-registration-help-tip").tipTip(i),e(".parent-tips").each(function(){e(this).closest("a, th").attr("data-tip",e(this).data("tip")).tipTip(i).css("cursor","help")})}).trigger("init_tooltips"),e("body").on("keypress","#ur-form-name",function(i){13===i.which&&e("#save_form_footer").eq(0).trigger("click")})}),function(e,i){function t(i,t){var r;r="success"===t?'<div class="updated ur-notices" style="border-color: green;"><p><strong>'+q.i18n_success+"! </strong>"+i+"</p></div>":'<div class="updated ur-notices" style="border-color: red;"><p><strong>'+q.i18n_error+"!!! </strong>"+i+"</p></div>",e(".ur-form-subcontainer").find(".ur-notices").remove(),e(".ur-form-subcontainer").prepend(r),e("html, body").animate({scrollTop:e(".ur-notices").offset().top-50},600)}function r(){var t=e.makeArray(i.form_one_time_draggable_fields),r=e.makeArray(i.form_required_fields),a={validation_status:!0,message:""};if(0===e(".ur-selected-item").length)return a.validation_status=!1,a.message=q.i18n_at_least_one_field_need_to_select,a;if(""===e("#ur-form-name").val())return a.validation_status=!1,a.message=q.i18n_empty_form_name,a;if(e(".ur_save_form_action_button").closest(".publishing-action").find(".spinner").length>0)return a.validation_status=!1,a.message=q.i18n_previous_save_action_ongoing,a;e.each(e('.ur-selected-inputs .ur-general-setting-block input[data-field="field_name"]'),function(){var i,t=e(this),r=!1;try{var n=t.val();if(e(".ur-selected-inputs .ur-general-setting-block").find('input[data-field="field_name"][value="'+n+'"]').length>1)throw q.i18n_duplicate_field_name;if(""===t.closest(".ur-general-setting-block").find('input[data-field="label"]').val())throw t=t.closest(".ur-general-setting-block").find('input[data-field="label"]'),q.i18n_empty_field_label;var s=/[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/gm,d=n.match(s);if(null===d||1!==d.length||d[0]!==n)throw q.i18n_invald_field_name}catch(l){a.validation_status=!1,a.message=l.message===undefined?l:l.message,t.closest(".ur-selected-item").trigger("click"),i=t.attr("data-field"),e("#ur-setting-form").find('input[data-field="'+i+'"]').css({border:"1px solid red"}),setTimeout(function(){e("#ur-setting-form").find('input[data-field="'+i+'"]').removeAttr("style")},2e3),r=!0}if(r)return!1});for(var n=0;n<t.length;n++)if(e(".ur-selected-inputs").find('.ur-field[data-field-key="'+t[n]+'"]').length>1){a.validation_status=!1,a.message=q.i18n_multiple_field_key+t[n];break}for(var s=0;s<r.length;s++)if(0===e(".ur-selected-inputs").find('.ur-field[data-field-key="'+r[s]+'"]').length){a.validation_status=!1,a.message=q.i18n_at_least_one_field_is_required+r[s];break}return a}function a(){var i=[],t=e(".ur-selected-inputs .ur-single-row");return e.each(t,function(){var t=e(this).find(".ur-grid-list-item"),r=[];e.each(t,function(){var i=n(e(this));r.push(i)}),i.push(r)}),i}function n(i){var t=i.find(".ur-selected-item"),r=[];return e.each(t,function(){var i=e(this),t={field_key:i.find(".ur-field").attr("data-field-key"),general_setting:s(i),advance_setting:d(i)};r.push(t)}),r}function s(i){var t=i.find(".ur-general-setting-block").find(".ur-general-setting-field"),r={};return e.each(t,function(){r[e(this).attr("data-field")]=l(e(this))}),r}function d(i){var t=i.find(".ur-advance-setting-block").find(".ur_advance_setting"),r={};return e.each(t,function(){r[e(this).attr("data-advance-field")]=l(e(this))}),r}function l(e){var i="";switch(e.get(0).tagName.toLowerCase()){case"input":case"select":case"textarea":i=e.val()}return i}function o(){var i=e(".ur-general-setting-field");e.each(i,function(){var i=e(this);switch(i.attr("data-field")){case"label":i.on("keyup",function(){v(e(this))});break;case"field_name":i.on("change",function(){m(e(this))});break;case"placeholder":i.on("keyup",function(){p(e(this))});break;case"required":i.on("change",function(){h(e(this))})}});var t=e(".ur_advance_setting");e.each(t,function(){var i=e(this),t=i.get(0).tagName.toLowerCase(),r="change";switch(t){case"input":r="keyup";break;case"select":r="change";break;case"textarea":r="keyup";break;default:r="change"}e(this).on(r,function(){u(i,t)}),e(this).on("paste",function(){u(i,t)})})}function u(i,t){var r=e(".ur-selected-item.ur-item-active"),a=i.attr("id"),n=r.find(".ur-advance-setting-block").find("#"+a);switch(t){case"input":n.val(i.val());break;case"select":n.find('option[value="'+i.val()+'"]').attr("selected","selected");break;case"textarea":n.val(i.val()),c(i.val())}}function c(i){switch(e(".ur-selected-item.ur-item-active").find(".ur-field").attr("data-field-key")){case"select":_(i);break;case"checkbox":f(i);break;case"radio":g(i)}}function f(i){i=e.trim(i);var t=e(".ur-selected-item.ur-item-active").find(".ur-field");t.html("");for(var r=i.split(","),a=0;a<r.length;a++)""!==r[a]&&t.append('<label><input value="'+r[a].trim()+'" type="checkbox">'+r[a].trim()+"</label>")}function g(i){i=e.trim(i);var t=e(".ur-selected-item.ur-item-active").find(".ur-field");t.html("");for(var r=i.split(","),a=0;a<r.length;a++)""!==r[a]&&t.append('<label><input value="'+r[a].trim()+'" type="radio">'+r[a].trim()+"</label>")}function _(i){i=e.trim(i);var t=e(".ur-selected-item.ur-item-active").find(".ur-field").find("select");t.html("");for(var r=i.split(","),a=0;a<r.length;a++)""!==r[a]&&t.append("<option value='"+r[a]+"'>"+r[a].trim()+"</option>")}function m(i){e(".ur-selected-item.ur-item-active").find(".ur-general-setting-block").find('input[data-field="'+i.attr("data-field")+'"]').attr("value",i.val())}function v(i){var t=e(".ur-selected-item.ur-item-active");t.find(".ur-label").find("label").text(i.val());var r=i.attr("id");t.find(".ur-general-setting-block").find("#"+r).val(i.val())}function p(i){var t=e(".ur-selected-item.ur-item-active");t.find(".ur-field").find("input").attr("placeholder",i.val()),t.find(".ur-general-setting-block").find('input[data-field="'+i.attr("data-field")+'"]').val(i.val())}function h(i){var t=e(".ur-selected-item.ur-item-active");t.find(".ur-label").find("label").find("span").remove(),"yes"===i.val()&&t.find(".ur-label").find("label").append('<span style="color:red">*</span>'),t.find(".ur-general-setting-block").find('select[data-field="'+i.attr("data-field")+'"]').find('option[value="'+i.val()+'"]').attr("selected","selected")}function b(){var t=i.form_required_fields,r=e(".ur-selected-inputs");if(e.isArray(t))for(var a=0;a<t.length;a++){var n=r.find('.ur-field[data-field-key="'+t[a]+'"]');n.closest(".ur-selected-item").find('select[data-field="required"]').val("yes").trigger("change"),n.closest(".ur-selected-item").find('select[data-field="required"]').find('option[value="yes"]').attr("selected","selected"),n.closest(".ur-selected-item").find('select[data-field="required"]').attr("disabled","disabled")}var s=r.find('select[data-field="required"]').find('option[selected="selected"][value="yes"]').closest(".ur-selected-item").find(".ur-label").find("label");s.find("span").remove(),s.append('<span style="color:red">*</span>')}function y(){var t=i.form_one_time_draggable_fields,r=e("#ur-tab-registered-fields").find("ul.ur-registered-list");e.each(r.find("li"),function(){var i=e(this),r=e(this).attr("data-field-id").replace("user_registration_","");e.inArray(r,t)>=0&&(e(".ur-selected-inputs").find('.ur-field[data-field-key="'+r+'"]').length>0?i.draggable("disable"):i.draggable("enable"))})}function k(e){return Math.ceil(e,0)}function w(e){return parseInt(e,0)}var q=i.i18n_admin;e(function(){function n(i){var t=i.find(".ur-advance-setting-block").clone(),r=i.find(".ur-general-setting-block").clone(),a=e("<form id='ur-setting-form'/>");e("#ur-tab-field-options").html(""),a.append(r),a.append(t),e("#ur-tab-field-options").append(a),e("#ur-tab-field-options").find(".ur-advance-setting-block").show(),e("#ur-tab-field-options").find(".ur-general-setting-block").show(),1===e(".ur-item-active").length&&(e(".ur-tabs").tabs("enable",1),e(".ur-tabs").find("a").eq(1).trigger("click"))}({init:function(){e(document.body).on("click",".column-data_link a",this.add_item).on("ur_backbone_modal_loaded",this.backbone.init).on("ur_backbone_modal_response",this.backbone.response)},add_item:function(i){return i.preventDefault(),e(this).URBackboneModal({template:"test-demo"}),!1},backbone:{init:function(e,i){},response:function(e,i){}}}).init(),e.fn.ur_form_builder=function(){var r={active_grid:i.active_grid,number_of_grid_list:i.number_of_grid,min_grid_height:70};return this.each(function(){var a=e(this),n={init:function(){this.single_row(),b()},get_grid_button:function(){var i=e('<div class="ur-grid-containner"/>'),t=k(w(r.number_of_grid_list)/w(r.active_grid))+"/"+r.number_of_grid_list,a='<div class="ur-grid-navigation ur-nav-right dashicons dashicons-arrow-left-alt2"></div><div class="ur-grid-size" data-active-grid="'+r.active_grid+'">'+t+'</div><div class="ur-grid-navigation ur-nav-left dashicons dashicons-arrow-right-alt2"></div><button type="button" class="dashicons dashicons-no-alt ur-remove-row"></button>';return i.html(a),i.html()},single_row:function(){var t=e("<div class='ur-single-row'/>");t.append(e("<div class='ur-grids'/>"));var d=this.get_grid_button();t.find(".ur-grids").append(d),t.find(".ur-grids").find('span[data-id="'+r.active_grid+'"]').addClass("ur-active-grid");var l=this.get_grid_lists(r.active_grid);t.append('<div style="clear:both"></div>'),t.append(l),t.append('<div style="clear:both"></div>'),a.append(t),a.find(".ur-add-new-row").remove(),a.append('<button type="button" class="dashicons dashicons-plus-alt ur-add-new-row ui-sortable-handle"></button>'),s.render_draggable_sortable(),n.manage_empty_grid(),"1"===i.is_edit_form&&e(".ur-single-row").eq(e(".ur-single-row").length-1).remove(),"1"!==i.is_edit_form&&(e(".ur-single-row").eq(0).find(".ur-grid-lists").eq(0).find(".ur-grid-list-item").eq(0).find(".user-registration-dragged-me").remove(),e(".ur-single-row").eq(0).find(".ur-grid-lists").eq(0).find(".ur-grid-list-item").eq(0).append(i.required_form_html)),y()},get_grid_lists:function(i){for(var t=e('<div class="ur-grid-lists"/>'),a=1;a<=i;a++){var n=e("<div ur-grid-id='"+a+"' class='ur-grid-list-item'></div>"),s=Math.floor(100/i)-i;s,n.css({width:s+"%","min-height":r.min_grid_height+"px"}),t.append(n)}return t.append('<div style="clear:both"></div>'),t.find(".ur-grid-list-item").eq("0").css({}),t},populate_dropped_node:function(t,r){var a={action:"user_registration_user_input_dropped",security:i.user_input_dropped,form_field_id:r},s='<div class="ur-selected-item ajax_added"><div class="ur-action-buttons"><span title="Clone" class="dashicons dashicons-admin-page ur-clone"></span><span title="Trash" class="dashicons dashicons-trash ur-trash"></span></div>(content)</div>';t.closest(".ur-single-row").find(".user-registration-dragged-me").fadeOut(),e.ajax({url:i.ajax_url,data:a,type:"POST",beforeSend:function(){t.removeAttr("class").removeAttr("id").removeAttr("data-field-id").addClass("ur-selected-item").css({width:"auto"}),t.html('<small class="spinner is-active"></small>'),t.addClass("ur-item-dragged")},complete:function(i){if(n.manage_empty_grid(),!0===i.responseJSON.success){var r=e(s.replace("(content)",i.responseJSON.data.template));r.removeClass("ajax_added"),r.removeClass("ur-item-dragged"),t.find(".ajax_added").find(".spinner").remove(),t.find(".ajax_added").remove(),e(r).insertBefore(t),t.remove()}y()}})},manage_empty_grid:function(){var i=e(".ur-selected-inputs"),t=e('<div class="user-registration-dragged-me"/>');t.html('<div class="user-registration-dragged-me-text"><p>'+q.i18n_drag_your_first_item_here+"</p></div>"),i.find(".user-registration-dragged-me").remove(),e.each(i.find(".ur-grid-list-item"),function(){var i=e(this);0===e(this).find(".ur-selected-item").length&&i.append(t.clone())})}},s={register:function(){this.register_add_new_row(),this.register_remove_row(),this.change_ur_grids(),this.remove_selected_item(),this.clone_selected_item()},register_add_new_row:function(){var i=this;e("body").on("click",".ur-add-new-row",function(){var t=e(this).closest(".ur-selected-inputs").find(".ur-single-row").eq(0).clone();t.find(".ur-grid-lists").html(""),t.find(".ur-grids").find("span").removeClass("ur-active-grid"),t.find(".ur-grids").find('span[data-id="'+r.active_grid+'"]').addClass("ur-active-grid");var a=n.get_grid_lists(r.active_grid);t.find(".ur-grid-lists").append(a.html()),t.insertBefore(".ur-add-new-row"),i.render_draggable_sortable(),n.manage_empty_grid()})},register_remove_row:function(){var i=this;e("body").on("click",".ur-remove-row",function(){if(e(".ur-selected-inputs").find(".ur-single-row").length>1){if(window.confirm(q.i18n_are_you_sure_want_to_delete)){var t,r=e(this).prev();(t=r.hasClass("ur-add-new-row")?r.clone():e(this).clone().attr("class","dashicons-minus ur-remove-row")).hasClass("ur-add-new-row")&&e(this).closest(".ur-single-row").prev().find(".ur-remove-row").before(t),e(this).closest(".ur-single-row").remove(),i.check_grid()}}else window.alert(q.i18n_at_least_one_row_need_to_select)})},change_ur_grids:function(){var i=this;e("body").on("click",".ur-single-row .ur-nav-right",function(){var t=e(this).closest(".ur-single-row"),a=e(this).closest(".ur-grids").find(".ur-grid-size").attr("data-active-grid");if(!(a>=r.number_of_grid_list)){a=w(a)+1;var s=k(w(r.number_of_grid_list)/w(a))+"/"+r.number_of_grid_list;e(this).closest(".ur-grids").find(".ur-grid-size").attr("data-active-grid",a),e(this).closest(".ur-grids").find(".ur-grid-size").text(s);var d=n.get_grid_lists(a);e.each(t.find(".ur-grid-lists .ur-grid-list-item"),function(){e(this).children("*").each(function(){d.find(".ur-grid-list-item").eq(0).append(e(this).clone())})}),t.find(".ur-grid-lists").eq(0).hide(),d.clone().insertAfter(t.find(".ur-grid-lists")),t.find(".ur-grid-lists").eq(0).remove(),i.render_draggable_sortable(),n.manage_empty_grid()}}),e("body").on("click",".ur-single-row .ur-nav-left",function(){var t=e(this).closest(".ur-single-row"),a=e(this).closest(".ur-grids").find(".ur-grid-size").attr("data-active-grid");if(!(a<=1)){a=w(a)-1;var s=k(w(r.number_of_grid_list)/w(a))+"/"+r.number_of_grid_list;e(this).closest(".ur-grids").find(".ur-grid-size").attr("data-active-grid",a),e(this).closest(".ur-grids").find(".ur-grid-size").text(s);var d=n.get_grid_lists(a);e.each(t.find(".ur-grid-lists .ur-grid-list-item"),function(){e(this).children("*").each(function(){d.find(".ur-grid-list-item").eq(0).append(e(this).clone())})}),t.find(".ur-grid-lists").eq(0).hide(),d.clone().insertAfter(t.find(".ur-grid-lists")),t.find(".ur-grid-lists").eq(0).remove(),i.render_draggable_sortable(),n.manage_empty_grid()}})},render_draggable_sortable:function(){e(".ur-grid-list-item").sortable({containment:".ur-selected-inputs",over:function(){e(this).addClass("ur-sortable-active"),n.manage_empty_grid()},out:function(){e(this).removeClass("ur-sortable-active"),n.manage_empty_grid()},revert:!0,connectWith:".ur-grid-list-item"}).disableSelection(),e(".ur-selected-inputs").sortable({containment:".ur-selected-inputs",tolerance:"pointer",revert:"invalid",placeholder:"ur-single-row",forceHelperSize:!0,over:function(){e(this).addClass("ur-sortable-active")},out:function(){e(this).removeClass("ur-sortable-active")}}),e("#ur-draggabled li").draggable({connectToSortable:".ur-grid-list-item",containment:".ur-registered-from",helper:"clone",revert:"invalid",stop:function(r,a){if(0!==e(a.helper).closest(".ur-grid-list-item").length){var s=e.trim(e(a.helper).attr("data-field-id").replace("user_registration_","")),d=e(".ur-selected-inputs").find('.ur-field[data-field-key="'+s+'"]').length,l=e.makeArray(i.form_one_time_draggable_fields);if(d>0&&e.inArray(s,l)>=0)return t(q.i18n_user_required_field_already_there),void e(a.helper).remove();var o=e(a.helper),u=e(o).attr("data-field-id");if(void 0!==u){var c=e(a.helper).closest(".ur-grid-list-item").find('li[data-field-id="'+e(this).attr("data-field-id")+'"]');n.populate_dropped_node(c,u)}}}}).disableSelection()},remove_selected_item:function(){var i=this;e("body").on("click",".ur-selected-item .ur-action-buttons  .ur-trash",function(){e(this).closest(".ur-selected-item ").remove(),i.check_grid(),n.manage_empty_grid(),y()})},clone_selected_item:function(){e("body").on("click",".ur-selected-item .ur-action-buttons  .ur-clone",function(){var r=e(this).closest(".ur-selected-item ").find(".ur-field").attr("data-field-key");if(e(".ur-selected-inputs").find('.ur-field[data-field-key="'+r+'"]').length>0&&e.inArray(r,i.form_one_time_draggable_fields)>-1)t(q.i18n_user_required_field_already_there_could_not_clone);else{var a=e(this).closest(".ur-selected-item ").clone(),n=a.find('input[data-field="field_name"]'),s=/\d+/g,d=n.val().match(s),l=d.length>0?d[d.length-1]:"",o=n.val().replace(l,"");a.find('input[data-field="field_name"]').attr("value",o+(new Date).getTime()),e(this).closest(".ur-grid-list-item").append(a)}})},check_grid:function(){e(".ur-tabs").tabs({disabled:[1]}),e(".ur-tabs").find("a").eq(0).trigger("click")}};n.init(),s.register()})},e(".ur-selected-inputs").ur_form_builder(),e(".ur-tabs").find("a").click(function(){e(".ur-tabs").find("a").removeClass("active"),e(this).addClass("active")}),e(".ur-tabs").tabs(),e(".ur-tabs").find("a").eq(0).trigger("click"),e(".ur-tabs").tabs({disabled:[1]}),e("body").on("click",".ur-selected-item",function(){e(".ur-registered-inputs").find("ul li.ur-no-pointer").removeClass("ur-no-pointer"),e(".ur-selected-item").removeClass("ur-item-active"),e(this).addClass("ur-item-active"),n(e(this)),o()}),e(".ur_save_form_action_button").on("click",function(){var n=r();if(!1!==n.validation_status){var s=a(),d=e("#ur_form_id").val();w(i.post_id)!==w(d)&&(d=0);var l=e("#ur-field-settings").serializeArray(),o={action:"user_registration_form_save_action",security:i.ur_form_save,data:{form_data:JSON.stringify(s),form_name:e("#ur-form-name").val(),form_id:d,form_setting_data:l}};e.ajax({url:i.ajax_url,data:o,type:"POST",beforeSend:function(){e(".ur_save_form_action_button").closest(".publishing-action").append('<span class="spinner is-active" style="float: left;margin-top: 6px;"></span>'),e(".ur-notices").remove()},complete:function(r){if(e(".ur_save_form_action_button").closest(".publishing-action").find(".spinner").remove(),!0===r.responseJSON.success){t(q.i18n_form_successfully_saved,"success");var a=i.admin_url+r.responseJSON.data.post_id;window.location=a}else t(r.responseJSON.data.message)}})}else t(n.message)})})}(jQuery,window.user_registration_admin_data);