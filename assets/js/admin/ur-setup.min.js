!function(e,t){var a=e(document);__=t.i18n.__,_x=t.i18n._x,sprintf=t.i18n.sprintf,e(".user-registration").find(".user-registration-form-template-wrapper").length&&e(".user-registration__wrap.ur-form-container").remove(),t.updates.installExtension=function(s){var i=e(".plugin-card-"+s.slug),r=i.find(".install-now, .activate-now");return s=_.extend({success:t.updates.installExtensionSuccess,error:t.updates.installExtensionError},s),r.html()!==__("Installing...")&&r.data("originaltext",r.html()),r.addClass("updating-message").attr("aria-label",sprintf(_x("Installing %s...","user-registration"),r.data("name"))).text(__("Installing...")),t.a11y.speak(__("Installing... please wait."),"polite"),i.removeClass("plugin-card-install-failed").find(".notice.notice-error").remove(),a.trigger("wp-extension-installing",s),t.updates.ajax("user_registration_install_extension",s)},t.updates.installExtensionSuccess=function(s){if("user-registration-membership_page_add-new-registration"===pagenow)e(document).find(".user-registration-form-template-wrapper").length?(e('tr[data-slug="'+s.slug+'"]').removeClass("install").addClass("installed").find(".plugin-status span").removeClass("updating-message install-now").addClass("updated-message active").attr("aria-label",sprintf(_x("%s installed!","user-registration"),s.pluginName)).text(_x("Installed!","plugin")),t.a11y.speak(__("Installation completed successfully."),"polite"),a.trigger("wp-plugin-bulk-install-success",s)):(t.a11y.speak(__("Installation completed successfully."),"polite"),a.trigger("wp-plugin-install-success",s),a.trigger("ur-plugin-install-success",s));else if("user-registration-membership_page_user-registration-settings"===pagenow)t.a11y.speak(__("Installation completed successfully."),"polite"),a.trigger("wp-plugin-install-success",s),a.trigger("ur-plugin-install-success",s);else{var i=e(".plugin-card-"+s.slug).find(".install-now"),r=e(".plugin-card-"+s.slug).find(".status-label");i.removeClass("updating-message").addClass("updated-message installed button-disabled").attr("aria-label",sprintf(_x("%s installed!","user-registration"),s.pluginName)).text(_x("Installed!","user-registration")),t.a11y.speak(__("Installation completed successfully."),"polite"),a.trigger("wp-plugin-install-success",s),s.activateUrl&&setTimeout(function(){r.removeClass("status-install-now").addClass("status-active").text(t.updates.l10n.pluginInstalled),i.removeClass("install-now installed button-disabled updated-message").addClass("activate-now").attr("href",s.activateUrl),"plugins-network"===pagenow?i.attr("aria-label",sprintf(_x("Network Activate %s","user-registration"),s.pluginName)).text(__("Network Activate")):i.attr("aria-label",sprintf(_x("Activate %s","user-registration"),s.pluginName)).text(__("Activate"))},1e3)}},t.updates.installExtensionError=function(s){if("user-registration-membership_page_add-new-registration"===pagenow)if(e(document).find(".user-registration-form-template-wrapper").length){var i=e('tr[data-slug="'+s.slug+'"]').find(".plugin-status span");if(!t.updates.isValidResponse(s,"install"))return;if(t.updates.maybeHandleCredentialError(s,"install-plugin"))return;r=sprintf(__("Installation failed: %s"),s.errorMessage),i.removeClass("updating-message").addClass("updated-message").attr("aria-label",sprintf(_x("%s installation failed","user-registration"),i.closest("tr").data("name"))).text(__("Installation Failed!")),t.a11y.speak(r,"assertive"),a.trigger("wp-plugin-bulk-install-error",s)}else{if(!t.updates.isValidResponse(s,"install"))return;if(t.updates.maybeHandleCredentialError(s,"install-plugin"))return;r=sprintf(__("Installation failed: %s"),s.errorMessage),t.a11y.speak(r,"assertive"),a.trigger("ur-plugin-install-error",s)}else if("user-registration-membership_page_user-registration-settings"===pagenow){if(!t.updates.isValidResponse(s,"install"))return;if(t.updates.maybeHandleCredentialError(s,"install-plugin"))return;r=sprintf(__("Installation failed: %s"),s.errorMessage),t.a11y.speak(r,"assertive"),a.trigger("ur-plugin-install-error",s)}else{var r,n=e(".plugin-card-"+s.slug),l=n.find(".install-now");if(!t.updates.isValidResponse(s,"install"))return;if(t.updates.maybeHandleCredentialError(s,"user_registration_install_extension"))return;r=sprintf(__("Installation failed: %s"),s.errorMessage),n.addClass("plugin-card-update-failed").append('<div class="notice notice-error notice-alt is-dismissible"><p>'+r+"</p></div>"),n.on("click",".notice.is-dismissible .notice-dismiss",function(){setTimeout(function(){n.removeClass("plugin-card-update-failed").find(".column-name a").focus()},200)}),l.removeClass("updating-message").addClass("button-disabled").attr("aria-label",sprintf(_x("%s installation failed","user-registration"),l.data("name"))).text(__("Installation Failed!")),t.a11y.speak(r,"assertive"),a.trigger("wp-plugin-install-error",s)}},t.updates.queueChecker=function(){var e;if(!t.updates.ajaxLocked&&t.updates.queue.length){if("user_registration_install_extension"===(e=t.updates.queue.shift()).action)t.updates.installExtension(e.data);a.trigger("wp-updates-queue-job",e)}}}(jQuery,window.wp),jQuery(function(e){var t={$setup_form:e(".user-registration-setup--form"),$button_install:ur_setup_params.i18n_activating,init:function(){this.title_focus(),e(document).on("click",".user-registration-template-install-addon",this.install_addon),e(".user-registration-settings-addon-install, .user-registration-settings-addon-activate").click(function(a){a.preventDefault(),t.install_addon_from_settings(e(this))}),e(document).on("click",".user-registration-settings-feature-activate",function(a){a.preventDefault(),t.activate_feature_from_settings(e(this))}),e(document).on("click",".user-registration-install-extensions",function(a){a.preventDefault(),e(this).closest("body.user-registration-membership_page_add-new-registration").length&&t.install_addon_from_builder(e(this))}),e(document).on("click",".activate-now",function(t){t.preventDefault();var a=e(this);if(e(this).closest("body.user-registration-membership_page_add-new-registration").length){e(this).hasClass("form")&&(a.append('<div class="ur-spinner is-active"></div>'),e.ajax({type:"POST",url:e(this).closest("form").attr("action"),data:e(this).closest("form").serialize(),success:function(){a.find(".ur-spinner").remove()}}));var s=e(this).attr("href");Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center",icon:"warning",width:"auto",title:'<span class="user-registration-swal2-modal__title">'+ur_setup_params.i18n_activating_text+"</span>",allowOutsideClick:!1,confirmButtonText:ur_setup_params.save_changes_text,showDenyButton:!0,denyButtonText:ur_setup_params.reload_text,denyButtonColor:"#DD6B55",didOpen:function(){var t=Swal.getConfirmButton(),i=t.textContent,r=Swal.getActions();if(e(r).find(".swal2-deny").hide(),t.disabled=!0,t.innerHTML=ur_setup_params.i18n_activating+'<div class="ur-spinner is-active"></div>',!a.hasClass("form")){var n=new XMLHttpRequest;n.open("POST",s,!0),n.send()}setTimeout(function(){Swal.update({title:'<span class="user-registration-swal2-modal__title">'+ur_setup_params.save_changes_warning+"</span>"}),t.textContent=i,t.disabled=!1,e(r).find(".swal2-deny").show(),clearTimeout()},3e3)}}).then(function(t){t.isConfirmed?(e(".ur_save_form_action_button").trigger("click"),(s.indexOf("mailchimp")<1||s.indexOf("file-upload")<1)&&location.reload()):t.isDenied&&(s.indexOf("mailchimp")<1||s.indexOf("file-upload")<1)&&location.reload()})}}),e(document).on("click",".upgrade-modal",this.message_upgrade),e(document).on("click",".ur-template-preview",this.template_preview),this.$setup_form.on("click",".ur-template-select",function(a){if(-1!==e(this).data("template").indexOf("recaptcha")){var s={action:"user_registration_captcha_setup_check",security:ur_setup_params.captcha_setup_check_nonce};e.post(ur_setup_params.ajax_url,s,function(e){e.success&&void 0!==e.data.is_captcha_setup&&e.data.is_captcha_setup?t.template_select(a):Swal.fire({icon:"error",title:"Oops...",html:e.data.captcha_setup_error_msg})}).fail(function(e){Swal.fire({icon:"error",title:"Oops...",text:e.responseText})})}else t.template_select(a)}),e(document.body).on("keypress",".user-registration-setup-form-name input",this.input_keypress)},title_focus:function(){setTimeout(function(){e("#user-registration-setup-name").focus()},100)},install_addon_from_settings:function(t){wp.updates.maybeRequestFilesystemCredentials(event);var a=this.$button_install;t.hasClass("user-registration-settings-addon-install")&&(a=ur_setup_params.i18n_installing),e(t).html(a+'<div class="ur-spinner"></div>').closest("button").prop("disabled",!0),wp.updates.queue.push({action:"user_registration_install_extension",data:{page:pagenow,name:e(t).data("name"),slug:e(t).data("slug")}}),e(document).on("ur-plugin-install-success ur-plugin-install-error",function(a,s){void 0!==s.errorMessage&&s.errorMessage.length>0?Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center user-registration-settings-swal2",icon:"error",title:s.errorMessage,text:ur_setup_params.download_failed}):0===wp.updates.queue.length&&Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center user-registration-settings-swal2",icon:"success",title:'<span class="user-registration-swal2-modal__title">'+ur_setup_params.download_successful_title+"</span>",text:e(t).hasClass("user-registration-settings-addon-activate")?ur_setup_params.download_successful_message.replace(" installed and",""):ur_setup_params.download_successful_message.replace(" Activated",""),allowOutsideClick:!1,confirmButtonText:ur_setup_params.save_changes_text,showCancelButton:!0,cancelButtonText:ur_setup_params.reload_text,cancelButtonColor:"#DD6B55"}).then(function(t){t.isConfirmed?e(".user-registration-settings-container").find("input[name='save']").trigger("click"):location.reload()})}),wp.updates.queueChecker()},activate_feature_from_settings:function(t){var a=e(t),s=a.data("slug"),i=a.data("type")||"feature",r=a.data("name")||"";if(s){var n=a.html();a.html(ur_setup_params.i18n_activating+'<div class="ur-spinner"></div>').closest("button").prop("disabled",!0);var l=(ur_setup_params.rest_url||"").replace(/\/$/,"")+"/modules/activate",o=ur_setup_params.rest_nonce||"";e.ajax({url:l,type:"POST",dataType:"json",beforeSend:function(e){o&&e.setRequestHeader("X-WP-Nonce",o)},data:{slug:s,type:i,name:r},success:function(e){e.success?Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center user-registration-settings-swal2",icon:"success",title:'<span class="user-registration-swal2-modal__title">'+(e.message||ur_setup_params.download_successful_title)+"</span>",text:e.message||ur_setup_params.download_successful_message,allowOutsideClick:!1,confirmButtonText:ur_setup_params.i18n_ok||"OK",showCancelButton:!1}).then(function(e){e.isConfirmed&&location.reload()}):(Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center user-registration-settings-swal2",icon:"error",title:e.message||"Activation Failed",text:ur_setup_params.download_failed}),a.html(n).closest("button").prop("disabled",!1))},error:function(e,t,s){var i=ur_setup_params.download_failed;e.responseJSON&&e.responseJSON.message?i=e.responseJSON.message:e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.message?i=e.responseJSON.data.message:404===e.status?i="REST API endpoint not found. Please check if the plugin is properly installed.":403===e.status?i="Permission denied. Please refresh the page and try again.":0===e.status&&(i="Network error. Please check your connection and try again."),Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center user-registration-settings-swal2",icon:"error",title:"Activation Failed",text:i}),a.html(n).closest("button").prop("disabled",!1)}})}},install_addon_from_builder:function(a){if(wp.updates.maybeRequestFilesystemCredentials(event),t.$button_install=ur_setup_params.i18n_installing,e(a).html(t.$button_install+'<div class="ur-spinner"></div>').closest("button").prop("disabled",!0),e(a).data("name").indexOf(", and")){var s=e(a).data("name").split(", and"),i=e(a).data("slug").split(" ");e.each(s,function(e,t){wp.updates.queue.push({action:"user_registration_install_extension",data:{page:pagenow,name:t,slug:i[e]}})})}else wp.updates.queue.push({action:"user_registration_install_extension",data:{page:pagenow,name:e(a).data("name"),slug:e(a).data("slug")}});e(document).on("ur-plugin-install-success ur-plugin-install-error",function(t,a){void 0!==a.errorMessage&&a.errorMessage.length>0?Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center",icon:"error",title:a.errorMessage,text:ur_setup_params.download_failed}):0===wp.updates.queue.length&&Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center user-registration-locked-field",icon:"success",width:"auto",title:'<span class="user-registration-swal2-modal__title">'+ur_setup_params.download_successful_title+"</span>",text:ur_setup_params.download_successful_message,allowOutsideClick:!1,confirmButtonText:ur_setup_params.save_changes_text,showCancelButton:!0,cancelButtonText:ur_setup_params.reload_text,cancelButtonColor:"#DD6B55"}).then(function(t){t.isConfirmed?(e(".ur_save_form_action_button").trigger("click"),location.reload()):location.reload()})}),wp.updates.queueChecker()},install_addon:function(a){var s=e(".plugins-list-table").find("#the-list tr"),i=e(a.target),r=0,n=0,l=[];wp.updates.maybeRequestFilesystemCredentials(a),e(".user-registration-template-install-addon").html(t.$button_install+'<div class="ur-spinner"></div>').closest("button").prop("disabled",!0),e(document).trigger("wp-plugin-bulk-install",s),s.each(function(t,a){var s=e(a);s.hasClass("inactive")&&!s.find("notice-error").length&&wp.updates.queue.push({action:"user_registration_install_extension",data:{page:pagenow,name:s.data("name"),slug:s.data("slug")}})}),e(document).on("wp-plugin-bulk-install-success wp-plugin-bulk-install-error",function(t,a){var s,o,u=e('[data-slug="'+a.slug+'"]');"wp-"+a.install+"-bulk-install-success"===t.type?r++:(o=a.pluginName?a.pluginName:u.find(".plugin-name").text(),n++,l.push(o+": "+a.errorMessage)),wp.updates.adminNotice=wp.template("wp-bulk-installs-admin-notice"),e(".user-registration-recommend-addons .bulk-action-notice").remove(),e(".user-registration-recommend-addons .plugins-list-table").before(wp.updates.adminNotice({id:"bulk-action-notice",className:"bulk-action-notice notice-alt",successes:r,errors:n,errorMessages:l,type:a.install})),s=e("#bulk-action-notice").on("click","button",function(){e(this).toggleClass("bulk-action-errors-collapsed").attr("aria-expanded",!e(this).hasClass("bulk-action-errors-collapsed")),s.find(".bulk-action-errors").toggleClass("hidden")}),wp.updates.queue.length||n>0&&i.removeClass("updating-message").text(i.data("originaltext")),0===wp.updates.queue.length&&(e(".user-registration-template-install-addon").parent().prop("disabled",!1),e(".user-registration-template-install-addon").removeClass("user-registration-template-install-addon").addClass("user-registration-template-continue").text(ur_setup_params.i18n_form_ok))}),wp.updates.queueChecker()},message_upgrade:function(t){var a=e(this).data("template-name-raw");t.preventDefault(),Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center",icon:"error",title:'<span class="user-registration-swal2-modal__title">'+a+" "+ur_setup_params.upgrade_title+"</span>",text:ur_setup_params.upgrade_message,allowOutsideClick:!1,confirmButtonText:ur_setup_params.upgrade_button,showCancelButton:!0,cancelButtonText:ur_setup_params.i18n_ok,cancelButtonColor:"#DD6B55"}).then(function(e){e.isConfirmed&&window.open(ur_setup_params.upgrade_url,"_blank")})},template_preview:function(){var t=e(this),a=t.data("preview-link");t.closest(".user-registration-setup--form").find(".ur-template-preview-iframe #frame").attr("src",a)},template_select:function(a){var s=e(this),i=s.data("template"),r=(s.data("template-name-raw"),'<a href="#" class="user-registration-btn user-registration-template-continue">'+ur_setup_params.i18n_form_ok+"</a>"),n="";if(a.preventDefault(),$target=e(a.target),i=$target.data("template"),!$target.hasClass("disabled")&&!$target.hasClass("updating-message")){var l='<span class="user-registration-swal2-modal__title">'+ur_setup_params.i18n_form_title+"</span>";if($target.closest(".ur-template").find("span.user-registration-badge").length){var o={action:"user_registration_template_licence_check",plan:$target.attr("data-licence-plan").replace("-lifetime",""),slug:$target.attr("data-template"),security:ur_setup_params.template_licence_check_nonce};e.ajax({url:ur_setup_params.ajax_url,data:o,type:"POST",async:!1}).done(function(a){if($target.closest(".ur-template").append("<div class='user-registration-template-addons' style='display:none'>"+a.data.html+"</div>"),a.data.activate)e(".user-registration-builder-setup .swal2-confirm").show();else{r="",a.data.html.includes("install-now")?(r=ur_setup_params.i18n_install_activate,t.$button_install=ur_setup_params.i18n_installing):r=ur_setup_params.i18n_install_only;var s='<a href="#" class="user-registration-btn user-registration-template-install-addon">'+r+"</a>";e(".user-registration-template-addons").append('<div class="ur-install-now">'+s+"</div>")}})}if($target.closest(".ur-template").find(".user-registration-template-addons").length){var u=e(".user-registration-template-addons").find(".ur-install-now").html();void 0!==u&&(r=u),e(".user-registration-template-addons").find(".ur-install-now").remove(),n+=$target.closest(".ur-template").find(".user-registration-template-addons").html(),$target.closest(".ur-template").find(".user-registration-template-addons").remove()}n+="<h3>"+ur_setup_params.i18n_form_name+"</h3>";var d=!1;Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center",title:l,html:n,input:"text",inputPlaceholder:ur_setup_params.i18n_form_placeholder,inputAttributes:{id:"user-registration-setup-name"},showCloseButton:!0,allowOutsideClick:!1,confirmButtonText:r,inputValidator:function(t){if(!(e(".user-registration-template-install-addon").length>0)){if(e(".swal2-validation-message").length>0&&e(".swal2-validation-message").remove(),""===t)return e(".swal2-content").append("<div class='swal2-validation-message' id='swal2-validation-message' style='display: flex;'>"+ur_setup_params.i18n_form_error_name+"</div>"),void(d=!0);d=!1}},preConfirm:function(){if(e(".user-registration-template-install-addon").length>0){if(!d)return!1}else if(!d)return!0;return!1}}).then(function(t){if(t.isConfirmed&&e(".user-registration-template-continue").length>0){var a=e("#user-registration-setup-name");if(!a.val())return;var s={title:a.val(),action:"user_registration_create_form",template:i,security:ur_setup_params.create_form_nonce};e.post(ur_setup_params.ajax_url,s,function(t){t.success?window.location.href=t.data.redirect:(e(".user-registartion-setup-name").focus(),Swal.fire({icon:"error",title:"Oops...",text:t.data.error}))}).fail(function(e){Swal.fire({icon:"error",title:"Oops...",text:e.responseText})})}})}},input_keypress:function(t){var a=t.keyCode||t.which;if(e(this).removeClass("user-registration-required"),13===a&&"input"===t.target.tagName.toLowerCase())return t.preventDefault(),!1}};t.init()});