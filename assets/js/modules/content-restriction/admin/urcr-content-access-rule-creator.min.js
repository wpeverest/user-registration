!function(e,t,a){var r=null;UR_Snackbar?r=new UR_Snackbar:a&&console.warn('URCR: "UR_Snackbar" is not defined. Maybe there was a problem while enqueuing the script.'),e(function(){o.init(),c.init(),s.init(),u.init(),n.init_all_flatpickr(),n.init_all_tooltips(),l.render_access_rule(),n.toggleSaveButtons(!1),e(".user-registration-editable-title__icon").trigger("click"),e(".user-registration-editable-title__input").trigger("select"),e(document.body).on("click",".urcr-save-rule",function(e){e.preventDefault(),e.stopPropagation(),t.rule_id&&""!==t.rule_id?_.save_rule():_.create_rule()}),e(document.body).on("click",".urcr-save-rule-as-draft",function(e){e.preventDefault(),e.stopPropagation(),_.save_rule_as_draft()}),e(document.body).on("submit",".urcr-content-access-rule-creator-form",function(e){e.preventDefault(),e.stopPropagation()}),e(document.body).on("click",".page-title-action",function(a){a.preventDefault();Swal.fire({customClass:"user-registration-swal2-modal user-registration-swal2-modal--center",title:'<i class="dashicons dashicons-plus-alt" style="color: #2778c4; border-color: #2778c4;"></i></br>'+t.labels.add_new,confirmButtonText:t.labels.confirm_text,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:t.labels.cancel_text,html:'<label for="select-box">'+t.labels.content_rule_name+'</label><input id="content_rule_name" class="swal2-input" placeholder="Give it a name"><label for="select-box">'+t.labels.access_control+'</label><select id="access-control" name="access-control" class="swal2-input"><option value="access">'+t.labels.access+'</option><option value="restrict">'+t.labels.restrict+"</option>",inputAttributes:{autocapitalize:"off"},inputPlaceholder:t.labels.content_rule_name}).then(function(a){if(a.value){var r=e("#content_rule_name").val(),n=e("#access-control").val(),i={action:"urcr_create_content_rules",security:t._nonce,contentName:r,accessControlValue:n,url:t.content_rule_url};e.ajax({url:t.ajax_url,data:i,type:"POST",success:function(e){e.success&&(window.location.href=e.data.redirect)}})}})}),e(document).on("click",".urcr-logic-gates-container span",function(t){t.preventDefault();var a=e(this).attr("data-value"),r=e(this).attr("class").match(/x\d+/g);if(r){var n=r[0].substring(1);e("#urcr-logic-group-rule-x"+n).next(".ur-form-group").length>0&&(e("#urcr-logic-group-rule-x"+n).removeAttr("class").attr("class","urcr-logic-group-rule-"+a),e("#urcr-sub-logic-group-rule-x"+n).removeAttr("class").attr("class","urcr-sub-logic-group-rule-"+a),e("#urcr-sub-logic-group-rule-x"+n).text(a))}}),e(document).ready(function(){e(".urcr-conditional-logic-definitions").each(function(){var t=e(this).attr("id");e("#"+t).find(".ur-form-group").length<=0&&(e("#"+t).find(".ucr-logic-group-rule span").text(""),e("#"+t).before('<p class="urcr-conditional-logic-warning"><b>Warning:</b> Please add the condition logic field</p>'),e("#"+t).find(".ucr-logic-group-rule").children("span").removeAttr("Class"),e("#"+t).find(".ucr-logic-group-rule").removeAttr("Class"))})}),e(document.body).trigger("urcr_initializations_complete"),e(document.body).on("change",".urcr-enable-access-rule",function(){var t=e(this),a=t.data("rule-id"),r=t.is(":checked"),i={action:"urcr_enable_disable_access_rule",security:urcr_localized_data._nonce,rule_id:a,enabled:r};t.closest(".column-status").css({display:"flex","align-items":"center"}),n.append_spinner(t),e.ajax({url:urcr_localized_data.ajax_url,type:"POST",data:i,success:function(e){e.success?n.show_success_message(e.data.message):n.show_failure_message(e.data.message)},complete:function(){n.remove_spinner(t)}})})});var n={if_empty:function(e,t){return null===e||undefined===e||""===e?t:e},if_not_object:function(e,t){return null===e||undefined===e||"object"!=typeof e?t:e},if_not_json_object:function(e,t){return null===e||undefined===e||Array.isArray(e)||"object"!=typeof e?t:e},if_not_array:function(e,t){return null!==e&&undefined!==e&&Array.isArray(e)?e:t},init_all_tooltips:function(){var t={theme:"tooltipster-borderless",maxWidth:200,multiple:!0,interactive:!0,position:"bottom",contentAsHTML:!0,functionInit:function(e,t){var a=jQuery(t.origin).attr("data-tip");a&&e.content(a)}};e(".user-registration-help-tip").tooltipster(t)},init_all_enhanced_select:function(){var t=!1;e(".urcr-enhanced-select2").each(function(){var a=e(this).data("select2_class");e(this).select2({containerCssClass:a}).on("select2:selecting",function(){t=!0}).on("select2:unselecting",function(){t=!0}).on("select2:closing",function(){if(t&&this.multiple)return t=!1,!1})})},init_all_flatpickr:function(){e(".urcr-flatpickr").each(function(){n.init_a_flatpickr(e(this))})},init_a_flatpickr:function(t){"string"==typeof t&&""!==t&&(t=e(t));var a=t.data("mode"),r=!0===t.data("enable-time"),n=!0===t.data("no-calendar");value=t.val(),t.flatpickr({mode:a,enableTime:r,noCalender:n,defaultDate:value||""})},create_input_tag:function(e){return'<input name="'+e.id+'" type="text" class="'+e.inputClassName+'" value="'+e.value+'" style="'+e.style+'">'},create_anchor_tag:function(e){return'<a class="'+e.buttonClassName+'" '+e.buttonData+">"+e.buttonText+"</a>"},create_switch_tag:function(e){var t='<div class="'+e.divClassName+'">';return t+='<input id="'+e.id+'" type="checkbox" class="'+e.inputClassName+'" '+e.default_checked+"  "+e.disabled+">",t+='<label class="'+e.labelClassName+'" for="'+e.id+'"> '+e["default"]+" </label>",t+="</div>",t+='<div class="urcr-notice urcr-notice-warning"><p><b>Warning:</b> It will restrict the whole site.Please add the login shortcode in the action tab.</p></div>'},create_select_tag:function(e){var t=e.id?'id="'+e.id+'"':"",a=e.className?e.className:"",r=e.multiple?'multiple="multiple"':"",n="",i=e.options&&"object"==typeof e.options?e.options:{},l=e.data&&"object"==typeof e.data?e.data:{},o="",c=!0===e.prepend_empty_option?"<option></option>":"",s=e.attr&&"object"==typeof e.attr?e.attr:{},u="",_=e.style&&"string"==typeof e.style?'style="'+e.style+'"':"",d=e.value?e.value:"",p="";return Object.keys(s).forEach(function(e){u+=e+'="'+s[e]+'" '}),Object.keys(l).forEach(function(e){o+="data-"+e+'="'+l[e]+'" '}),n="<select "+t+' class="'+a+'" '+r+" "+o+" "+u+" "+_+">"+c,Object.keys(i).forEach(function(e){p=Array.isArray(d)&&d.includes(e)||d===e?'selected="selected"':"",n+='<option value="'+e+'" '+p+">"+i[e]+"</option>"}),n+="</select>"},generate_unique_string:function(e){return(e=n.if_empty(e,"x"))+(new Date).getTime()},resolve_smart_tags:function(e,t,r){var i;return r=n.if_not_array(r,[]),e&&t&&"object"==typeof t&&Object.keys(t).forEach(function(a){i=new RegExp("{{{"+a+"}}}","g"),e=e.replace(i,t[a])}),r&&Array.isArray(r)&&r.length&&r.forEach(function(t){t&&"object"==typeof t&&t.placeholder&&""!==t.placeholder?(i=new RegExp("{{{"+t.placeholder+":"+t.tag+"}}}","g"),e=(e=e.replace(i,t.value)).replaceAll("{{Class}}",t.tag),i=new RegExp("{{{"+t.placeholder+":[A-z0-9_]+}}}","g"),e=e.replace(i,"")):a&&console.warn("URCR: Invalid smart tag variable",t)}),e},show_success_message:function(e){return!!r&&(r.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!r&&(r.add({type:"failure",message:e,duration:6}),!0)},insert_template:function(e,t,a,r){a=n.if_not_json_object(a,{}),r=n.if_not_array(r,[]),e&&e.append&&(a.ID&&!0===a.ID&&(a.ID=n.generate_unique_string()),t=n.resolve_smart_tags(t,a,r),e.append(t))},append_spinner:function(e){if(e&&e.append){var t='<span class="ur-spinner is-active"></span>';return"checkbox"===e.attr("type")?e.after(t):e.append(t),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&("checkbox"===e.attr("type")?e.parent().find(".ur-spinner").remove():e.find(".ur-spinner").remove(),!0)},updateBrowserLocationURL:function(){if(t.rule_id){var e=new URLSearchParams(window.location.search);if(e.get("post-id")&&e.get("post-id")===t.rule_id.toString())return;e["delete"]("post-id"),e.set("post-id",t.rule_id),window.history.pushState({},"",window.location.origin+window.location.pathname+"?"+e.toString())}},toggleSaveButtons:function(t){t=n.if_empty(t,!0),e(".urcr-save-rule").prop("disabled",!!t),e(".urcr-save-rule-as-draft").prop("disabled",!!t)},validate_access_rule_form:function(a){var r=e(".urcr-content-access-rule-title-input").val().trim(),i={result:!0};return a=n.if_empty(a,!0),r&&""!==r||(i.result=!1,i.message=t.labels.title_is_required),a&&!i.result&&this.show_failure_message(i.message),i}},i={extract_rule_data:function(t){return{enabled:e("#urcr-enable-access-rule").is(":checked"),logic_map:this.extract_conditional_logic_map(t.find(".urcr-conditional-logic-map-container > .urcr-conditional-logic-item")),target_contents:this.extract_target_contents(t),actions:this.extract_rule_actions()}},extract_conditional_logic_map:function(t,a){var r=t.data("type"),l=t.data("store-id"),o={};if(a=n.if_empty(a,!1),t&&t instanceof jQuery&&(!a||l&&""!==l||(l=n.generate_unique_string()),r&&""!==r))if("group"===r){var c=t.children(".urcr-cld-wrapper").children(".urcr-conditional-logic-definitions").children(".urcr-conditional-logic-item"),s=[],u=t.find(".urcr-logic-gate-"+l+".is-active").data("value");c.each(function(){s.push(i.extract_conditional_logic_map(e(this)))}),o={type:"group",id:l,logic_gate:u,conditions:s}}else if("user_state"===r){var _=t.find(".urbg-item-"+l+".is-active");o={type:r,id:l,value:_.length?_.data("value"):null}}else"access_period"===r?($select_value=t.find("select").val(),$input_value=t.find("input").val(),$access_period_value={select:$select_value,input:$input_value},o={type:r,id:l,value:$access_period_value}):"ur_form_field"===r?($select_value=t.find("select").val(),$form_fields=[],$fields_row=t.find(".ur_form_fields_row"),$fields_row.length>0&&$fields_row.each(function(){var t={field_name:e(this).find(".urcr_form_field_name").val(),operator:e(this).find(".urcr_form_field_logic").val(),value:e(this).find(".urcr_form_field_value").val()};$form_fields.push(t)}),$ur_form_field_data={form_id:$select_value,form_fields:$form_fields},o={type:r,id:l,value:$ur_form_field_data}):o={type:r,id:l,value:t.find("select, input").val()};return o},extract_target_contents:function(t,a){var r,i,l,o,c=[];return a=n.if_empty(a,!0),t&&t instanceof jQuery&&($targets=t.find(".urcr-target-content"),$targets.length&&$targets.each(function(){r=e(this).data("store-id"),l=e(this).find(".urcr-content-target-input").val(),i=e(this).data("type"),r&&""!==r||!a||(r=n.generate_unique_string()),o={id:r,type:i,value:l},"taxonomy"===i&&(o.taxonomy=l,o.value=e(this).find(".urcr-terms-selector").val()),c.push(o)})),c},extract_rule_actions:function(t,a,r,i){var l=[];if(a=n.if_empty(a,!0),r=n.if_empty(r,!0),i=n.if_empty(i,!0),t||(t=e(".urcr-rule-actions-container")),t&&t instanceof jQuery){e("#urcr-rule-action-message-input-tmce").trigger("click");var o=t.find(".urcr-rule-action-type-input").val(),c=t.find('.urcr-rule-action-type-input option[value="'+o+'"]').text(),s=tinyMCE.get("urcr-rule-action-message-input"),u=s?s.getContent():"",_=e(".urcr-input-container .urcr-rule-access-control").val(),d=e(".urcrra-redirect-input-container .urcr-input").val(),p=e(".urcrra-redirect-to-local-page-input-container .urcr-input").val(),f=e(".urcrra-ur-form-input-container .urcr-input").val(),m=e(".urcrra-shortcode-input-container .urcr-input").val(),g=e(".urcrra-shortcode-input-container .urcrra-shortcode-args").val();a&&u&&""!==u&&(u=encodeURIComponent(u)),r&&d&&""!==d&&(d=encodeURIComponent(d)),i&&g&&""!==g&&(g=encodeURIComponent(g)),l.push({id:n.generate_unique_string(),type:o,label:c||"",message:u||"",redirect_url:d||"",access_control:_||"",local_page:p||"",ur_form:f||"",shortcode:{tag:m||"",args:g||""}})}return l}},l={render_access_rule:function(){var r=t.access_rule_data;t.rule_id&&""!==t.rule_id&&(e("h1.wp-heading-inline").text(t.labels.edit_access_rule),e(".urcr-content-access-rule-title-input").val(t.title),t.access_rule_data.enabled?(e("#urcr-enable-access-rule").attr("checked","checked"),e(".urcr-enable-access-rule-label").text(t.labels.enabled)):(e("#urcr-enable-access-rule").attr("checked",!1),e(".urcr-enable-access-rule-label").text(t.labels.disabled)),t.is_draft?e(".urcr-save-rule-as-draft").text(t.labels.save_draft):e(".urcr-save-rule").text(t.labels.save_rule)),t.is_draft&&e(".urcr-save-rule").text(t.labels.publish_rule),t.rule_id&&""!==t.rule_id&&r?(r.logic_map?this.render_conditional_logic_map(r.logic_map,e(".urcr-conditional-logic-map-container")):a&&console.warn("Logic map is unavailable",r.logic_map),r.actions?this.render_rule_actions(r.actions):a&&console.warn("Rule action is unavailable",r.actions),r.target_contents?this.render_target_contents(r.target_contents):a&&console.warn("Target contents are unavailable",r.target_contents),n.init_all_enhanced_select(),n.init_all_flatpickr(),n.init_all_tooltips()):(a&&!r&&t.rule_id&&console.warn("URCR: Content access rule data is unavailable. It means the rule was unable to be localized or parsed in the server. Could be because of invalid rule ID or invalid rule data.",r),o.add_new_group(e(".urcr-conditional-logic-map-container"))),e(".urcr-widget-header-label").first().text(t.labels.main_logic_group),e(".urcr-spinner-container").remove(),e(".urcrcl-trash").first().remove()},render_conditional_logic_map:function(t,a){if(a=n.if_empty(a,e(".urcr-conditional-logic-map-container")),t&&a&&a instanceof jQuery){if("group"===t.type){o.add_new_group(a,t),a=e("#urcr-conditional-logic-definitions-"+t.id);for(var r=0;r<t.conditions.length;r++){var i=t.conditions[r];this.render_conditional_logic_map(i,a)}}else o.add_new_field(t.type,a,t);return!0}return!1},render_target_contents:function(t,a){if(a=n.if_empty(a,e(".urcr-target-contents-container")),t&&a&&a instanceof jQuery){for(var r=0;r<t.length;r++){var i=t[r];i.type&&c.add_new_target(i.type,a,i)}return!0}return!1},render_rule_actions:function(t,a){if(a=n.if_empty(a,e(".urcr-rule-actions-container")),t&&Array.isArray(t)&&a&&a instanceof jQuery){for(var r=0;r<t.length;r++){var i=t[r];i.type,e(".urcr-rule-action-type-input").val(i.type),e(".urcrra-ur-form-input").val(i.ur_form),e(".urcrra-shortcode-input").val(i.shortcode.tag),e(".urcrra-shortcode-args").val(decodeURIComponent(i.shortcode.args)),e(".urcrra-redirect-input-container .urcr-input").val(decodeURIComponent(i.redirect_url)),e(".urcrra-redirect-to-local-page-input-container .urcr-input").val(i.local_page);for(r=0;r<tinymce.editors.length;r+=1){var l=tinymce.editors[r];if("urcr-rule-action-message-input"===l.id){l.on("init",function(e){e.target.setContent(decodeURIComponent(i.message))});break}}s.updateToggleRuleActionInput(i.type)}return!0}return!1}},o={init:function(){this.init_conditional_logic_field_creation_handler(),this.init_conditional_logic_ur_form_field_handler(),this.init_conditional_logic_group_creation_handler(),this.init_conditional_logic_field_deletion_handler()},init_conditional_logic_ur_form_field_handler:function(){e(document.body).on("change",".urcr-ur-form-field-selector",function(){e(this).closest(".urcr-input-container").find(".ur_form_fields_row").remove();var t=e(this).val();o.add_new_form_field(t,this,[])}),e(document.body).on("change","#urcr_form_field_logic",function(){var t=e(this);e(this).siblings(".urcr_form_field_value").show(),"empty"!==t.val()&&"not empty"!==t.val()||t.siblings(".urcr_form_field_value").hide()}),e(document.body).on("click",".urcr_add_new_form_field_button",function(){var t=e(this).data("form-id");o.add_new_form_field(t,this,[])}),e(document.body).on("click",".urcr_remove_form_field_button",function(){e(this).closest(".urcr-input-container").find(".ur_form_fields_row").length>1&&e(this).closest(".ur_form_fields_row").remove()})},init_conditional_logic_field_creation_handler:function(){e(document.body).on("change",".urcr-add-new-conditional-logic-field",function(){var t=e(this).val();o.add_new_field(t,e(this).closest(".urcr-settings-widget").children(".urcr-cld-wrapper").children(".urcr-conditional-logic-definitions")),n.init_all_enhanced_select(),n.init_all_flatpickr(),n.init_all_tooltips()})},init_conditional_logic_group_creation_handler:function(){e(document.body).on("click",".urcr-add-new-conditional-logic-group",function(){var t=e(this).closest(".urcr-settings-widget").children(".urcr-cld-wrapper").children(".urcr-conditional-logic-definitions");o.add_new_group(t)})},init_conditional_logic_field_deletion_handler:function(){e(document.body).on("click",".urcrcl-trash",function(){$this=e(this),$this.closest(".urcr-conditional-logic-item").is(".urcr-conditional-logic-map-container > .urcr-settings-widget")||Swal.fire({title:t.labels.are_you_sure,text:t.labels.clfog_deletion_message,icon:"warning",customClass:{confirmButton:"button button-danger",cancelButton:"button button-secondary ur-mr-1"},showCancelButton:!0,confirmButtonText:t.labels["delete"],reverseButtons:!0}).then(function(t){t.value&&$this.closest(".urcr-conditional-logic-item").fadeOut({complete:function(){e(this).remove()}})})})},add_new_form_field:function(a,r,i){var l=t.ur_form_data[a]?t.ur_form_data[a]:{};inputHtml='<div class="ur_form_fields_row">',inputHtml+=n.create_select_tag({options:l,className:"urcr_form_field_name",value:i.field_name?i.field_name:[]});inputHtml+=n.create_select_tag({options:{is:"is","is not":"is not",empty:"empty","not empty":"not empty"},id:"urcr_form_field_logic",className:"urcr_form_field_logic",value:i.operator?i.operator:[]}),inputHtml+=n.create_input_tag({divClassName:"ur-ml-auto",inputClassName:"urcr_form_field_value",labelClassName:"",value:i.value?i.value:"",style:["empty","not empty"].includes(i.operator)?"display:none":"",id:"urcr_form_field_value"}),inputHtml+=n.create_anchor_tag({buttonClassName:"urcr_add_new_form_field_button",buttonData:'data-form-id="'+a+'"',buttonText:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> <path fill="#000" d="M12 21.95c-.6 0-1-.4-1-1v-8H3.1c-.6 0-1-.4-1-1s.4-1 1-1H11v-7.9c0-.6.4-1 1-1s1 .4 1 1v7.9h7.9c.6 0 1 .4 1 1s-.4 1-1 1H13v8c0 .6-.4 1-1 1Z"/> </svg>'}),inputHtml+=n.create_anchor_tag({buttonClassName:"urcr_remove_form_field_button",buttonData:'data-form-id="'+a+'"',buttonText:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> <path fill="#000" d="M20.9 13H3.1c-.6 0-1-.4-1-1s.4-1 1-1h17.8c.6 0 1 .4 1 1s-.4 1-1 1Z"/> </svg>'}),inputHtml+="</div>",e(r).closest(".urcr-input-container").find(".urcr-form-fields-wrapper").append(inputHtml),n.init_all_enhanced_select()},add_new_group:function(e,a){a=n.if_not_json_object(a,{});var r=t.templates.conditional_logic_group_template,i={ID:!a.id||a.id},l=[{placeholder:"logic_gate",tag:a.logic_gate?a.logic_gate:"",value:"is-active"}];n.insert_template(e,r,i,l)},add_new_field:function(t,a,r){switch(e("#"+a[0].id).closest(".inside").find("p.urcr-conditional-logic-warning").remove(),r=n.if_not_json_object(r,{}),t){case"roles":this.add_new_roles_field(a,r);break;case"user_registered_date":this.add_new_user_registered_date_picker(a,r);break;case"access_period":this.add_new_access_period_selector(a,r);break;case"user_state":this.add_new_user_state_selector(a,r);break;case"profile_completeness":this.add_new_profile_completeness_selector(a,r);break;case"email_domain":this.add_new_email_domain_selector(a,r);break;case"post_count":this.add_new_post_count_selector(a,r);break;case"capabilities":this.add_new_capabilities_selector(a,r);break;case"registration_source":this.add_new_registration_source_selector(a,r);break;case"ur_form_field":this.add_new_ur_form_field_selector(a,r);break;case"payment_status":this.add_new_payment_status_field_selector(a,r);break;case"membership":this.add_new_membership_field_selector(a,r)}},add_new_roles_field:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 urcrcl-roles-selector widefat",multiple:!0,options:t.wp_roles,value:a.value?a.value:[]}),i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.roles,type:"roles",tooltip:t.labels.roles_tooltip})},add_new_user_registered_date_picker:function(e,a){var r='<input class="urcr-flatpickr urcrcl-user-registered-date-picker widefat" type="text" data-mode="range" '+((a=n.if_not_json_object(a,{})).value?'value="'+a.value+'"':"")+"/>",i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.user_registered_date,type:"user_registered_date",tooltip:t.labels.registered_date_tooltip})},add_new_access_period_selector:function(e,a){var r="undefined"!=typeof(a=n.if_not_json_object(a,{})).value&&""!==a.value?'value="'+a.value.input+'"':"",i="undefined"!=typeof a.value&&""!==a.value&&"During"==a.value.select?"selected=true":"",l="undefined"!=typeof a.value&&""!==a.value&&"After"==a.value.select?"selected=true":"";inputHtml='<select><option value="During" '+i+'>During</option><option value="After"  '+l+'>After</option></select><input type="number" min="1" '+r+"/> Days",template=t.templates.conditional_logic_field_template,n.insert_template(e,template,{ID:!a.id||a.id,input:inputHtml,label:t.labels.access_period,type:"access_period",tooltip:t.labels.access_period_tooltip})},add_new_user_state_selector:function(e,a){a=n.if_not_json_object(a,{});var r=t.templates.conditional_logic_field_template,i=ur_create_toggle_buttons({id:a.id?a.id:n.generate_unique_string(),className:"urcr-user-state",value:a.value,buttons:[{text:t.labels.logged_in,value:"logged-in"},{text:t.labels.logged_out,value:"logged-out"}]});n.insert_template(e,r,{ID:!a.id||a.id,input:i,label:t.labels.user_state,type:"user_state",tooltip:t.labels.user_state_tooltip})},add_new_payment_status_field_selector:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 widefat",multiple:!0,options:t.payment_status,value:a.value?a.value:[]}),i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.payment_status,type:"payment_status",tooltip:t.labels.payment_status_tooltip})},add_new_membership_field_selector:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 widefat",multiple:!0,options:t.memberships,value:a.value?a.value:[]}),i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.membership,type:"membership",tooltip:t.labels.membership_tooltip})},add_new_profile_completeness_selector:function(e,a){var r="undefined"!=typeof(a=n.if_not_json_object(a,{})).value&&""!==a.value?'value="'+a.value+'"':"";inputHtml='More than&nbsp;<input type="number" min="1" max="100" '+r+"/>&nbsp;%",template=t.templates.conditional_logic_field_template,n.insert_template(e,template,{ID:!a.id||a.id,input:inputHtml,label:t.labels.profile_completeness,type:"profile_completeness",tooltip:t.labels.profile_completeness_tooltip})},add_new_email_domain_selector:function(e,a){var r='<input class="urcrcl-email-domain-selector widefat" type="text" placeholder="Eg. gmail.com, yahoo.com"'+((a=n.if_not_json_object(a,{})).value?'value="'+a.value+'"':"")+"/>",i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.email_domain,type:"email_domain",tooltip:t.labels.email_domains_tooltip})},add_new_post_count_selector:function(e,a){var r='<input class="urcrcl-post-count-selector" type="number" min="0" value="'+((a=n.if_not_json_object(a,{})).value?a.value:0)+'"/>',i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.post_count,type:"post_count",tooltip:t.labels.min_post_count_tooltip})},add_new_capabilities_selector:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 urcrcl-capabilities-selector widefat",multiple:!0,options:t.wp_capabilities,value:a.value?a.value:[]}),i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.capabilities,type:"capabilities",tooltip:t.labels.capabilities_tooltip})},add_new_registration_source_selector:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 urcrcl-rigistration-source-selector widefat",multiple:!0,options:t.registration_sources,value:a.value?a.value:[]}),i=t.templates.conditional_logic_field_template;n.insert_template(e,i,{ID:!a.id||a.id,input:r,label:t.labels.registration_source,type:"registration_source",tooltip:t.labels.registration_source_tooltip})},add_new_ur_form_field_selector:function(a,r){r=n.if_not_json_object(r,{});var i=n.create_select_tag({className:"urcr-enhanced-select2 urcr-ur-form-field-selector widefat",options:t.ur_forms,prepend_empty_option:!0,data:{placeholder:"Select a Form..."},value:r.hasOwnProperty("value")&&r.value.hasOwnProperty("form_id")?r.value.form_id:[]});i+='<div class="urcr-form-fields-wrapper"></div>',template=t.templates.conditional_logic_field_template,n.insert_template(a,template,{ID:!r.id||r.id,input:i,label:t.labels.ur_form_field,type:"ur_form_field",tooltip:t.labels.ur_form_field_tooltip}),$form_field_data=r.hasOwnProperty("value")&&r.value.hasOwnProperty("form_fields")?r.value.form_fields:[],$form_field_data.length>0&&e($form_field_data).each(function(t,a){$selector=e("#urcr-conditional-logic-field-"+r.id).find(".urcr-ur-form-field-selector"),o.add_new_form_field(r.value.form_id,$selector,a)})}},c={init:function(){this.init_target_content_creation_handler(),this.init_subfield_creation_handler(),this.init_target_content_deletion_handler()},init_target_content_creation_handler:function(){e(document.body).on("change",".urcr-add-new-target-contents",function(){var t=e(this).val();c.add_new_target(t,e(this).closest(".urcr-settings-widget").find(".urcr-target-contents-container")),n.init_all_enhanced_select(),n.init_all_tooltips()})},init_subfield_creation_handler:function(){e(document.body).on("change",".urcr-taxonomy-selector",function(){var a=e(this).val(),r=t.terms_list[a]?t.terms_list[a]:{},i=n.create_select_tag({className:"urcr-enhanced-select2 urcr-content-target-input urcr-terms-selector widefat",multiple:!0,options:r,data:{select2_class:"urcr-terms-selector-select2"}});e(this).closest(".urcr-input-container").find(".urcr-terms-selector").remove(),e(this).closest(".urcr-input-container").find(".urcr-terms-selector-select2").closest(".select2-container").remove(),e(this).closest(".urcr-input-container").append(i),n.init_all_enhanced_select()})},init_target_content_deletion_handler:function(){e(document.body).on("click",".urcr-trash-target-content",function(){var a=e(this);Swal.fire({title:t.labels.are_you_sure,text:t.labels.cannot_revert,icon:"warning",customClass:{confirmButton:"button button-danger",cancelButton:"button button-secondary ur-mr-1"},showCancelButton:!0,confirmButtonText:t.labels["delete"],reverseButtons:!0}).then(function(t){t.value&&a.closest(".urcr-target-content").fadeOut({complete:function(){e(this).remove()}})})})},add_new_target:function(e,t,a){switch(a=n.if_not_json_object(a,{}),e){case"post_types":this.add_new_post_types_target(t,a);break;case"taxonomy":this.add_new_taxonomy_target(t,a);break;case"wp_posts":this.add_new_post_targets_picker(t,a);break;case"wp_pages":this.add_new_page_targets_picker(t,a);break;case"whole_site":this.add_new_whole_site_targets_picker(t,a)}},add_new_post_types_target:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 urcr-content-target-input urcrcl-roles-selector widefat",multiple:!0,options:t.post_types,value:a.value}),i=t.templates.target_content_template;n.insert_template(e,i,{ID:!0,input:r,label:t.labels.post_types,type:"post_types",tooltip:t.labels.post_types_tooltip})},add_new_taxonomy_target:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 urcr-content-target-input urcr-taxonomy-selector widefat",options:t.taxonomies,prepend_empty_option:!0,data:{placeholder:"Select a taxonomy..."},value:a.taxonomy}),i=t.terms_list[a.taxonomy]?t.terms_list[a.taxonomy]:{},l="",o=t.templates.target_content_template;a.taxonomy&&""!==a.taxonomy&&(l=n.create_select_tag({className:"urcr-enhanced-select2 urcr-content-target-input urcr-terms-selector widefat",multiple:!0,options:i,data:{select2_class:"urcr-terms-selector-select2"},value:a.value})),n.insert_template(e,o,{ID:!0,input:r+l,label:t.labels.taxonomy,type:"taxonomy",tooltip:t.labels.taxonomy_tooltip})},add_new_post_targets_picker:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 urcr-content-target-input urcrcl-capabilities-selector widefat",multiple:!0,options:t.posts,value:a.value}),i=t.templates.target_content_template;n.insert_template(e,i,{ID:!0,input:r,label:t.labels.pick_posts,type:"wp_posts",tooltip:t.labels.pick_posts_tooltip})},add_new_page_targets_picker:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_select_tag({className:"urcr-enhanced-select2 urcr-content-target-input urcrcl-capabilities-selector widefat",multiple:!0,options:t.pages,value:a.value});template=t.templates.target_content_template,n.insert_template(e,template,{ID:!0,input:r,label:t.labels.pick_pages,type:"wp_pages",tooltip:t.labels.pick_pages_tooltip})},add_new_whole_site_targets_picker:function(e,a){a=n.if_not_json_object(a,{});var r=n.create_switch_tag({divClassName:"user-registration-switch ur-ml-auto",inputClassName:"user-registration-switch__control hide-show-check enabled",labelClassName:"urcr-enable-access-rule-label",default_checked:'checked="checked"',disabled:'disabled="true"',"default":"Enabled",id:"urcr_whole_site_restriction"});template=t.templates.target_content_template,n.insert_template(e,template,{ID:!0,input:r,label:t.labels.whole_site,type:"whole_site",tooltip:t.labels.whole_site_tooltip})}},s={init:function(){this.fill_options(),this.init_rule_action_input_switcher()},fill_options:function(){var a=n.create_select_tag({className:"urcr-enhanced-select2 urcr-input urcrra-ur-form-input",options:t.ur_forms,prepend_empty_option:!0,data:{placeholder:t.labels.select_ur_form},style:"width: 100% !important;"}),r=n.create_select_tag({className:"urcr-enhanced-select2 urcr-input urcrra-shortcode-input",options:t.shortcodes,prepend_empty_option:!0,data:{placeholder:t.labels.select_ur_shortcode},style:"width: 100% !important;"}),i='<input class="widefat urcrra-shortcode-args" type="text" placeholder="'+t.labels.enter_shortcode_args+'">',l=n.create_select_tag({className:"urcr-enhanced-select2 urcr-input urcrra-redirect-to-local-page-input",options:t.pages,prepend_empty_option:!0,data:{placeholder:t.labels.select_a_page},style:"width: 100% !important;"});e(".urcrra-ur-form-input-container .urcr-body").html(a),e(".urcrra-shortcode-input-container .urcr-body").html(r+i),e(".urcrra-redirect-to-local-page-input-container .urcr-body").html(l)},init_rule_action_input_switcher:function(){e(document.body).on("change",".urcr-rule-action-type-input",function(){s.updateToggleRuleActionInput(e(this).val())})},updateToggleRuleActionInput:function(t){var a=null;switch(t){case"message":a=e(".urcrra-message-input-container");break;case"redirect":a=e(".urcrra-redirect-input-container");break;case"redirect_to_local_page":a=e(".urcrra-redirect-to-local-page-input-container");break;case"ur-form":a=e(".urcrra-ur-form-input-container");break;case"shortcode":a=e(".urcrra-shortcode-input-container")}e(".urcr-rule-action-input-container.urcr-active").slideUp(400),e(".urcr-rule-action-input-container.urcr-active").removeClass("urcr-active"),a&&(a.slideDown(400),a.addClass("urcr-active"))}},u={init:function(){this.init_access_rule_state_label_toggler(),this.init_toggle_animate_title_editor_handler(),this.init_tabs_switcher(),this.init_widgets_toggler(),e(document.body).on("urcr_initializations_complete",function(){u.enable_constant_selection()})},init_access_rule_state_label_toggler:function(){e(document.body).on("change","#urcr-enable-access-rule",function(){e(this).is(":checked")?e(".urcr-enable-access-rule-label").text(t.labels.enabled):e(".urcr-enable-access-rule-label").text(t.labels.disabled)})},init_toggle_animate_title_editor_handler:function(){e(document.body).on("click",".user-registration-editable-title__icon",function(){var t=e(this).siblings(".user-registration-editable-title__input");t.hasClass("is-editing")||t.trigger("focus"),t.toggleClass("is-editing")})},init_tabs_switcher:function(){e(document.body).on("click",".urcr-nav-tab-wrapper .urcr-tab",function(t){if(t.preventDefault(),!e(this).is(".nav-tab-active")){e(".urcr-nav-tab-wrapper .urcr-tab.nav-tab-active").removeClass("nav-tab-active"),e(this).addClass("nav-tab-active");var a=e(this).data("tab-content-selector");a&&(e(".urcr-tab-contents-wrapper .urcr-tab-content.urcr-tab-content-active").slideUp(300),e(a).removeAttr("hidden").slideDown(300),e(".urcr-tab-contents-wrapper .urcr-tab-content.urcr-tab-content-active").removeClass("urcr-tab-content-active"),e(a).addClass("urcr-tab-content-active")),n.init_all_enhanced_select()}})},init_widgets_toggler:function(){var t=["select","input","button","option"];e(document.body).on("click",".urcr-settings-widget .urcr-settings-widget-header",function(a){t.includes(a.target.tagName.toLowerCase())||e(a.target).is(".urcrcl-trash")||e(a.target).closest(".select2").length||e(a.target).is(".urbg-item")||(e(this).closest(".urcr-settings-widget").toggleClass("closed"),n.init_all_enhanced_select())})},enable_constant_selection:function(){e(document.body).on("change",".urcr-constant-selection-enabled",function(){e(this).find(".urcr-logic-field-placeholder").prop("selected",!0)})}},_={create_rule:function(a){if(n.validate_access_rule_form().result){a=n.if_empty(a,e(".urcr-content-access-rule-creator-form"));var r=i.extract_rule_data(a),l=e(".urcr-save-rule");n.append_spinner(l),n.toggleSaveButtons(!0),this.send_data({action:"urcr_create_access_rule",title:e(".urcr-content-access-rule-title-input").val(),access_rule_data:JSON.stringify(r)},{success:function(a){t.rule_id=a.data.rule_id,n.updateBrowserLocationURL(),l.text(t.labels.save_rule),e("h1.wp-heading-inline").text(t.labels.edit_access_rule),e(".urcr-save-rule-as-draft").remove(),a.success?n.show_success_message(a.data.message):n.show_failure_message(a.data.message)},failure:function(e,a){n.show_failure_message(t.labels.network_error+" ("+a+")")},complete:function(){n.remove_spinner(l),n.toggleSaveButtons(!1)}})}},save_rule:function(r){if(n.validate_access_rule_form().result)if(t.rule_id&&""!==t.rule_id){r=n.if_empty(r,e(".urcr-content-access-rule-creator-form"));var l=i.extract_rule_data(r),o=e(".urcr-save-rule"),c=function(){n.append_spinner(o),n.toggleSaveButtons(!0),this.send_data({action:"urcr_save_access_rule",rule_id:t.rule_id,title:e(".urcr-content-access-rule-title-input").val(),access_rule_data:JSON.stringify(l)},{success:function(a){e(".urcr-save-rule-as-draft").remove(),o.text(t.labels.save_rule),a.success?n.show_success_message(a.data.message):n.show_failure_message(a.data.message)},failure:function(e,a){n.show_failure_message(t.labels.network_error+" ("+a+")")},complete:function(){n.remove_spinner(o),n.toggleSaveButtons(!1)}})}.bind(this);t.is_draft?Swal.fire({title:t.labels.are_you_sure,text:t.labels.publish_draft_warning,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:t.labels.publish}).then(function(e){e.value&&(t.is_draft=!1,c())}):c()}else a&&console.error("Rule cannot be saved without an ID",t.rule_id)},save_rule_as_draft:function(a){if(n.validate_access_rule_form().result){a=n.if_empty(a,e(".urcr-content-access-rule-creator-form"));var r=i.extract_rule_data(a),l=e(".urcr-save-rule-as-draft"),o=e(".urcr-save-rule");n.append_spinner(l),n.toggleSaveButtons(!0),this.send_data({action:"urcr_save_access_rule_as_draft",rule_id:t.rule_id&&""!==t.rule_id?t.rule_id:"",title:e(".urcr-content-access-rule-title-input").val(),access_rule_data:JSON.stringify(r)},{success:function(e){t.rule_id=e.data.rule_id,n.updateBrowserLocationURL(),o.text(t.labels.publish_rule),l.text(t.labels.save_draft),t.is_draft=!0,e.success?n.show_success_message(e.data.message):n.show_failure_message(e.data.message)},failure:function(e,a){n.show_failure_message(t.labels.network_error+" ("+a+")")},complete:function(){n.remove_spinner(l),n.toggleSaveButtons(!1)}})}},send_data:function(a,r){var n="function"==typeof r.success?r.success:function(){},i="function"==typeof r.failure?r.failure:function(){},l="function"==typeof r.beforeSend?r.beforeSend:function(){},o="function"==typeof r.complete?r.complete:function(){};!a._wpnonce&&t&&(a._wpnonce=t._nonce),e.ajax({type:"post",dataType:"json",url:t.ajax_url,data:a,beforeSend:l,success:n,error:i,complete:o})}}}(jQuery,window.urcr_localized_data,window.urcr_localized_data.URCR_DEBUG);