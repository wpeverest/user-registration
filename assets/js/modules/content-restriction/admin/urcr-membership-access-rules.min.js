!function(e){"use strict";var t={conditions:[],contentTargets:[],accessControl:"access",membershipId:0,conditionCounter:0,targetCounter:0,ruleData:null,initialized:!1,init:function(){var t=this;if("undefined"!=typeof urcr_membership_access_data){urcr_membership_access_data.membership_id&&(t.membershipId=parseInt(urcr_membership_access_data.membership_id,10));var r=null;if(void 0!==window.urcrMembershipRuleData&&window.urcrMembershipRuleData)r=window.urcrMembershipRuleData;else{var a=e("#ur-membership-access-section");if(a.length){var i=a.attr("data-rule-data");i&&(r=JSON.parse(i))}}var n=e(".urcr-conditions-list"),o=e(".urcr-target-type-group"),s=n.find(".urcr-condition-wrapper").length>0,c=o.find(".urcr-target-item").length>0;s||c?t.syncFromExistingHTML():r?(t.ruleData=r,t.populateRuleData(r)):t.initializeEmptyRule(),t.bindEvents(),t.initSelect2(),t.initActionSection(),t.initialized=!0,t.dripInit()}},initializeEmptyRule:function(){var e=this;e.membershipId>0&&e.addCondition("membership",!0,[e.membershipId.toString()])},syncFromExistingHTML:function(){var t=this;e(".urcr-condition-wrapper").each(function(){var r=e(this),a=r.data("condition-id"),i=r.find(".urcr-condition-field-select"),n=r.find(".urcr-condition-value-input"),o=i.val()||"roles",s="multiselect",c=t.getConditionOptions().find(function(e){return e.value===o});c&&(s=c.type||"multiselect");var d="";if("multiselect"===s){var l=n.attr("data-value");if(l)try{d=JSON.parse(l)}catch(e){d=[]}else d=[]}else if("checkbox"===s)d=n.find('input[type="radio"]:checked').val()||"logged-in";else if("date"===s||"number"===s||"text"===s)d=n.val()||"";else if("period"===s){d={select:n.find('[data-period-part="select"]').val()||"During",input:n.find('[data-period-part="input"]').val()||""}}t.conditions.push({id:a,type:o,value:d,isLocked:!1}),"multiselect"===s&&t.initConditionSelect2(a,s,d)}),e(".urcr-target-item").each(function(){var r=e(this),a=r.data("target-id"),i=r.find(".urcr-target-type-label"),n="",o=i.length?i.text().toLowerCase():"";if(-1!==o.indexOf("pages"))n="pages";else if(-1!==o.indexOf("posts"))n="posts";else if(-1!==o.indexOf("post type"))n="post_types";else if(-1!==o.indexOf("taxonomy"))n="taxonomy";else if(-1!==o.indexOf("whole site"))n="whole_site";else{var s=r.find(".urcr-content-target-input");s.length&&(n=s.data("content-type")||s.data("field-type")||""),!n&&r.find("span").length&&-1!==r.text().indexOf("Whole Site")&&(n="whole_site")}var c="";if("whole_site"===n)c="whole_site";else if("taxonomy"===n){var d=r.find(".urcr-taxonomy-select").val()||"",l=r.find(".urcr-content-target-input").attr("data-value"),u=[];if(l)try{u=JSON.parse(l)}catch(e){u=[]}c={taxonomy:d,value:u}}else{var p=r.find(".urcr-content-target-input").attr("data-value");if(p)try{c=JSON.parse(p)}catch(e){c=[]}else c=[]}t.contentTargets.push({id:a,type:n,value:c}),"whole_site"!==n&&setTimeout(function(){t.initContentTargetSelect2(a,n,c)},100)})},populateRuleData:function(t){var r=this;if(e(".urcr-conditions-list").empty(),e(".urcr-target-type-group").empty(),r.conditions=[],r.contentTargets=[],t.access_control?(r.accessControl=t.access_control,r.updateAccessControlClass()):(r.accessControl="access",r.updateAccessControlClass()),t.logic_map&&t.logic_map.conditions&&t.logic_map.conditions.length>0){var a=t.logic_map.conditions;a.sort(function(e,t){return"membership"===e.type?-1:"membership"===t.type?1:0}),a.forEach(function(e,t){var i=a[0],n=i&&"membership"===i.type&&0===t,o=e.value;Array.isArray(o)||"object"==typeof o&&null!==o||(o=o||""),r.addCondition(e.type,n,o,e.id)})}else r.membershipId>0&&r.addCondition("membership",!0,[r.membershipId.toString()]);t.target_contents&&t.target_contents.length>0&&t.target_contents.forEach(function(e){var t=e.type;"wp_pages"===t&&(t="pages"),"wp_posts"===t&&(t="posts");var a=e.value||("whole_site"===t?"whole_site":[]);"taxonomy"===t?e.taxonomy?a={taxonomy:e.taxonomy,value:Array.isArray(e.value)?e.value:[]}:"object"!=typeof e.value||null===e.value||Array.isArray(e.value)||e.value.taxonomy&&(a={taxonomy:e.value.taxonomy,value:Array.isArray(e.value.value)?e.value.value:[]}):"whole_site"!==t&&(Array.isArray(a)||(a=a?[a]:[])),r.addContentTarget(t,a,e.id)})},bindEvents:function(){var t=this;e(document).on("click",".urcr-add-condition-button",function(e){e.preventDefault(),t.addCondition("roles",!1,"")}),e(document).on("keydown",".urcr-add-condition-button",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.addCondition("roles",!1,""))}),e(document).on("click",".urcr-condition-remove",function(r){r.preventDefault();var a=e(this).closest(".urcr-condition-wrapper").data("condition-id");t.removeCondition(a)}),e(document).on("change",".urcr-condition-field-select",function(){var r=e(this).closest(".urcr-condition-wrapper").data("condition-id"),a=e(this).val();t.updateConditionType(r,a)}),e(document).on("change",".urcr-condition-value-input",function(){var r=e(this).closest(".urcr-condition-wrapper");if(r.length){var a=r.data("condition-id");t.updateConditionValue(a,e(this))}}),e(document).on("change",".urcr-period-input-group input, .urcr-period-input-group select",function(){var r=e(this).closest(".urcr-condition-wrapper");if(r.length){var a=r.data("condition-id"),i=e(this).closest(".urcr-period-input-group"),n={select:i.find('[data-period-part="select"]').val()||"During",input:i.find('[data-period-part="input"]').val()||""},o=t.conditions.find(function(e){return e.id===a});o&&(o.value=n)}}),e(document).on("click",".urcr-add-content-button",function(r){r.preventDefault(),t.showContentTypeDropdown(e(this))}),e(document).on("click",".urcr-target-remove",function(r){r.preventDefault();var a=e(this).closest(".urcr-target-item").data("target-id");t.removeContentTarget(a)}),e(document).on("click",".urcr-content-type-option",function(r){r.preventDefault();var a=e(this).data("content-type");t.addContentTarget(a),e(".urcr-content-type-dropdown-menu").removeClass("ur-d-flex").addClass("ur-d-none")}),e(document).on("keydown",".urcr-content-type-option",function(r){if("Enter"===r.key||" "===r.key){r.preventDefault();var a=e(this).data("content-type");t.addContentTarget(a),e(".urcr-content-type-dropdown-menu").removeClass("ur-d-flex").addClass("ur-d-none")}}),e(document).on("click",function(t){e(t.target).closest(".urcr-content-dropdown-wrapper").length||e(t.target).closest(".urcr-add-content-button").length||e(".urcr-content-type-dropdown-menu").removeClass("ur-d-flex").addClass("ur-d-none")}),e(document).on("change",".urcr-action-type-select",function(){var r=e(this).val()||"message";t.handleActionTypeChange(r)}),e(document).on("change",'input[name="urcr-membership-message-type"]',function(){var t=e(this).val(),r=e(".urcrra-message-input-container");if(e('input[name="urcr-membership-message-type"]').closest(".urcr-checkbox-radio-option").removeClass("is-checked"),e(this).closest(".urcr-checkbox-radio-option").addClass("is-checked"),"global"===t)r.removeClass("ur-d-flex").addClass("ur-d-none"),r.hide();else if("custom"===t){r.removeClass("ur-d-none").addClass("ur-d-flex"),r.show();var a="",i=e("#urcr-membership-action-message");if("undefined"!=typeof wp&&wp.editor&&i.length){var n=window.tinymce&&window.tinymce.get("urcr-membership-action-message");a=n?n.getContent():wp.editor.getContent("urcr-membership-action-message")}else a=i.val()||"";if(!a||""===a.trim()){var o="";"undefined"!=typeof urcr_membership_access_data&&urcr_membership_access_data.membership_default_message&&(o=urcr_membership_access_data.membership_default_message),o&&setTimeout(function(){if(i.length){var e=window.tinymce&&window.tinymce.get("urcr-membership-action-message");e?e.setContent(o):wp.editor.setContent("urcr-membership-action-message",o)}else i.val(o)},100)}}})},addCondition:function(t,r,a,i){var n=this;if(t||(t="roles"),"membership"!==t){i||(i="x"+Date.now()+"_"+n.conditionCounter++);var o=n.getConditionOptions();if(o&&0!==o.length){var s=o.find(function(e){return e.value===t});s||(s=o[0],t=s.value);var c=s.type||"multiselect",d=!1,l=n.getConditionRowHtml(i,t,s.label,c,a||"",d),u=e(".urcr-conditions-list");0!==u.length&&(u.append(l),n.initConditionSelect2(i,c,a),n.conditions.push({id:i,type:t,value:a||"",isLocked:d}))}}},getConditionRowHtml:function(e,t,r,a,i,n){var o=this.getConditionOptions(),s="";n||(s='<button type="button" class="button button-link-delete urcr-condition-remove" aria-label="Remove condition"><span class="dashicons dashicons-no-alt"></span></button>');var c='<select class="urcr-condition-field-select urcr-condition-value-input"'+(n?" disabled":"")+">";o.forEach(function(e){var r=e.value===t?"selected":"";c+='<option value="'+e.value+'" '+r+">"+e.label+"</option>"}),c+="</select>";var d=this.getConditionValueInputHtml(e,a,t,i,n);return'<div class="urcr-condition-wrapper" data-condition-id="'+e+'"><div class="urcr-condition-row ur-d-flex ur-mt-2 ur-align-items-start"><div class="urcr-condition-only ur-d-flex ur-align-items-start"><div class="urcr-condition-selection-section ur-d-flex ur-align-items-center ur-g-4"><div class="urcr-condition-field-name">'+c+'</div><div class="urcr-condition-operator"><span>is</span></div><div class="urcr-condition-value">'+d+"</div></div></div></div>"+s+"</div>"},getConditionValueInputHtml:function(t,r,a,i,n){var o="",s=n?" disabled":"";if("ur_form_field"===a){var c="";i&&"object"==typeof i&&(c=i.form_id||"",i.form_fields||[]);var d=i?JSON.stringify(i):'{"form_id":"","form_fields":[]}',l=' data-value="'+e("<div>").text(d).html()+'"',u=urcr_membership_access_data.ur_forms||{};for(var p in o='<div class="urcr-ur-form-field-condition" data-condition-id="'+t+'"'+l+">",o+='<div class="urcr-form-selection ur-d-flex ur-align-items-center ur-g-4 ur-mb-2">',o+='<select class="urcr-form-select components-select-control__input urcr-condition-value-input"'+s+">",o+='<option value="">Select a form</option>',u){if(u.hasOwnProperty(p))o+='<option value="'+p+'" '+(p===c?"selected":"")+">"+u[p]+"</option>"}o+="</select>",o+="</div>",o+='<div class="urcr-form-fields-list"></div>',o+="</div>"}else if("multiselect"===r)o='<select class="urcr-enhanced-select2 urcr-condition-value-input" multiple data-condition-id="'+t+'" data-field-type="'+a+'" '+s+"></select>";else if("checkbox"===r){var m="logged-out"===i||"logged_out"===i?"checked":"";o='<div class="urcr-checkbox-radio-input"><label><input type="radio" name="condition_'+t+'_user_state" value="logged-in" '+("logged-in"===i||"logged_in"===i||""===i?"checked":"")+" "+s+"> "+(urcr_membership_access_data.labels.logged_in||"Logged In")+'</label><label><input type="radio" name="condition_'+t+'_user_state" value="logged-out" '+m+" "+s+"> "+(urcr_membership_access_data.labels.logged_out||"Logged Out")+"</label></div>"}else if("date"===r)o='<input type="date" class="urcr-condition-value-input" data-condition-id="'+t+'" data-field-type="'+a+'" value="'+(i||"")+'" '+s+">";else if("period"===r){var f="During",v="";i&&"object"==typeof i?(f=i.select||"During",v=i.input||""):i&&"object"==typeof i&&i.value&&(v=i.value||"",f="During"),o='<div class="urcr-period-input-group ur-d-flex ur-align-items-center" style="gap: 8px;"><select class="urcr-period-select urcr-condition-value-input" data-condition-id="'+t+'" data-field-type="'+a+'" data-period-part="select" '+s+'><option value="During" '+("During"===f?"selected":"")+'>During</option><option value="After" '+("After"===f?"selected":"")+'>After</option></select><input type="number" class="urcr-period-number urcr-condition-value-input" data-condition-id="'+t+'" data-field-type="'+a+'" data-period-part="input" value="'+v+'" min="0" placeholder="Days" '+s+"></div>"}else o="number"===r?'<input type="number" class="urcr-condition-value-input" data-condition-id="'+t+'" data-field-type="'+a+'" value="'+(i||"")+'" '+s+">":'<input type="text" class="urcr-condition-value-input" data-condition-id="'+t+'" data-field-type="'+a+'" value="'+(i||"")+'" '+s+">";return o},initConditionSelect2:function(t,r,a){var i=e('.urcr-condition-wrapper[data-condition-id="'+t+'"] .urcr-enhanced-select2');if("ur_form_field"===r||e('.urcr-condition-wrapper[data-condition-id="'+t+'"] .urcr-ur-form-field-condition').length)this.initURFormFieldCondition(t,a);else if(i.length&&"multiselect"===r){var n=i.data("field-type"),o=this.getSelect2Options(n);i.hasClass("select2-hidden-accessible")&&i.select2("destroy"),setTimeout(function(){i.select2({data:o,multiple:!0,width:"100%"});var e=a,t=i.attr("data-value");if(t)try{e=JSON.parse(t)}catch(t){e=a}e&&Array.isArray(e)&&e.length>0?i.val(e).trigger("change"):e&&!Array.isArray(e)&&i.val([e]).trigger("change")},100)}},initURFormFieldCondition:function(t,r){var a=this,i=e('.urcr-condition-wrapper[data-condition-id="'+t+'"] .urcr-ur-form-field-condition');if(i.length){var n="",o=[],s=i.attr("data-value");if(s)try{var c=JSON.parse(s);n=c.form_id||"",o=c.form_fields||[]}catch(e){r&&"object"==typeof r&&(n=r.form_id||"",o=r.form_fields||[])}else r&&"object"==typeof r&&(n=r.form_id||"",o=r.form_fields||[]);var d=i.find(".urcr-form-select"),l=i.find(".urcr-form-fields-list");n&&(d.val(n),a.renderFormFields(l,n,o,t)),d.off("change").on("change",function(){var r=e(this).val();r?(a.renderFormFields(l,r,[{field_name:"",operator:"is",value:""}],t),a.updateURFormFieldValue(t)):(l.empty(),a.updateURFormFieldValue(t))})}},renderFormFields:function(e,t,r,a){var i=this;if(e.empty(),t&&urcr_membership_access_data.ur_form_data&&urcr_membership_access_data.ur_form_data[t]){var n=urcr_membership_access_data.ur_form_data[t],o=[];for(var s in n)n.hasOwnProperty(s)&&o.push({value:s,label:n[s]||s});0===r.length&&(r=[{field_name:"",operator:"is",value:""}]),r.forEach(function(t,r){i.renderFormFieldRow(e,t,r,o,a)})}},renderFormFieldRow:function(t,r,a,i,n){var o=this,s=r.field_name||"",c=r.operator||"is",d=r.value||"",l='<div class="urcr-form-field-row ur-d-flex ur-align-items-center ur-mb-2"><div class="urcr-form-field-name"><select class="components-select-control__input urcr-condition-value-input urcr-form-field-select"><option value="">Select field</option>';i.forEach(function(e){var t=e.value===s?"selected":"";l+='<option value="'+e.value+'" '+t+">"+e.label+"</option>"}),l+='</select></div><div class="urcr-form-field-operator"><select class="components-select-control__input urcr-condition-value-input urcr-form-field-operator-select"><option value="is"'+("is"===c?" selected":"")+'>is</option><option value="is not"'+("is not"===c?" selected":"")+'>is not</option><option value="empty"'+("empty"===c?" selected":"")+'>empty</option><option value="not empty"'+("not empty"===c?" selected":"")+">not empty</option></select></div>","empty"!==c&&"not empty"!==c&&(l+='<div class="urcr-form-field-value ur-flex-1"><input type="text" class="components-text-control__input urcr-condition-value-input urcr-condition-value-text urcr-form-field-value-input" value="'+(d||"")+'" placeholder="Enter value"></div>'),l+='<button type="button" class="button urcr-add-field-button" aria-label="Add field"><span class="dashicons dashicons-plus-alt2"></span></button><button type="button" class="button urcr-remove-field-button" aria-label="Remove field"><span class="dashicons dashicons-minus"></span></button></div>',t.append(l);var u=t.find(".urcr-form-field-row").last();u.find(".urcr-form-field-select, .urcr-form-field-operator-select, .urcr-form-field-value-input").off("change input").on("change input",function(){o.updateURFormFieldValue(n)}),u.find(".urcr-form-field-operator-select").off("change").on("change",function(){var t=e(this).val(),r=u.find(".urcr-form-field-value");"empty"===t||"not empty"===t?r.remove():r.length||(u.find(".urcr-form-field-operator").after('<div class="urcr-form-field-value ur-flex-1"><input type="text" class="components-text-control__input urcr-condition-value-input urcr-condition-value-text urcr-form-field-value-input" placeholder="Enter value"></div>'),u.find(".urcr-form-field-value-input").off("input").on("input",function(){o.updateURFormFieldValue(n)})),o.updateURFormFieldValue(n)}),u.find(".urcr-add-field-button").off("click").on("click",function(e){e.preventDefault(),e.stopPropagation();var r=t.find(".urcr-form-field-row").length;o.renderFormFieldRow(t,{field_name:"",operator:"is",value:""},r,i,n),o.updateURFormFieldValue(n)}),u.find(".urcr-remove-field-button").off("click").on("click",function(r){if(r.preventDefault(),r.stopPropagation(),t.find(".urcr-form-field-row").length>1&&!e(this).prop("disabled")){u.remove();var a=t.find(".urcr-form-field-row").length;t.find(".urcr-remove-field-button").prop("disabled",a<=1),o.updateURFormFieldValue(n)}});var p=t.find(".urcr-form-field-row").length<=1;t.find(".urcr-remove-field-button").prop("disabled",p)},updateURFormFieldValue:function(t){var r=e('.urcr-condition-wrapper[data-condition-id="'+t+'"] .urcr-ur-form-field-condition');if(r.length){var a=r.find(".urcr-form-select").val()||"",i=[];r.find(".urcr-form-field-row").each(function(){var t=e(this).find(".urcr-form-field-select").val()||"",r=e(this).find(".urcr-form-field-operator-select").val()||"is",a=e(this).find(".urcr-form-field-value-input"),n=a.length&&"empty"!==r&&"not empty"!==r?a.val():"";t&&i.push({field_name:t,operator:r,value:n})});var n={form_id:a,form_fields:i},o=this.conditions.find(function(e){return e.id===t});o&&(o.value=n)}},getSelect2Options:function(e){var t=this,r=[];if("roles"===e)urcr_membership_access_data.wp_roles&&(r=Object.keys(urcr_membership_access_data.wp_roles).map(function(e){return{id:e,text:urcr_membership_access_data.wp_roles[e]}}));else if("membership"===e)if(t.membershipId>0){var a="";urcr_membership_access_data.memberships&&urcr_membership_access_data.memberships[t.membershipId]&&(a=urcr_membership_access_data.memberships[t.membershipId]),r=[{id:t.membershipId.toString(),text:a||"Current Membership"}]}else urcr_membership_access_data.memberships&&(r=Object.keys(urcr_membership_access_data.memberships).map(function(e){return{id:e,text:urcr_membership_access_data.memberships[e]}}));else"capabilities"===e?urcr_membership_access_data.wp_capabilities&&(r=Object.keys(urcr_membership_access_data.wp_capabilities).map(function(e){return{id:e,text:urcr_membership_access_data.wp_capabilities[e]}})):"registration_source"===e?urcr_membership_access_data.registration_sources&&(r=Object.keys(urcr_membership_access_data.registration_sources).map(function(e){return{id:e,text:urcr_membership_access_data.registration_sources[e]}})):"ur_form_field"===e?r=[]:"payment_status"===e&&urcr_membership_access_data.payment_status&&(r=Object.keys(urcr_membership_access_data.payment_status).map(function(e){return{id:e,text:urcr_membership_access_data.payment_status[e]}}));return r},removeCondition:function(t){e('.urcr-condition-wrapper[data-condition-id="'+t+'"]').remove(),this.conditions=this.conditions.filter(function(e){return e.id!==t})},updateConditionType:function(t,r){var a=this,i=a.getConditionOptions().find(function(e){return e.value===r});if(i){var n=e('.urcr-condition-wrapper[data-condition-id="'+t+'"]').find(".urcr-condition-value"),o=a.getConditionValueInputHtml(t,i.type,r,"",!1);n.html(o),a.initConditionSelect2(t,i.type,"");var s=a.conditions.find(function(e){return e.id===t});s&&(s.type=r,s.value="")}},updateConditionValue:function(t,r){var a="";if(e('.urcr-condition-wrapper[data-condition-id="'+t+'"] .urcr-ur-form-field-condition').length)this.updateURFormFieldValue(t);else{if(r.is("select"))a=r.is("[multiple]")?r.val()||[]:r.val()||"";else if(r.is('input[type="radio"]')){a=r.closest(".urcr-condition-wrapper").find('input[type="radio"]:checked').val()||""}else a=(r.is('input[type="number"]')||r.is('input[type="text"]')||r.is('input[type="date"]'),r.val()||"");var i=this.conditions.find(function(e){return e.id===t});i&&(i.value=a)}},addContentTarget:function(t,r,a){var i=this;a||(a="x"+Date.now()+"_"+i.targetCounter++);var n=i.getContentTypeLabel(t),o=i.getContentTargetHtml(a,t,n,r||"");e(".urcr-target-type-group").append(o);var s=e('.urcr-target-item[data-target-id="'+a+'"]');i.dripInit(s),i.initContentTargetSelect2(a,t,r),i.contentTargets.push({id:a,type:t,value:r||("whole_site"===t?"whole_site":[])})},getContentTargetHtml:function(e,t,r,a){var i="",n="whole_site"===t?"Includes":r;if("whole_site"===t)i='<span data-content-type="whole_site" data-field-type="whole_site">'+(r||"Whole Site")+"</span>";else if("pages"===t||"posts"===t)i='<select class="urcr-enhanced-select2 urcr-content-target-input" multiple data-target-id="'+e+'" data-content-type="'+t+'"></select>';else if("taxonomy"===t)i='<div class="urcr-taxonomy-select-group"><select class="urcr-taxonomy-select" data-target-id="'+e+'"><option value="">Select Taxonomy</option></select><select class="urcr-enhanced-select2 urcr-content-target-input" multiple data-target-id="'+e+'" data-content-type="taxonomy"></select></div>';else if("custom_uri"===t){try{"string"==typeof a&&(a=JSON.parse(a))}catch{a=["",!1]}i=`<div style="display:flex;align-items:center;gap:4px;flex:1" data-content-type="${t}" data-target-id="${e}">\n\t\t\t\t\t<input style="flex:1" type="text" class="components-text-control__input urcr-condition-value-input urcr-condition-value-text urcr-form-field-value-input" value="${a[0]}">\n\t\t\t\t</div>`}else i='<select class="urcr-enhanced-select2 urcr-content-target-input" multiple data-target-id="'+e+'" data-content-type="'+t+'"></select>';var o="";if(!["whole_site","masteriyo_courses","whole_site","masteriyo_courses","menu_items","files","custom_uri"].includes(t)&&urcr_membership_access_data.is_pro&&urcr_membership_access_data.is_drip_content){let e={activeType:"fixed_date",value:{fixed_date:{date:"",time:""},days_after:{days:0}}};o+=`\n    <div class="urcr-membership-drip"\n        data-active_type="${e.activeType}"\n        data-fixed_date_date="${e.value.fixed_date.date}"\n        data-fixed_date_time="${e.value.fixed_date.time}"\n        data-days_after_days="${e.value.days_after.days}">\n\n        <button type="button" class="urcr-drip__trigger">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 24 24">\n\t\t\t\t<path d="M11.09 6.545a.91.91 0 1 1 1.82 0v4.893l3.133 1.567a.91.91 0 0 1-.813 1.626l-3.637-1.818a.91.91 0 0 1-.502-.813V6.545Z"/>\n\t\t\t\t<path d="M20.182 12a8.182 8.182 0 1 0-16.364 0 8.182 8.182 0 0 0 16.364 0ZM22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Z"/>\n\t\t\t</svg> ${urcr_membership_access_data.drip_content_label.drip_this_content}\n        </button>\n\n        <div class="urcr-drip__popover" style="display:none;">\n            <div class="urcr-drip__arrow"></div>\n\n            <div class="urcr-drip__tabs">\n                <div class="urcr-drip__tabList">\n                    <button type="button" class="urcr-drip__tab" data-value="fixed_date">${urcr_membership_access_data.drip_content_label.fixed_date}</button>\n                    <button type="button" class="urcr-drip__tab" data-value="days_after">${urcr_membership_access_data.drip_content_label.days_after}</button>\n                </div>\n\n                <div class="urcr-drip__panels">\n                    <div class="urcr-drip__panel fixed_date-panel">\n                        <input type="date" class="urcr-drip__input drip-date"\n                            min="${urcr_membership_access_data.today}"\n                            value="${e.value.fixed_date.date}" />\n\n                        <input type="time" class="urcr-drip__input drip-time"\n                            value="${e.value.fixed_date.time}" />\n                    </div>\n\n                    <div class="urcr-drip__panel days_after-panel" style="display:none;">\n                        <input type="number" class="urcr-drip__input drip-days"\n                            value="${e.value.days_after.days}" min="0" />\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>`}return'<div class="urcr-target-item" data-target-id="'+e+'"><span class="urcr-target-type-label">'+n+":</span>"+i+o+'<button type="button" class="button-link urcr-target-remove" aria-label="Remove"><span class="dashicons dashicons-no-alt"></span></button></div>'},initContentTargetSelect2:function(t,r,a){var i=e('.urcr-target-item[data-target-id="'+t+'"] .urcr-content-target-input');if(i.length&&"whole_site"!==r&&"custom_uri"!==r){var n=this.getContentTargetOptions(r);i.hasClass("select2-hidden-accessible")&&i.select2("destroy"),i.select2({data:n,multiple:!0,width:"100%"}),setTimeout(function(){a&&Array.isArray(a)&&a.length>0?i.val(a).trigger("change"):a&&!Array.isArray(a)&&"object"==typeof a&&a.value?Array.isArray(a.value)&&a.value.length>0&&i.val(a.value).trigger("change"):a&&!Array.isArray(a)&&i.val([a]).trigger("change")},50)}"taxonomy"===r&&this.initTaxonomySelect(t,a)},initTaxonomySelect:function(t,r){var a=this,i=e('.urcr-target-item[data-target-id="'+t+'"] .urcr-taxonomy-select'),n=e('.urcr-target-item[data-target-id="'+t+'"] .urcr-content-target-input');if(i.length&&urcr_membership_access_data.taxonomies){i.find("option").length<=1&&Object.keys(urcr_membership_access_data.taxonomies).forEach(function(e){i.append('<option value="'+e+'">'+urcr_membership_access_data.taxonomies[e]+"</option>")});var o=null,s=[];if(r&&r.taxonomy)o=r.taxonomy,s=r.value||[];else{o=i.val();var c=n.attr("data-value");if(c)try{s=JSON.parse(c)}catch(e){s=[]}}o&&(i.val()!==o&&i.val(o),a.updateTaxonomyTerms(t,o,s)),i.off("change").on("change",function(){var r=e(this).val();a.updateTaxonomyTerms(t,r,[])})}},updateTaxonomyTerms:function(t,r,a){var i=e('.urcr-target-item[data-target-id="'+t+'"] .urcr-content-target-input');if(i.length&&r&&urcr_membership_access_data.terms_list&&urcr_membership_access_data.terms_list[r]){var n=urcr_membership_access_data.terms_list[r],o=Object.keys(n).map(function(e){return{id:e,text:n[e]}});i.hasClass("select2-hidden-accessible")&&i.select2("destroy"),i.empty().select2({data:o,multiple:!0,width:"100%"}),a&&a.length>0&&setTimeout(function(){var e=a.map(function(e){return String(e)});i.val(e).trigger("change")},50)}},getContentTargetOptions:function(e){var t=[];if("object"==typeof urcr_membership_access_data&&urcr_membership_access_data.hasOwnProperty(e)){const r=urcr_membership_access_data[e];t=Array.isArray(r)&&r.length>0&&"object"==typeof r[0]&&null!==r[0]&&"group"in r[0]&&"options"in r[0]&&Array.isArray(r[0].options)?r.map(e=>({text:e.group,children:e.options.map(e=>({id:e.value,text:e.label}))})):Object.keys(urcr_membership_access_data[e]).map(function(t){return{id:t,text:urcr_membership_access_data[e][t]}})}return t},removeContentTarget:function(t){var r=e('.urcr-target-item[data-target-id="'+t+'"]');r.length&&(r.removeClass("ur-d-flex").addClass("ur-d-none"),r.remove()),this.contentTargets=this.contentTargets.filter(function(e){return e.id!==t})},showContentTypeDropdown:function(t){var r=this.contentTargets.map(function(e){return e.type}),a=urcr_membership_access_data.is_pro||!1,i=urcr_membership_access_data.content_type_options,n=a?i:i.filter(function(e){var t="posts"===e.value||"pages"===e.value||"whole_site"===e.value;return urcr_membership_access_data.is_membership_module_enabled&&(t=t||"masteriyo_courses"===e.value),t}),o=t.closest(".urcr-content-dropdown-wrapper");if(0===o.length&&(o=t.closest(".urcr-target-selection-section").find(".urcr-content-dropdown-wrapper")),0===o.length&&(o=t.closest(".urcr-target-selection-wrapper").find(".urcr-content-dropdown-wrapper")),0!==o.length){var s=o.find(".urcr-content-type-dropdown-menu");0===s.length&&(s=e('<div class="urcr-content-type-dropdown-menu urcr-dropdown-menu"></div>'),o.append(s)),s.empty(),n.forEach(function(e){var t=-1!==r.indexOf(e.value),a=t?"-1":"0";s.append('<span role="button" tabindex="'+a+'" class="urcr-dropdown-option urcr-content-type-option " data-content-type="'+e.value+'" >'+e.label+"</span>")}),s.hasClass("ur-d-none")?s.removeClass("ur-d-none").addClass("ur-d-flex"):s.removeClass("ur-d-flex").addClass("ur-d-none")}},updateAccessControlClass:function(){var t=e(".urcr-condition-value-input-wrapper");t.removeClass("urcr-restrict-content"),t.addClass("urcr-access-content")},initSelect2:function(){},getConditionOptions:function(){var e=urcr_membership_access_data.condition_options||[];return urcr_membership_access_data.is_pro||!1||(e=e.filter(function(e){return"membership"===e.value||"roles"===e.value||"user_state"===e.value})),e=e.filter(function(e){return"membership"!==e.value})},getContentTypeLabel:function(e){for(var t=urcr_membership_access_data.content_type_options||[],r=0;r<t.length;r++)if(t[r].value===e)return t[r].label||e;return e},prepareRuleData:function(){var t=this,r=e("#ur-input-type-membership-name").closest("form").find('input[name="membership_id"]');if(r.length&&r.val()&&(t.membershipId=parseInt(r.val(),10)),!t.membershipId&&window.location.search){var a=new URLSearchParams(window.location.search).get("post_id");a&&(t.membershipId=parseInt(a,10))}var i=!1;e(".urcr-condition-wrapper").each(function(){if("membership"===e(this).find(".urcr-condition-field-select").val())return i=!0,!1});var n=[];e(".urcr-condition-wrapper").each(function(){var r=e(this),a=r.data("condition-id"),i=r.find(".urcr-condition-field-select").val(),o="";if("ur_form_field"===i){var s=t.conditions.find(function(e){return e.id===a});if(s&&s.value&&"object"==typeof s.value)o=s.value;else if(r.find(".urcr-ur-form-field-condition").length){t.updateURFormFieldValue(a);var c=t.conditions.find(function(e){return e.id===a});o=c&&c.value?c.value:{form_id:"",form_fields:[]}}else o={form_id:"",form_fields:[]}}else{var d=r.find(".select2-hidden-accessible");if(d.length)o=d.val()||[],Array.isArray(o)||(o=o?[o]:[]);else{var l=r.find(".urcr-condition-value-input");if(l.is("select[multiple]")){var u=l.val();o=Array.isArray(u)?u:u?[u]:[]}else if(l.is('input[type="radio"]'))o=r.find('input[type="radio"]:checked').val()||"";else if(r.find(".urcr-period-input-group").length){var p=r.find(".urcr-period-input-group");o={select:p.find('[data-period-part="select"]').val()||"During",input:p.find('[data-period-part="input"]').val()||""}}else o=l.val()||""}}"membership"===i&&t.membershipId>0&&(o=[t.membershipId.toString()]),n.push({id:a,type:i,value:o})}),!i&&t.membershipId>0&&n.unshift({id:"x"+Date.now(),type:"membership",value:[t.membershipId.toString()]});var o=[];e(".urcr-target-item").each(function(){var t=e(this),r=t.data("target-id"),a="",i=t.find("[data-content-type]");if(i.length&&(a=i.first().data("content-type")||""),!a)if(t.find(".urcr-taxonomy-select").length)a="taxonomy";else if(t.find(".urcr-content-target-input").length)a=t.find(".urcr-content-target-input").data("content-type")||"";else{var n=t.find(".urcr-target-type-label");n.length&&-1!==n.text().indexOf("Whole Site")&&(a="whole_site")}var s="";switch(a){case"whole_site":s="whole_site";break;case"taxonomy":var c=t.find(".urcr-taxonomy-select").val(),d=t.find(".urcr-content-target-input"),l=[];if(d.hasClass("select2-hidden-accessible")||d.hasClass("urcr-enhanced-select2"))l=d.val()||[],Array.isArray(l)||(l=l?[l]:[]);else{var u=d.attr("data-value");if(u)try{l=JSON.parse(u)}catch(e){l=[]}else l=d.val()||[]}Array.isArray(l)||(l=l?[l]:[]),s={taxonomy:c,value:l};break;case"custom_uri":var p=t.find('input[type="text"]'),m=t.find('input[type="checkbox"]');s=[p.val()||"",m.is(":checked")];break;case"pages":case"posts":var f=[];if((h=t.find(".urcr-content-target-input")).hasClass("select2-hidden-accessible")||h.hasClass("urcr-enhanced-select2"))f=h.val()||[],Array.isArray(f)||(f=f?[f]:[]);else{var v=h.attr("data-value");if(v)try{f=JSON.parse(v)}catch(e){f=[]}else f=h.val()||[]}s=Array.isArray(f)?f:f?[f]:[];break;default:var h,_=[];if((h=t.find(".urcr-content-target-input")).hasClass("select2-hidden-accessible")||h.hasClass("urcr-enhanced-select2"))_=h.val()||[],Array.isArray(_)||(_=_?[_]:[]);else{var g=h.attr("data-value");if(g)try{_=JSON.parse(g)}catch(e){_=[]}else _=h.val()||[]}s=Array.isArray(_)?_:_?[_]:[]}switch(a){case"pages":a="wp_pages";break;case"posts":a="wp_posts"}var y={};if(!["whole_site","masteriyo_courses"].includes(a)){var b=t.find(".urcr-membership-drip");b&&(y={activeType:b.data("active_type"),value:{fixed_date:{date:b.data("fixed_date_date"),time:b.data("fixed_date_time")},days_after:{days:b.data("days_after_days")}}})}var w={id:r,type:a,drip:y??{activeType:"fixed_date",value:{fixed_date:{date:"",time:""},days_after:{days:0}}}};"whole_site"!==a&&(w.value=s),o.push(w)});var s=t.getActionsFromForm(),c={title:"",access_rule_data:{enabled:!0,access_control:t.accessControl||"access",logic_map:{type:"group",id:"x"+Date.now(),conditions:n,logic_gate:"AND"},target_contents:o,actions:s},rule_type:"membership",membership_id:t.membershipId};return e("#urcr-membership-access-rule-data").val(JSON.stringify(c)),window.urcrMembershipAccessRuleData=c,c},initActionSection:function(){var t=e("#urcr-membership-action-type");if(e(".urcr-action-input-container").removeClass("ur-d-flex").addClass("ur-d-none"),t.length){e(".urcr-action-local-page, .urcr-action-ur-form, .urcr-action-shortcode-tag").each(function(){e(this).hasClass("select2-hidden-accessible")||e(this).select2({width:"100%"})});var r=t.val()||"message";this.handleActionTypeChange(r)}var a=e('input[name="urcr-membership-message-type"]');if(a.length){var i=a.filter(":checked");i.length||(a.filter('[value="global"]').prop("checked",!0),i=a.filter('[value="global"]')),i.trigger("change")}else{var n=e(".urcrra-message-input-container");n.length&&(n.removeClass("ur-d-flex").addClass("ur-d-none"),n.hide())}},handleActionTypeChange:function(t){e(".urcr-action-input-container").removeClass("ur-d-flex").addClass("ur-d-none"),t||(t="message");var r=null;switch(t){case"message":default:r=e(".urcrra-message-input-container");break;case"redirect":r=e(".urcrra-redirect-input-container");break;case"local_page":r=e(".urcrra-redirect-to-local-page-input-container");break;case"ur-form":r=e(".urcrra-ur-form-input-container");break;case"shortcode":r=e(".urcrra-shortcode-input-container")}r&&r.length&&r.removeClass("ur-d-none").addClass("ur-d-flex")},getActionsFromForm:function(){var t=e("#urcr-membership-action-type");if(!t.length)return this.getDefaultActions();var r=t.val()||"message",a={id:"x"+Date.now(),type:r,access_control:this.accessControl||"access"};switch(r){case"message":a.label="Show Message";var i=e('input[name="urcr-membership-message-type"]:checked'),n="";if("global"===(i.length?i.val():"global"))n="";else if("undefined"!=typeof wp&&wp.editor&&e("#urcr-membership-action-message").length){var o=window.tinymce&&window.tinymce.get("urcr-membership-action-message");n=o?o.getContent():wp.editor.getContent("urcr-membership-action-message")}else n=e("#urcr-membership-action-message").val()||"";a.message=n?encodeURIComponent(n):"",a.redirect_url="",a.local_page="",a.ur_form="",a.shortcode={tag:"",args:""};break;case"redirect":a.label="Redirect",a.message="",a.redirect_url=e(".urcr-action-redirect-url").val()||"",a.local_page="",a.ur_form="",a.shortcode={tag:"",args:""};break;case"local_page":a.type="redirect_to_local_page",a.label="Redirect to a Local Page",a.message="",a.redirect_url="",a.local_page=e(".urcr-action-local-page").val()||"",a.ur_form="",a.shortcode={tag:"",args:""};break;case"ur-form":a.type="ur-form",a.label="Show UR Form",a.message="",a.redirect_url="",a.local_page="",a.ur_form=e(".urcr-action-ur-form").val()||"",a.shortcode={tag:"",args:""};break;case"shortcode":a.label="Render Shortcode",a.message="",a.redirect_url="",a.local_page="",a.ur_form="",a.shortcode={tag:e(".urcr-action-shortcode-tag").val()||"",args:e(".urcr-action-shortcode-args").val()||""}}return[a]},getDefaultActions:function(){return[{id:"x"+Date.now(),type:"message",label:"Show Message",message:"<h3>Membership Required</h3>\n<p>This content is available to members only.</p>\n<p>Sign up to unlock access or log in if you already have an account.</p>\n<p>{{sign_up}} {{log_in}}</p>",redirect_url:"",access_control:this.accessControl,local_page:"",ur_form:"",shortcode:{tag:"",args:""}}]},dripInit:function(t){function r(e,t){e.find(".urcr-drip__tab").removeClass("active"),e.find('.urcr-drip__tab[data-value="'+t+'"]').addClass("active"),"fixed_date"===t?(e.find(".fixed_date-panel").show(),e.find(".days_after-panel").hide()):(e.find(".fixed_date-panel").hide(),e.find(".days_after-panel").show())}e(t||document).find(".urcr-membership-drip").each(function(){var t=e(this);if(!t.data("drip-initialized")){var a=t.data("active_type")||"fixed_date";r(t,a),t.data("drip-initialized",!0)}}),this.dripEventsBound||(this.dripEventsBound=!0,e(document).on("click",".urcr-membership-drip .urcr-drip__trigger",function(t){t.preventDefault(),t.stopPropagation(),e(".urcr-drip__popover").fadeOut(),e(this).closest(".urcr-membership-drip").find(".urcr-drip__popover").fadeToggle()}),e(document).on("click",function(t){e(t.target).closest(".urcr-membership-drip").length||e(".urcr-drip__popover").fadeOut()}),e(document).on("click",".urcr-membership-drip .urcr-drip__tab",function(t){t.preventDefault();var a=e(this).closest(".urcr-membership-drip"),i=e(this).data("value");a.data("active_type",i),a.attr("data-active_type",i),r(a,i)}),e(document).on("change",".urcr-membership-drip .drip-date",function(){var t=e(this).closest(".urcr-membership-drip"),r=e(this).val();t.attr("data-fixed_date_date",r),t.data("fixed_date_date",r)}),e(document).on("change",".urcr-membership-drip .drip-time",function(){var t=e(this).closest(".urcr-membership-drip"),r=e(this).val();t.attr("data-fixed_date_time",r),t.data("fixed_date_time",r)}),e(document).on("change",".urcr-membership-drip .drip-days",function(){var t=e(this).closest(".urcr-membership-drip"),r=e(this).val();t.attr("data-days_after_days",r),t.data("days_after_days",r)}))}};e(document).ready(function(){0===e("#ur-membership-access-section").length?setTimeout(function(){e("#ur-membership-access-section").length>0&&t.init()},500):t.init()}),window.URCRMembershipAccess=t}(jQuery);