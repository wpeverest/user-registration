!function(e){"use strict";var r={init:function(){this.bindEvents(),this.initTooltips()},bindEvents:function(){var r=this;e(document).on("click",".urcr-expand-toggle",function(a){a.preventDefault(),a.stopPropagation();var t=e(this).data("rule-id");r.toggleRuleCard(t)}),e(document).on("click",".urcr-settings-icon",function(a){a.preventDefault(),a.stopPropagation();var t=e(this).data("rule-id");r.toggleSettingsPanel(t)}),e(document).on("click",".urcr-menu-toggle",function(a){a.preventDefault(),a.stopPropagation();var t=e(this).data("rule-id");r.toggleMenuDropdown(t)}),e(document).on("click",function(r){e(r.target).closest(".urcr-rule-menu").length||e(".urcr-menu-dropdown").removeClass("show")}),e(document).on("change",".urcr-rule-status-toggle",function(){var a=e(this).data("rule-id"),t=e(this).is(":checked");r.updateRuleStatus(a,t)}),e(document).on("click",".urcr-save-rule-btn",function(a){a.preventDefault();var t=e(this).data("rule-id");r.saveRule(t)}),e(document).on("change",".urcr-access-control-select",function(){var r=e(this).data("rule-id");e('.urcr-save-rule-btn[data-rule-id="'+r+'"]').prop("disabled",!1)}),e(document).on("input",".urcr-redirect-url-input",function(){var r=e(this).data("rule-id");e('.urcr-save-rule-btn[data-rule-id="'+r+'"]').prop("disabled",!1)}),e(document).on("click",".urcr-save-settings-btn",function(a){a.preventDefault();var t=e(this).data("rule-id");r.saveSettings(t)})},saveSettings:function(e){var r=urcr_viewer_data.edit_url||"";window.location.href=r?r.replace("%RULE_ID%",e):"admin.php?page=user-registration-content-restriction&action=add_new_urcr_content_access_rule&post-id="+e},toggleRuleCard:function(r){var a=e('.urcr-rule-card-body[data-rule-id="'+r+'"]'),t=e('.urcr-expand-toggle[data-rule-id="'+r+'"]');a.is(":visible")?(a.slideUp(300),t.removeClass("active")):(a.slideDown(300),t.addClass("active"))},toggleSettingsPanel:function(r){var a=e('.urcr-rule-settings-panel[data-rule-id="'+r+'"]'),t=e('.urcr-rule-card-body[data-rule-id="'+r+'"] .urcr-rule-content-panel'),n=e('.urcr-rule-card-body[data-rule-id="'+r+'"]');n.is(":visible")||(n.slideDown(300),e('.urcr-expand-toggle[data-rule-id="'+r+'"]').addClass("active")),a.is(":visible")?(a.slideUp(300),t.slideDown(300)):(t.slideUp(300),a.slideDown(300).addClass("show"))},toggleMenuDropdown:function(r){var a=e('.urcr-menu-dropdown[data-rule-id="'+r+'"]');e(".urcr-menu-dropdown").not(a).removeClass("show"),a.toggleClass("show")},updateRuleStatus:function(r,a){e.ajax({url:urcr_viewer_data.ajax_url,type:"POST",data:{action:"urcr_enable_disable_access_rule",rule_id:r,enabled:a?"true":"false",security:urcr_viewer_data.nonce},success:function(t){if(t.success){if("undefined"!=typeof UR_Snackbar){var n=new UR_Snackbar,u=t.data&&t.data.message?t.data.message:a?urcr_viewer_data.labels.rule_enabled:urcr_viewer_data.labels.rule_disabled;n.show(u,"success")}}else{if("undefined"!=typeof UR_Snackbar){(n=new UR_Snackbar).show(t.data&&t.data.message?t.data.message:urcr_viewer_data.labels.error_occurred,"error")}e('.urcr-rule-status-toggle[data-rule-id="'+r+'"]').prop("checked",!a)}},error:function(){if("undefined"!=typeof UR_Snackbar){(new UR_Snackbar).show(urcr_viewer_data.labels.error_occurred,"error")}}})},saveRule:function(r){var a=e('.urcr-save-rule-btn[data-rule-id="'+r+'"]'),t=e('.urcr-access-control-select[data-rule-id="'+r+'"]').val(),n=e('.urcr-redirect-url-input[data-rule-id="'+r+'"]').val()||"";a.prop("disabled",!0).text(urcr_viewer_data.labels.saving||"Saving..."),e.ajax({url:urcr_viewer_data.ajax_url,type:"POST",data:{action:"urcr_update_rule_from_viewer",rule_id:r,access_control:t,redirect_url:n,security:urcr_viewer_data.nonce},success:function(e){if(e.success){if("undefined"!=typeof UR_Snackbar){(new UR_Snackbar).show(urcr_viewer_data.labels.rule_saved||"Rule saved successfully","success")}a.text(urcr_viewer_data.labels.save||"Save")}else{if("undefined"!=typeof UR_Snackbar){(new UR_Snackbar).show(e.data&&e.data.message?e.data.message:urcr_viewer_data.labels.error_occurred,"error")}a.prop("disabled",!1).text(urcr_viewer_data.labels.save||"Save")}},error:function(){if("undefined"!=typeof UR_Snackbar){(new UR_Snackbar).show(urcr_viewer_data.labels.error_occurred,"error")}a.prop("disabled",!1).text(urcr_viewer_data.labels.save||"Save")}})},initTooltips:function(){"undefined"!=typeof e.fn.tipTip&&e(".user-registration-help-tip").tipTip({attribute:"data-tip",defaultPosition:"top"})}};e(document).ready(function(){r.init()})}(jQuery);