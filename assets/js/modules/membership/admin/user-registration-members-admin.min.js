!function(e,s){if(e(".user-membership-enhanced-select2").select2(),UR_Snackbar)var r=new UR_Snackbar;var t={convert_to_array:function(e){return Object.values(e).reverse().slice(2).reverse()},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},prepend_spinner:function(e){if(e&&e.prepend){return e.prepend('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},if_empty:function(e,s){return null==e||""===e?s:e},toggleSaveButtons:function(s){s=this.if_empty(s,!0),e(".ur-member-save-btn").prop("disabled",!!s)},show_success_message:function(e){return!!r&&(r.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!r&&(r.add({type:"failure",message:e,duration:6}),!0)}},n={prepare_members_data:function(){var s={},r=e(".ur-membership-members-input");return(r=t.convert_to_array(r)).forEach(function(r){var t=e(r),n=t.data("key-name").toLowerCase();s[n]=t.is('input[type="checkbox"]')?t.prop("checked"):t.val()}),s},validate_members_form:function(){var r=e("#ur-membership-create-form").find("input"),n=new RegExp("^[a-zA-Z0-9._%+-]+@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$"),a=(new Date).toISOString().split("T")[0],i=!0;return(r=t.convert_to_array(r)).every(function(r){var o=e(r),m=o.val(),_=o.attr("required"),u=o.data("key-name");return _&&""===m?(i=!1,t.show_failure_message(s.labels.i18n_error+"! "+u+" "+s.labels.i18n_field_is_required),!1):"Email"!==u||n.test(m)?"Password"===u&&m!==e("#ur-input-type-membership-confirm-password").val()?(i=!1,t.show_failure_message(s.labels.i18n_field_password_field_validation),!1):!("start_date"===u&&""===s.member_id&&m<a)||(i=!1,t.show_failure_message(s.labels.i18n_field_subscription_start_date_validation),!1):(i=!1,t.show_failure_message(s.labels.i18n_field_email_field_validation),!1)}),i},create_member:function(r){if(t.toggleSaveButtons(!0),t.append_spinner(r),this.validate_members_form()){var n=this.prepare_members_data();this.send_data({action:"user_registration_membership_create_member",members_data:JSON.stringify(n)},{success:function(r){r.success?(s.member_id=r.data.member_id,e(".ur-member-save-btn").hide(),t.show_success_message(r.data.message),e(location).attr("href",s.members_page_url)):t.show_failure_message(r.data.message)},failure:function(e,r){t.show_failure_message(s.labels.network_error+"("+r+")")},complete:function(){t.remove_spinner(r),t.toggleSaveButtons(!1)}})}else t.remove_spinner(r),t.toggleSaveButtons(!1)},update_member:function(r){if(t.toggleSaveButtons(!0),t.append_spinner(r),this.validate_members_form()){var n=this.prepare_members_data();this.send_data({action:"user_registration_membership_edit_member",members_data:JSON.stringify(n),_wpnonce:s.edit_members_nonce},{success:function(r){r.success?(s.member_id=r.data.member_id,e(".ur-member-save-btn").hide(),t.show_success_message(r.data.message),window.location.reload()):t.show_failure_message(r.data.message)},failure:function(e,r){t.show_failure_message(s.labels.network_error+"("+r+")")},complete:function(){t.remove_spinner(r),t.toggleSaveButtons(!1)}})}else t.remove_spinner(r),t.toggleSaveButtons(!1)},update_membership_status:function(e){},send_data:function(r,t){var n="function"==typeof t.success?t.success:function(){},a="function"==typeof t.failure?t.failure:function(){},i="function"==typeof t.beforeSend?t.beforeSend:function(){},o="function"==typeof t.complete?t.complete:function(){};!r._wpnonce&&s&&(r._wpnonce=s._nonce),e.ajax({type:"post",dataType:"json",url:s.ajax_url,data:r,beforeSend:i,success:n,error:a,complete:o})},handle_bulk_delete_action:function(r){Swal.fire({title:'<img src="'+s.delete_icon+'" id="delete-user-icon">'+s.labels.i18n_prompt_title,html:'<p id="html_1">'+s.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:s.labels.i18n_prompt_delete,cancelButtonText:s.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(a){if(a.isConfirmed){var i=r.find('input[name="users[]"]:checked'),o=[];if(i.length<1)return void t.show_failure_message(s.labels.i18n_prompt_no_membership_selected);i.each(function(){""!==e(this).val()&&o.push(e(this).val())}),n.send_data({action:"user_registration_membership_delete_members",members_ids:JSON.stringify(o)},{success:function(e){e.success?(t.show_success_message(e.data.message),n.remove_deleted_members(i,!0)):t.show_failure_message(e.data.message)},failure:function(e,r){t.show_failure_message(s.labels.network_error+"("+r+")")},complete:function(){}})}})},remove_deleted_members:function(s,r){r?s.each(function(){e(this).parents("tr").remove()}):e(s).parents("tr").remove()}};e(".ur-member-save-btn").on("click",function(r){r.preventDefault(),r.stopPropagation();var t=e(this);s.member_id&&""!==s.member_id?n.update_member(t):n.create_member(t)}),e("#user-registration-members-list-form #doaction,#doaction2").on("click",function(s){var r=e("#user-registration-members-list-form");if("delete"===r.find("select#bulk-action-selector-top option:selected").val())s.preventDefault(),s.stopPropagation(),n.handle_bulk_delete_action(r)}),e("#ur-membership-select").on("change",function(){var s=e(this).val(),r=e(this);if(!r.hasClass("is_loading")){r.addClass("is_loading");e("#plan-detail-container").append('<div class="urm-membership-plan-spinner-container is_loading"><span class="ur-spinner is-active" style="margin-left: 20px"></span></div>');var t={action:"user_registration_membership_get_membership_details",membership_id:s,security:ur_members_localized_data.ur_membership_edit_nonce};e.post(ur_members_localized_data.ajax_url,t,function(s){if(s.success){var t=s.data;e(document).find(".urm-membership-plan-amount").text(t.membership_detail.amount),e(document).find(".urm-membership-subscription-status > span").remove(),e(document).find(".urm-membership-subscription-status").append('<span class="user-registration-badge user-registration-badge--pending">'+t.membership_detail.subscription_status+"</span>"),e(document).find(".urm-membership-expiry-date").text(t.membership_detail.expiration_on),r.removeClass("is_loading"),e(".urm-membership-plan-spinner-container").removeClass("is_loading"),e(".urm-membership-plan-spinner-container").empty()}})}})}(jQuery,window.ur_members_localized_data);