!function(e,t){if(e(".user-membership-enhanced-select2").select2(),UR_Snackbar)var s=new UR_Snackbar;var r={convert_to_array:function(e){return Object.values(e).reverse().slice(2).reverse()},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},prepend_spinner:function(e){if(e&&e.prepend){return e.prepend('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},if_empty:function(e,t){return null===e||undefined===e||""===e?t:e},toggleSaveButtons:function(t){t=this.if_empty(t,!0),e(".ur-member-save-btn").prop("disabled",!!t)},show_success_message:function(e){return!!s&&(s.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!s&&(s.add({type:"failure",message:e,duration:6}),!0)}},n={prepare_members_data:function(){var t={},s=e(".ur-membership-members-input");return(s=r.convert_to_array(s)).forEach(function(s){var r=e(s),n=r.data("key-name").toLowerCase();t[n]=r.is('input[type="checkbox"]')?r.prop("checked"):r.val()}),t},validate_members_form:function(){var s=e("#ur-membership-create-form").find("input"),n=new RegExp("^[a-zA-Z0-9._%+-]+@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$"),a=(new Date).toISOString().split("T")[0],i=!0;return(s=r.convert_to_array(s)).every(function(s){var o=e(s),_=o.val(),m=o.attr("required"),u=o.data("key-name");return m&&""===_?(i=!1,r.show_failure_message(t.labels.i18n_error+"! "+u+" "+t.labels.i18n_field_is_required),!1):"Email"!==u||n.test(_)?"Password"===u&&_!==e("#ur-input-type-membership-confirm-password").val()?(i=!1,r.show_failure_message(t.labels.i18n_field_password_field_validation),!1):!("start_date"===u&&""===t.member_id&&_<a)||(i=!1,r.show_failure_message(t.labels.i18n_field_subscription_start_date_validation),!1):(i=!1,r.show_failure_message(t.labels.i18n_field_email_field_validation),!1)}),i},create_member:function(s){if(r.toggleSaveButtons(!0),r.append_spinner(s),this.validate_members_form()){var n=this.prepare_members_data();this.send_data({action:"user_registration_membership_create_member",members_data:JSON.stringify(n)},{success:function(s){s.success?(t.member_id=s.data.member_id,e(".ur-member-save-btn").hide(),r.show_success_message(s.data.message),e(location).attr("href",t.members_page_url)):r.show_failure_message(s.data.message)},failure:function(e,s){r.show_failure_message(t.labels.network_error+"("+s+")")},complete:function(){r.remove_spinner(s),r.toggleSaveButtons(!1)}})}else r.remove_spinner(s),r.toggleSaveButtons(!1)},update_member:function(s){if(r.toggleSaveButtons(!0),r.append_spinner(s),this.validate_members_form()){var n=this.prepare_members_data();this.send_data({action:"user_registration_membership_edit_member",members_data:JSON.stringify(n),_wpnonce:t.edit_members_nonce},{success:function(s){s.success?(t.member_id=s.data.member_id,e(".ur-member-save-btn").hide(),r.show_success_message(s.data.message),window.location.reload()):r.show_failure_message(s.data.message)},failure:function(e,s){r.show_failure_message(t.labels.network_error+"("+s+")")},complete:function(){r.remove_spinner(s),r.toggleSaveButtons(!1)}})}else r.remove_spinner(s),r.toggleSaveButtons(!1)},update_membership_status:function(e){},send_data:function(s,r){var n="function"==typeof r.success?r.success:function(){},a="function"==typeof r.failure?r.failure:function(){},i="function"==typeof r.beforeSend?r.beforeSend:function(){},o="function"==typeof r.complete?r.complete:function(){};!s._wpnonce&&t&&(s._wpnonce=t._nonce),e.ajax({type:"post",dataType:"json",url:t.ajax_url,data:s,beforeSend:i,success:n,error:a,complete:o})},handle_bulk_delete_action:function(s){Swal.fire({title:'<img src="'+t.delete_icon+'" id="delete-user-icon">'+t.labels.i18n_prompt_title,html:'<p id="html_1">'+t.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:t.labels.i18n_prompt_delete,cancelButtonText:t.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(a){if(a.isConfirmed){var i=s.find('input[name="users[]"]:checked'),o=[];if(i.length<1)return void r.show_failure_message(t.labels.i18n_prompt_no_membership_selected);i.each(function(){""!==e(this).val()&&o.push(e(this).val())}),n.send_data({action:"user_registration_membership_delete_members",members_ids:JSON.stringify(o)},{success:function(e){e.success?(r.show_success_message(e.data.message),n.remove_deleted_members(i,!0)):r.show_failure_message(e.data.message)},failure:function(e,s){r.show_failure_message(t.labels.network_error+"("+s+")")},complete:function(){}})}})},remove_deleted_members:function(t,s){s?t.each(function(){e(this).parents("tr").remove()}):e(t).parents("tr").remove()}};e(".ur-member-save-btn").on("click",function(s){s.preventDefault(),s.stopPropagation();var r=e(this);t.member_id&&""!==t.member_id?n.update_member(r):n.create_member(r)}),e("#user-registration-members-list-form #doaction,#doaction2").on("click",function(t){t.preventDefault(),t.stopPropagation();var s=e("#user-registration-members-list-form");switch(s.find("select#bulk-action-selector-top option:selected").val()){case"delete":n.handle_bulk_delete_action(s)}})}(jQuery,window.ur_members_localized_data);