!function(e,t){if(e(".user-membership-enhanced-select2").select2(),UR_Snackbar)var n=new UR_Snackbar;var r={convert_to_array:function(e){return Object.values(e).reverse().slice(2).reverse()},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},prepend_spinner:function(e){if(e&&e.prepend){return e.prepend('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},if_empty:function(e,t){return null===e||undefined===e||""===e?t:e},toggleSaveButtons:function(t){t=this.if_empty(t,!0),e(".ur-member-save-btn").prop("disabled",!!t)},show_success_message:function(e){return!!n&&(n.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!n&&(n.add({type:"failure",message:e,duration:6}),!0)}},s={prepare_members_data:function(){var t={},n=e(".ur-membership-members-input");return(n=r.convert_to_array(n)).forEach(function(n){var r=e(n),s=r.data("key-name").toLowerCase();t[s]=r.is('input[type="checkbox"]')?r.prop("checked"):r.val()}),t},validate_membership_form:function(){var n=e("#ur-membership-create-form").find("input"),s=new RegExp("^[a-zA-Z0-9._%+-]+@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$"),a=(new Date).toISOString().split("T")[0],i=!0;return(n=r.convert_to_array(n)).every(function(n){var o=e(n),u=o.val(),_=o.attr("required"),c=o.data("key-name");return _&&""===u?(i=!1,r.show_failure_message(t.labels.i18n_error+"! "+c+" "+t.labels.i18n_field_is_required),!1):"Email"!==c||s.test(u)?"Password"===c&&u!==e("#ur-input-type-membership-confirm-password").val()?(i=!1,r.show_failure_message(t.labels.i18n_field_password_field_validation),!1):!("start_date"===c&&u<a)||(i=!1,r.show_failure_message(t.labels.i18n_field_subscription_start_date_validation),!1):(i=!1,r.show_failure_message(t.labels.i18n_field_email_field_validation),!1)}),i},create_member:function(n){if(r.toggleSaveButtons(!0),r.append_spinner(n),this.validate_membership_form()){var s=this.prepare_members_data();this.send_data({action:"user_registration_membership_create_member",members_data:JSON.stringify(s)},{success:function(n){n.success?(t.member_id=n.data.member_id,e(".ur-member-save-btn").hide(),r.show_success_message(n.data.message)):r.show_failure_message(n.data.message)},failure:function(e,n){r.show_failure_message(t.labels.network_error+"("+n+")")},complete:function(){r.remove_spinner(n),r.toggleSaveButtons(!1)}})}else r.remove_spinner(n),r.toggleSaveButtons(!1)},update_member:function(e){},update_membership_status:function(e){},send_data:function(n,r){var s="function"==typeof r.success?r.success:function(){},a="function"==typeof r.failure?r.failure:function(){},i="function"==typeof r.beforeSend?r.beforeSend:function(){},o="function"==typeof r.complete?r.complete:function(){};!n._wpnonce&&t&&(n._wpnonce=t._nonce),e.ajax({type:"post",dataType:"json",url:t.ajax_url,data:n,beforeSend:i,success:s,error:a,complete:o})},handle_bulk_delete_action:function(n){Swal.fire({title:'<img src="'+t.delete_icon+'" id="delete-user-icon">'+t.labels.i18n_prompt_title,html:'<p id="html_1">'+t.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:t.labels.i18n_prompt_delete,cancelButtonText:t.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(a){if(a.isConfirmed){var i=n.find('input[name="users[]"]:checked'),o=[];if(i.length<1)return void r.show_failure_message(t.labels.i18n_prompt_no_membership_selected);i.each(function(){""!==e(this).val()&&o.push(e(this).val())}),s.send_data({action:"user_registration_membership_delete_members",members_ids:JSON.stringify(o)},{success:function(e){e.success?(r.show_success_message(e.data.message),s.remove_deleted_members(i,!0)):r.show_failure_message(e.data.message)},failure:function(e,n){r.show_failure_message(t.labels.network_error+"("+n+")")},complete:function(){}})}})},remove_deleted_members:function(t,n){n?t.each(function(){e(this).parents("tr").remove()}):e(t).parents("tr").remove()}};e(".ur-member-save-btn").on("click",function(n){n.preventDefault(),n.stopPropagation();var r=e(this);t.member_id&&""!==t.member_id?s.update_member(r):s.create_member(r)}),e("#user-registration-members-list-form #doaction,#doaction2").on("click",function(t){t.preventDefault(),t.stopPropagation();var n=e("#user-registration-members-list-form");switch(n.find("select#bulk-action-selector-top option:selected").val()){case"delete":s.handle_bulk_delete_action(n)}})}(jQuery,window.ur_members_localized_data);