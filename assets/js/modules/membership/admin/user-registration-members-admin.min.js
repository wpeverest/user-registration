!function(e,s){if(e(".user-membership-enhanced-select2").select2(),UR_Snackbar)var t=new UR_Snackbar;var r={convert_to_array:function(e){return Object.values(e).reverse().slice(2).reverse()},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},prepend_spinner:function(e){if(e&&e.prepend){return e.prepend('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},if_empty:function(e,s){return null===e||undefined===e||""===e?s:e},toggleSaveButtons:function(s){s=this.if_empty(s,!0),e(".ur-member-save-btn").prop("disabled",!!s)},show_success_message:function(e){return!!t&&(t.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!t&&(t.add({type:"failure",message:e,duration:6}),!0)}},n={prepare_members_data:function(){var s={},t=e(".ur-membership-members-input");return(t=r.convert_to_array(t)).forEach(function(t){var r=e(t),n=r.data("key-name").toLowerCase();s[n]=r.is('input[type="checkbox"]')?r.prop("checked"):r.val()}),s},validate_members_form:function(){var t=e("#ur-membership-create-form").find("input"),n=new RegExp("^[a-zA-Z0-9._%+-]+@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$"),a=(new Date).toISOString().split("T")[0],i=!0;return(t=r.convert_to_array(t)).every(function(t){var o=e(t),m=o.val(),_=o.attr("required"),u=o.data("key-name");return _&&""===m?(i=!1,r.show_failure_message(s.labels.i18n_error+"! "+u+" "+s.labels.i18n_field_is_required),!1):"Email"!==u||n.test(m)?"Password"===u&&m!==e("#ur-input-type-membership-confirm-password").val()?(i=!1,r.show_failure_message(s.labels.i18n_field_password_field_validation),!1):!("start_date"===u&&""===s.member_id&&m<a)||(i=!1,r.show_failure_message(s.labels.i18n_field_subscription_start_date_validation),!1):(i=!1,r.show_failure_message(s.labels.i18n_field_email_field_validation),!1)}),i},create_member:function(t){if(r.toggleSaveButtons(!0),r.append_spinner(t),this.validate_members_form()){var n=this.prepare_members_data();this.send_data({action:"user_registration_membership_create_member",members_data:JSON.stringify(n)},{success:function(t){t.success?(s.member_id=t.data.member_id,e(".ur-member-save-btn").hide(),r.show_success_message(t.data.message),e(location).attr("href",s.members_page_url)):r.show_failure_message(t.data.message)},failure:function(e,t){r.show_failure_message(s.labels.network_error+"("+t+")")},complete:function(){r.remove_spinner(t),r.toggleSaveButtons(!1)}})}else r.remove_spinner(t),r.toggleSaveButtons(!1)},update_member:function(t){if(r.toggleSaveButtons(!0),r.append_spinner(t),this.validate_members_form()){var n=this.prepare_members_data();this.send_data({action:"user_registration_membership_edit_member",members_data:JSON.stringify(n),_wpnonce:s.edit_members_nonce},{success:function(t){t.success?(s.member_id=t.data.member_id,e(".ur-member-save-btn").hide(),r.show_success_message(t.data.message),window.location.reload()):r.show_failure_message(t.data.message)},failure:function(e,t){r.show_failure_message(s.labels.network_error+"("+t+")")},complete:function(){r.remove_spinner(t),r.toggleSaveButtons(!1)}})}else r.remove_spinner(t),r.toggleSaveButtons(!1)},update_membership_status:function(e){},send_data:function(t,r){var n="function"==typeof r.success?r.success:function(){},a="function"==typeof r.failure?r.failure:function(){},i="function"==typeof r.beforeSend?r.beforeSend:function(){},o="function"==typeof r.complete?r.complete:function(){};!t._wpnonce&&s&&(t._wpnonce=s._nonce),e.ajax({type:"post",dataType:"json",url:s.ajax_url,data:t,beforeSend:i,success:n,error:a,complete:o})},handle_bulk_delete_action:function(t){Swal.fire({title:'<img src="'+s.delete_icon+'" id="delete-user-icon">'+s.labels.i18n_prompt_title,html:'<p id="html_1">'+s.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:s.labels.i18n_prompt_delete,cancelButtonText:s.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(a){if(a.isConfirmed){var i=t.find('input[name="users[]"]:checked'),o=[];if(i.length<1)return void r.show_failure_message(s.labels.i18n_prompt_no_membership_selected);i.each(function(){""!==e(this).val()&&o.push(e(this).val())}),n.send_data({action:"user_registration_membership_delete_members",members_ids:JSON.stringify(o)},{success:function(e){e.success?(r.show_success_message(e.data.message),n.remove_deleted_members(i,!0)):r.show_failure_message(e.data.message)},failure:function(e,t){r.show_failure_message(s.labels.network_error+"("+t+")")},complete:function(){}})}})},remove_deleted_members:function(s,t){t?s.each(function(){e(this).parents("tr").remove()}):e(s).parents("tr").remove()}};e(".ur-member-save-btn").on("click",function(t){t.preventDefault(),t.stopPropagation();var r=e(this);s.member_id&&""!==s.member_id?n.update_member(r):n.create_member(r)}),e("#user-registration-members-list-form #doaction,#doaction2").on("click",function(s){s.preventDefault(),s.stopPropagation();var t=e("#user-registration-members-list-form");switch(t.find("select#bulk-action-selector-top option:selected").val()){case"delete":n.handle_bulk_delete_action(t)}}),e("#ur-membership-select").on("change",function(){var s=e(this).val(),t=e(this);if(!t.hasClass("is_loading")){t.addClass("is_loading");e("#plan-detail-container").append('<div class="urm-membership-plan-spinner-container is_loading"><span class="ur-spinner is-active" style="margin-left: 20px"></span></div>');var r={action:"user_registration_membership_get_membership_details",membership_id:s,security:ur_members_localized_data.ur_membership_edit_nonce};e.post(ur_members_localized_data.ajax_url,r,function(s){if(s.success){var r=s.data;e(document).find(".urm-membership-plan-amount").text(r.membership_detail.amount),e(document).find(".urm-membership-subscription-status > span").remove(),e(document).find(".urm-membership-subscription-status").append('<span class="user-registration-badge user-registration-badge--pending">'+r.membership_detail.subscription_status+"</span>"),e(document).find(".urm-membership-expiry-date").text(r.membership_detail.expiration_on),t.removeClass("is_loading"),e(".urm-membership-plan-spinner-container").removeClass("is_loading"),e(".urm-membership-plan-spinner-container").empty()}})}})}(jQuery,window.ur_members_localized_data);