!function(e,t){"use strict";var i;UR_Snackbar&&(i=new UR_Snackbar),e(".user-membership-enhanced-select2").select2();var r=e("#ur-payment-gateway-container"),a=e("#ur-subscription-id-container"),n=e("#ur-subscription-payment-gateway"),s=e("#ur-subscription-plan"),o=e("#ur-subscription-billing-amount"),u=e("#ur-subscription-billing-cycle"),c=e("#ur-billing-cycle-container"),p=e("#ur-start-date-container"),d=e("#ur-expiry-date-container"),l=e("#ur-subscription-start-date"),m=e("#ur-subscription-expiry-date");s.on("change",function(){var i=e(this).val();if(i&&"undefined"!=typeof ur_membership_plans&&Array.isArray(ur_membership_plans)){var s=ur_membership_plans.find(function(e){return String(e.ID)===String(i)});if(s)if(function(e){if(e&&e.meta_value)if(e.meta_value,e.meta_value.amount&&o.val(e.meta_value.amount),"subscription"===e.meta_value.type){var t=e.meta_value.subscription.duration;u.val(t).trigger("change.select2"),e.meta_value.subscription.value||1,[c,p,d].forEach(function(e){e.removeClass("ur-d-none").addClass("ur-d-flex")}),l.prop("required",!0),m.prop("required",!0)}else u.val("").trigger("change.select2"),[c,p,d].forEach(function(e){e.removeClass("ur-d-flex").addClass("ur-d-none")}),l.prop("required",!1).val(""),m.prop("required",!1).val("")}(s),s.meta_value&&s.meta_value.payment_gateways){var f=s.meta_value.payment_gateways,_={},b=t.payment_gateways||{};Object.keys(f).forEach(function(e){if("on"===f[e].status){var t=b[e]||e.charAt(0).toUpperCase()+e.slice(1);_[e]=t}}),Object.keys(_).length>0?(n.hasClass("select2-hidden-accessible")&&n.select2("destroy"),n.empty(),n.append('<option value="">'+(t.i18n_select_payment_gateway||"Select Payment Gateway")+"</option>"),e.each(_,function(e,t){n.append('<option value="'+e+'" data-gateway-key="'+e+'">'+t+"</option>")}),n.select2(),r.show()):(r.hide(),a.hide())}else r.hide(),a.hide();else o.val(""),u.val("").trigger("change.select2"),r.hide(),a.hide(),c.hide(),p.hide(),d.hide(),l.prop("required",!1).val(""),m.prop("required",!1).val("")}else o.val(""),u.val("").trigger("change.select2"),r.hide(),a.hide(),c.hide(),p.hide(),d.hide(),l.prop("required",!1).val(""),m.prop("required",!1).val("")}),n.on("change",function(){"stripe"===e(this).val()?a.show():(a.hide(),e("#ur-subscription-id-field").val(""))}),e('button[form="ur-membership-subscription-edit-form"]').on("click",function(){e('form[id="ur-membership-subscription-edit-form"]').trigger("submit")}),e('form[id="ur-membership-subscription-create-form"]').on("submit",function(r){r.preventDefault();var a=e('button[form="ur-membership-subscription-create-form"]');a.prop("disabled",!0).append('<span class="ur-spinner"></span>'),e.ajax({url:t.ajax_url+"?action=user_registration_membership_create_subscription",type:"POST",data:e(this).serialize(),success:function(e){e.success?(i.add({type:"success",message:e.data.message,duration:5}),setTimeout(function(){window.location.href=t.subscriptions_url},1e3)):i.add({type:"failed",message:e.data.message,duration:5})},error:function(e,r){i.add({type:"failed",message:t.i18n_error,duration:5})},complete:function(){a.prop("disabled",!1).find(".ur-spinner").remove()}})}),e('form[id="ur-membership-subscription-edit-form"]').on("submit",function(r){r.preventDefault();var a=e('button[form="ur-membership-subscription-edit-form"]');a.prop("disabled",!0).append('<span class="ur-spinner"></span>'),e.ajax({url:t.ajax_url+"?action=user_registration_membership_update_subscription",type:"POST",data:e(this).serialize(),success:function(e){e.success?i.add({type:"success",message:e.data.message,duration:5}):i.add({type:"failed",message:e.data.message,duration:5})},error:function(e,r){i.add({type:"failed",message:t.i18n_error,duration:5})},complete:function(){a.prop("disabled",!1).find(".ur-spinner").remove()}})}),e(".submitdelete,.single-delete-subscription").on("click",function(i){i.preventDefault();var r=e(this);Swal.fire({title:'<img src="'+t.delete_icon+'" id="delete-user-icon">'+t.i18n_prompt_delete_title,html:'<p id="html_1">'+t.i18n_prompt_delete_description+"</p>",showCancelButton:!0,confirmButtonText:t.i18n_prompt_delete_confirm,cancelButtonText:t.i18n_prompt_delete_cancel,allowOutsideClick:!1}).then(function(e){e.isConfirmed&&(window.location.href=r.attr("href"))})}),e(".urm-load-more-events").on("click",function(){var i=e(this).closest(".ur-subscription__main-content-wrapper"),r=e(this),a=parseInt(i.data("offset"),10),n=parseInt(i.data("limit"),10),s=parseInt(i.data("total"),10);r.prop("disabled",!0).text(t.i18n_loading_text),e.post(t.ajax_url,{action:"user_registration_pro_load_more_subscription_events",nonce:t._nonce,subscription_id:i.data("subscription-id"),limit:n,offset:a}).done(function(n){if(n.success){var o=e(n.data.html).find(".ur-subscription__event");i.find(".ur-subscription__events-timeline").append(o),a+=n.data.count,i.data("offset",a),a>=s?r.remove():r.prop("disabled",!1).text(t.i18n_view_more_text)}else r.remove()})}),e("#ur-subscription-start-date, #ur-subscription-expiry-date").on("click focus",function(){this.showPicker&&this.showPicker()})}(jQuery,window.ur_subscription_data);