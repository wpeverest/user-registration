!function(e,t){if("undefined"!=typeof UR_Snackbar)var i=new UR_Snackbar;var r={init:function(){r.bind_ui_actions()},if_empty:function(e,t){return null===e||undefined===e||""===e?t:e},toggleSaveButtons:function(t){t=r.if_empty(t,!0),e(".ur-membership-group-save-btn").prop("disabled",!!t)},show_success_message:function(e){return!!i&&(i.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!i&&(i.add({type:"failure",message:e,duration:6}),!0)},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},validate_membership_group_form:function(){var t=e("#ur-membership-group-create-form").find("#ur-membership-main-fields .urmg-input");t=Object.values(t).reverse().slice(2);return!!r.regular_validation(t,!0)},prepare_membership_data:function(){var i={},r={},n=e("#ur-membership-group-create-form");return i={name:n.find("#ur-input-type-membership-group-name").val(),description:n.find("#ur-input-type-membership-group-description").val(),status:n.find("#ur-membership-group-status").prop("checked")},t.membership_group_id&&(i.ID=t.membership_group_id),r.memberships=n.find("#ur-input-type-membership-group-memberships").select2("val"),{post_data:i,post_meta_data:r}},regular_validation:function(i,n){return i.every(function(i){var s=e(i),a=s.val(),o=s.attr("required"),p=s.data("key-name");return!o||!(""===a||null===a||a.length<1)||(n=!1,r.show_failure_message(t.labels.i18n_error+"! "+p+" "+t.labels.i18n_field_is_required),!1)}),n},create_membership_group:function(i){if(r.toggleSaveButtons(!0),r.append_spinner(i),this.validate_membership_group_form()){var n=this.prepare_membership_data();this.send_data({action:"user_registration_membership_create_membership_group",membership_groups_data:JSON.stringify(n)},{success:function(n){n.success?(t.membership_group_id=n.data.membership_group_id,i.text(t.labels.i18n_save),r.show_success_message(n.data.message),e(location).attr("href",t.membership_group_url)):r.show_failure_message(n.data.message)},failure:function(e,i){r.show_failure_message(t.labels.network_error+"("+i+")")},complete:function(){r.remove_spinner(i),r.toggleSaveButtons(!1)}})}else r.remove_spinner(i),r.toggleSaveButtons(!1)},bind_ui_actions:function(){e(document).on("change","#ur-setting-form .ur-general-setting-membership_listing_option select",function(){var t=e(this),i=e("#ur-setting-form .ur-general-setting-membership_group");i.hide(),e(".ur-general-setting-membership_listing_option select").val(t.val()),"group"===t.val()?i.show():r.fetch_memberships(-1)}),e(document).on("change","#ur-setting-form .ur-general-setting-membership_group select",function(){var t=e(this),i=Number(t.val());e(".ur-general-setting-membership_group select").val(i),r.fetch_memberships(i)}),e(document).on("click","#ur-membership-group-create-form .ur-membership-group-save-btn",function(t){t.preventDefault(),t.stopPropagation();var i=e(this);r.create_membership_group(i)}),e("#ur-input-type-membership-group-memberships").select2({placeholder:"Select memberships.",minimumResultsForSearch:-1,multiple:!0}),e("#membership-group-list #doaction,#doaction2").on("click",function(t){t.preventDefault(),t.stopPropagation();var i=e("#membership-group-list");switch(i.find("select#bulk-action-selector-top option:selected").val()){case"delete":r.handle_bulk_delete_action(i)}}),e(".delete-membership-groups").on("click",function(t){t.preventDefault(),t.stopPropagation(),r.delete_single_membership_group(e(this))}),e(document).on("ur_new_field_created",function(){var t=e("#paypal-standard-settings"),i=e("#stripe-settings"),r=e("#ur-setting-form .ur-general-setting-membership_group");t.show(),i.show(),r.hide(),e(".ur-selected-inputs").find('div[data-field-key="membership"]').length&&(user_registration_form_builder_data.form_has_membership_field=!0,t.hide(),i.hide())}),e(document).on("ur_rendered_field_options",function(){var t=e("#ur-setting-form .ur-general-setting-membership_listing_option select"),i=e("#ur-setting-form .ur-general-setting-membership_group");i.show(),"all"===t.val()&&i.hide()}),e(document).on("user_registration_admin_before_form_submit",function(t,i){"all"===e('[data-field="membership_listing_option"]').val()&&e(".urmg-container input").length<1&&(i.data.empty_membership_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_available}]),e('[data-field="membership_group"]').length&&"0"==e('[data-field="membership_group"]').val()&&"group"===e('[data-field="membership_listing_option"]').val()&&(i.data.empty_membership_group_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_group_selected}]),i.data.payment_field_present&&e(".ur-selected-inputs").find('div[data-field-key="membership"]').length&&(i.data.payment_field_present_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_payment_field_present}])})},delete_single_membership_group:function(i){var r=new URLSearchParams(i.attr("href")).get("form");null===r?Swal.fire({title:'<img src="'+t.delete_icon+'" id="delete-user-icon">'+t.labels.i18n_prompt_title,html:'<p id="html_1">'+t.labels.i18n_prompt_single_subtitle+"</p>",showCancelButton:!0,confirmButtonText:t.labels.i18n_prompt_delete,cancelButtonText:t.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(t){t.isConfirmed&&e(location).attr("href",i.attr("href"))}):Swal.fire({title:'<img src="'+t.delete_icon+'" id="delete-user-icon">'+t.labels.i18n_prompt_title,html:'<p id="html_1">'+t.labels.i18n_prompt_cannot_delete+"`"+r+"`.</p>",allowOutsideClick:!0})},handle_bulk_delete_action:function(i){Swal.fire({title:'<img src="'+t.delete_icon+'" id="delete-user-icon">'+t.labels.i18n_prompt_title,html:'<p id="html_1">'+t.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:t.labels.i18n_prompt_delete,cancelButtonText:t.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(n){if(n.isConfirmed){var s=i.find('input[name="membership_group[]"]:checked'),a=[];if(s.length<1)return void r.show_failure_message(t.labels.i18n_prompt_no_membership_selected);s.each(function(){""!==e(this).val()&&a.push(e(this).val())}),r.send_data({action:"user_registration_membership_delete_membership_groups",membership_group_ids:JSON.stringify(a)},{success:function(e){e.success?(r.show_success_message(e.data.message),r.remove_deleted_memberships(s,!0)):r.show_failure_message(e.data.message)},failure:function(e,i){r.show_failure_message(t.labels.network_error+"("+i+")")},complete:function(){}})}})},remove_deleted_memberships:function(t,i){i?t.each(function(){e(this).parents("tr").remove()}):e(t).parents("tr").remove()},fetch_memberships:function(t){var i=e(".urmg-loader"),n=e(".urmg-container"),s=e(".empty-urmg-label");if(n.empty(),0===t)return s.text(user_registration_form_builder_data.i18n_admin.i18n_empty_membership_group_text),void s.show();s.hide(),r.append_spinner(i),r.send_data({action:"user_registration_membership_get_group_memberships",group_id:t,list_type:-1===t?"all":"group"},{success:function(e){e.success?r.handle_membership_by_group_success_response(e.data,t):(s.text(user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_available),s.show())},failure:function(e,t){},complete:function(){r.remove_spinner(i)}})},handle_membership_by_group_success_response:function(t,i){var r="",n=e(".urmg-container");e(t.plans).each(function(e,t){r+='<label><input type="radio" value="'+t.ID+'" disabled/><span>'+t.title+"</span> - <span> "+t.period+" </span></label>"}),n.append(r),e(".ur-selected-inputs .ur-general-setting-membership_group").find('select[data-field="membership_group"]  option[value="'+i+'"]').attr("selected","selected")},send_data:function(i,r){var n="function"==typeof r.success?r.success:function(){},s="function"==typeof r.failure?r.failure:function(){},a="function"==typeof r.beforeSend?r.beforeSend:function(){},o="function"==typeof r.complete?r.complete:function(){};!i._wpnonce&&t&&(i._wpnonce=t._nonce),e.ajax({type:"post",dataType:"json",url:t.ajax_url,data:i,beforeSend:a,success:n,error:s,complete:o})}};e(document).ready(function(){r.init()})}(jQuery,window.urmg_localized_data);