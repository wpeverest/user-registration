!function(e,i){if("undefined"!=typeof UR_Snackbar)var r=new UR_Snackbar;var t={init:function(){t.bind_ui_actions()},if_empty:function(e,i){return null==e||""===e?i:e},toggleSaveButtons:function(i){i=t.if_empty(i,!0),e(".ur-membership-group-save-btn").prop("disabled",!!i)},show_success_message:function(e){return!!r&&(r.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!r&&(r.add({type:"failure",message:e,duration:6}),!0)},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},validate_membership_group_form:function(){var i=e("#ur-membership-group-create-form").find("#ur-membership-main-fields .urmg-input");return i=Object.values(i).reverse().slice(2),!!t.regular_validation(i,!0)},prepare_membership_data:function(){var r={},t={},s=e("#ur-membership-group-create-form");r={name:s.find("#ur-input-type-membership-group-name").val(),description:s.find("#ur-input-type-membership-group-description").val(),status:e("#ur-membership-group-status").prop("checked")},i.membership_group_id&&(r.ID=i.membership_group_id),t.memberships=s.find("#ur-input-type-membership-group-memberships").select2("val");var a=e('input[name="ur_membership_enable_multiple_memberships"]').is(":checked"),n=e('input[name="ur_membership_enable_upgrade"]:checked').is(":checked");return t.mode=a?"multiple":n?"upgrade":"","upgrade"===t.mode&&(t.upgrade_type=e('input[name="ur_membership_upgrade_type"]:checked').val(),t.upgrade_path=e('input[name="ur_membership_upgrade_path"]').val(),t.upgrade_order=e('input[name="ur_membership_upgrade_order"]').val()),{post_data:r,post_meta_data:t}},regular_validation:function(r,s){return r.every(function(r){var a=e(r),n=a.val(),m=a.attr("required"),l=a.data("key-name");return!m||!(""===n||null===n||n.length<1)||(s=!1,t.show_failure_message(i.labels.i18n_error+"! "+l+" "+i.labels.i18n_field_is_required),!1)}),s},create_membership_group:function(r){if(t.toggleSaveButtons(!0),t.append_spinner(r),this.validate_membership_group_form()){var s=this.prepare_membership_data();this.send_data({action:"user_registration_membership_create_membership_group",membership_groups_data:JSON.stringify(s)},{success:function(s){s.success?(i.membership_group_id=s.data.membership_group_id,r.text(i.labels.i18n_save),t.show_success_message(s.data.message),e(location).attr("href",i.membership_group_url)):t.show_failure_message(s.data.message)},failure:function(e,r){t.show_failure_message(i.labels.network_error+"("+r+")")},complete:function(){t.remove_spinner(r),t.toggleSaveButtons(!1)}})}else t.remove_spinner(r),t.toggleSaveButtons(!1)},bind_ui_actions:function(){e(document).on("change","#ur-setting-form .ur-general-setting-membership_listing_option select",function(){var i=e(this),r=e("#ur-setting-form .ur-general-setting-membership_group");r.hide().find("select").prop("selectedIndex",0).trigger("change"),e(".ur-general-setting-membership_listing_option select").val(i.val()),"group"===i.val()?r.show():t.fetch_memberships(-1)}),e(document).on("change",'[data-field-group="payments"] input[name^="user_registration_enable_"]',function(){e("[data-field-group='payments'] input[name^='user_registration_enable_']").is(":checked")?($membershipField=e(".ur-registered-list").find("li[data-field-id='user_registration_membership']"),$membershipField.draggable("disable"),$membershipField.addClass("ur-membership-field-disabled"),$membershipField.addClass("ur-locked-field")):($membershipField=e(".ur-registered-list").find("li[data-field-id='user_registration_membership']"),$membershipField.draggable("enable"),$membershipField.removeClass("ur-membership-field-disabled"),$membershipField.removeClass("ur-locked-field"))}),e(document).on("change","#ur-setting-form .ur-general-setting-membership_group select",function(){var i=e(this),r=Number(i.val());e(".ur-general-setting-membership_group select").val(r),t.fetch_memberships(r)}),e(document).on("click",".ur-membership-group-save-btn",function(i){i.preventDefault(),i.stopPropagation();var r=e(this);t.create_membership_group(r)}),e("#ur-input-type-membership-group-memberships").select2({placeholder:"Select memberships.",minimumResultsForSearch:-1,multiple:!0}),e("#membership-group-list #doaction,#doaction2").on("click",function(i){i.preventDefault(),i.stopPropagation();var r=e("#membership-group-list");if("delete"===r.find("select#bulk-action-selector-top option:selected").val())t.handle_bulk_delete_action(r)}),e(".delete-membership-groups").on("click",function(i){i.preventDefault(),i.stopPropagation(),t.delete_single_membership_group(e(this))}),e(document).on("ur_new_field_created",function(){var i=e("#paypal-standard-settings"),r=e("#stripe-settings"),t=e("#ur-setting-form .ur-general-setting-membership_group");if(i.show(),r.show(),t.hide(),e(".ur-selected-inputs").find('div[data-field-key="membership"]').length){user_registration_form_builder_data.form_has_membership_field=!0,i.addClass("disabled"),r.addClass("disabled");var s=e("#ur-tab-field-settings").find(".form-settings-tab[data-field-group='payments']");e.each(s,function(){e(this).addClass("disabled")}),e("#ur-field-settings").find("[data-field-group='payments']").each(function(){e(this).find(":input").prop("disabled",!0),e(this).css("opacity",.25)});var a=e(".ur-registered-from").find(".ur-payment-fields").find("li");e.each(a,function(i,r){$this=e(r),e(".ur-input-grids").find('.ur-field[data-field-key="membership"]').length>0&&($this.draggable("disable"),$this.addClass("ur-locked-field"),$this.addClass("ur-membership-payment-field-disabled"))})}}),e(document).on("ur_field_removed",function(i,r){if("membership"===r.fieldKey){user_registration_form_builder_data.form_has_membership_field=!1;var t=e("#ur-tab-field-settings").find(".form-settings-tab[data-field-group='payments']");e.each(t,function(){e(this).removeClass("disabled")}),e("#ur-field-settings").find("[data-field-group='payments']").each(function(){e(this).find(":input").prop("disabled",!1),e(this).css("opacity",1)});var s=e("#ur-tab-registered-fields").find("ul.ur-registered-list").find("li.ur-membership-payment-field-disabled");e.each(s,function(){var i=e(this);i.hasClass("ur-locked-field")&&i.removeClass("ur-locked-field"),i.removeClass("ur-membership-payment-field-disabled"),i.draggable("enable")})}}),e(document).on("ur_rendered_field_options",function(){var i=e("#ur-setting-form .ur-general-setting-membership_listing_option select"),r=e("#ur-setting-form .ur-general-setting-membership_group");r.show(),"all"===i.val()&&r.hide()}),e(document).on("user_registration_admin_before_form_submit",function(i,r){"all"===e('[data-field="membership_listing_option"]').val()&&e(".urmg-container input").length<1&&(r.data.empty_membership_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_available}]),e('[data-field="membership_group"]').length&&"0"==e('[data-field="membership_group"]').val()&&"group"===e('[data-field="membership_listing_option"]').val()&&(r.data.empty_membership_group_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_group_selected}]),r.data.payment_field_present&&e(".ur-selected-inputs").find('div[data-field-key="membership"]').length&&(r.data.payment_field_present_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_payment_field_present}])}),e(document).on("ur_field_removed",function(i,r){"membership"===r.fieldKey&&e(".ur-general-setting-membership_listing_option").remove()}),e(document).find("#ur-input-type-membership-group-memberships").on("change",function(i){var r=e(this).val();t.build_upgrade_paths(r,"new")}),e(document).find("input[name='ur_membership_enable_upgrade']").on("change",function(i){var r=e("#ur-input-type-membership-group-memberships").val();e(this).is(":checked")?e(".ur-membership-upgrade-container").show():e(".ur-membership-upgrade-container").hide(),t.build_upgrade_paths(r,"mode")}),e(document).find(".ur-sortable-list").sortable({handle:".ur-drag-handle",placeholder:"ur-sortable-placeholder",update:function(){var i=[];e(".ur-sortable-item").each(function(){i.push(e(this).data("id"))}),t.build_upgrade_paths(i,"sort")}}),e(document).find("input[name='ur_membership_enable_multiple_memberships']").on("change",function(i){e(this).is(":checked")?(e(this).closest("form").find(".ur-membership-enable-upgrade-container").hide(),e(this).closest("form").find(".ur-membership-upgrade-container").hide()):(e(this).closest("form").find(".ur-membership-enable-upgrade-container").show(),e(this).closest("form").find("input[name='ur_membership_enable_upgrade']").is(":checked")&&e(this).closest("form").find(".ur-membership-upgrade-container").show())})},delete_single_membership_group:function(e){var r=new URLSearchParams(e.attr("href")).get("form"),s=e.data("membership-group-id");null===r?(t.append_spinner(parent),Swal.fire({title:'<img src="'+i.delete_icon+'" id="delete-user-icon">'+i.labels.i18n_prompt_title,html:'<p id="html_1">'+i.labels.i18n_prompt_single_subtitle+"</p>",showCancelButton:!0,confirmButtonText:i.labels.i18n_prompt_delete,cancelButtonText:i.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(r){r.isConfirmed&&t.send_data({action:"user_registration_membership_delete_membership_group",membership_group_id:s},{success:function(i){i.success?(t.show_success_message(i.data.message),t.remove_deleted_memberships(e,!1)):t.show_failure_message(i.data.message)},failure:function(e,r){t.show_failure_message(i.labels.network_error+"("+r+")")},complete:function(){t.remove_spinner(e.closest(".delete"))}})})):Swal.fire({title:'<img src="'+i.delete_icon+'" id="delete-user-icon">'+i.labels.i18n_prompt_title,html:'<p id="html_1">'+i.labels.i18n_prompt_cannot_delete+"`"+r+"`.</p>",allowOutsideClick:!0})},handle_bulk_delete_action:function(r){Swal.fire({title:'<img src="'+i.delete_icon+'" id="delete-user-icon">'+i.labels.i18n_prompt_title,html:'<p id="html_1">'+i.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:i.labels.i18n_prompt_delete,cancelButtonText:i.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(s){if(s.isConfirmed){var a=r.find('input[name="membership_group[]"]:checked'),n=[];if(a.length<1)return void t.show_failure_message(i.labels.i18n_prompt_no_membership_selected);a.each(function(){""!==e(this).val()&&n.push(e(this).val())}),t.send_data({action:"user_registration_membership_delete_membership_groups",membership_group_ids:JSON.stringify(n)},{success:function(e){e.success?(t.show_success_message(e.data.message),t.remove_deleted_memberships(a,!0)):t.show_failure_message(e.data.message)},failure:function(e,r){t.show_failure_message(i.labels.network_error+"("+r+")")},complete:function(){}})}})},remove_deleted_memberships:function(i,r){r?i.each(function(){e(this).parents("tr").remove()}):e(i).parents("tr").remove()},fetch_memberships:function(i){var r=e(".urmg-loader"),s=e(".urmg-container"),a=e(".empty-urmg-label");if(s.empty(),0===i)return a.text(user_registration_form_builder_data.i18n_admin.i18n_empty_membership_group_text),void a.show();a.hide(),t.append_spinner(r),t.send_data({action:"user_registration_membership_get_group_memberships",group_id:i,list_type:-1===i?"all":"group"},{success:function(e){e.success?t.handle_membership_by_group_success_response(e.data,i):(a.text(user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_available),a.show())},failure:function(e,i){},complete:function(){t.remove_spinner(r)}})},handle_membership_by_group_success_response:function(r,t){var s=e(".urmg-container"),a=e(".empty-urmg-label"),n=r.plans||[],m="",l=i.gateway_images||{},p=i.active_payment_gateways||{},u=i.plugin_url||"",o=i.currency_symbol||"$";if(0===n.length)return a.text(user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_available),void a.show();a.hide(),m+='<div class="urmg-membership-plans">',e(n).each(function(e,i){var r=0===e,t=r?"selected":"",s=i.ID||"",a=i.title||"",n=i.period||"",l=i.type||"free",p=i.amount||0;m+='<div class="urmg-plan-card '+t+'" data-plan-id="'+s+'" data-plan-amount="'+p+'" data-plan-type="'+l+'">',m+='<input type="radio" name="urm_membership" value="'+s+'" '+(r?"checked":"")+" disabled/>",m+='<div class="urmg-plan-header">',m+="<div>",m+='<div class="urmg-plan-title">'+a+"</div>",m+="</div>",m+='<div class="urmg-plan-price">'+n+"</div>",m+="</div>",m+="</div>"}),m+="</div>",m+='<div class="urmg-total-container">',m+='<span class="urmg-total-label">Total:</span>',m+='<span class="urmg-total-amount" id="urmg-total-amount">'+(o+"0.00")+"</span>",m+="</div>";var d=!1;if(n.length>1)d=!0;else if(1===n.length){"free"!==(n[0].type||"free")&&(d=!0)}if(d&&Object.keys(p).length>0){m+='<div class="urmg-payment-gateways">',m+='<label class="urmg-payment-gateways-label">'+i.labels.i18n_select_payment_gateway+'<span class="required">*</span></label>',m+='<div class="urmg-gateway-buttons">';var _=0;e.each(p,function(e,i){var r=0===_,t=r?"selected":"",s=l[e]||"",a=s?u+"/assets/images/settings-icons/membership-field/"+s:"";m+='<label class="urmg-gateway-btn '+t+'">',m+='<input type="radio" name="urm_payment_method" value="'+e+'" '+(r?"checked":"")+" disabled/>",a&&(m+='<img src="'+a+'" alt="'+i+'" class="urmg-gateway-icon" />'),m+='<span class="urmg-gateway-label">'+i+"</span>",m+="</label>",_++}),m+="</div>",m+="</div>"}s.append(m),e(".ur-selected-inputs .ur-general-setting-membership_group").find('select[data-field="membership_group"]  option[value="'+t+'"]').attr("selected","selected")},send_data:function(r,t){var s="function"==typeof t.success?t.success:function(){},a="function"==typeof t.failure?t.failure:function(){},n="function"==typeof t.beforeSend?t.beforeSend:function(){},m="function"==typeof t.complete?t.complete:function(){};!r._wpnonce&&i&&(r._wpnonce=i._nonce),e.ajax({type:"post",dataType:"json",url:i.ajax_url,data:r,beforeSend:n,success:s,error:a,complete:m})},build_upgrade_paths:function(r,t){var s=e('input[name="ur_membership_enable_multiple_memberships"]').is(":checked"),a=e('input[name="ur_membership_enable_upgrade"]').is(":checked");if(membership_mode=s?"multiple":a?"upgrade":"","upgrade"===membership_mode){e('input[name="ur_membership_upgrade_path"]').val();var n="sort"===t?r:e('input[name="ur_membership_upgrade_order"]').val(),m=n.slice();if("new"===t){m=JSON.parse(m);for(var l=r.slice(),p=0;p<l.length;p++)l[p]=parseInt(l[p],10);for(p=m.length-1;p>=0;p--)-1===l.indexOf(m[p])&&m.splice(p,1);for(p=0;p<l.length;p++)-1===m.indexOf(l[p])&&(m[m.length]=l[p])}else"mode"==t&&(m=JSON.parse(m)).length<1&&(m=r);m.length>0&&(JSON.stringify(r)===n?e(document).find(".ur-membership-upgrade-container").show():e.ajax({type:"post",dataType:"json",url:i.ajax_url,data:{action:"user_registration_membership_fetch_upgrade_path",membership_ids:m},success:function(i){if(i.success){var r=i.data.upgrade_paths,t=i.data.upgrade_order,s=i.data.upgrade_paths_order;e('input[name="ur_membership_upgrade_path"]').val(JSON.stringify(r)),e("#ur-membership-upgrade-order").val(JSON.stringify(t)),e(".ur-sortable-list").html(s)}else e('input[name="ur_membership_upgrade_path"]').val("");e(document).find(".ur-membership-upgrade-container").show()}}))}else e(document).find(".ur-membership-upgrade-container").hide()}};e(document).ready(function(){t.init()})}(jQuery,window.urmg_localized_data);