!function(e,i){if("undefined"!=typeof UR_Snackbar)var t=new UR_Snackbar;var r={init:function(){r.bind_ui_actions()},if_empty:function(e,i){return null===e||undefined===e||""===e?i:e},toggleSaveButtons:function(i){i=r.if_empty(i,!0),e(".ur-membership-group-save-btn").prop("disabled",!!i)},show_success_message:function(e){return!!t&&(t.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!t&&(t.add({type:"failure",message:e,duration:6}),!0)},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},validate_membership_group_form:function(){var i=e("#ur-membership-group-create-form").find("#ur-membership-main-fields .urmg-input");i=Object.values(i).reverse().slice(2);return!!r.regular_validation(i,!0)},prepare_membership_data:function(){var t={},r={},s=e("#ur-membership-group-create-form");return t={name:s.find("#ur-input-type-membership-group-name").val(),description:s.find("#ur-input-type-membership-group-description").val(),status:s.find("#ur-membership-group-status").prop("checked")},i.membership_group_id&&(t.ID=i.membership_group_id),r.memberships=s.find("#ur-input-type-membership-group-memberships").select2("val"),{post_data:t,post_meta_data:r}},regular_validation:function(t,s){return t.every(function(t){var n=e(t),a=n.val(),o=n.attr("required"),l=n.data("key-name");return!o||!(""===a||null===a||a.length<1)||(s=!1,r.show_failure_message(i.labels.i18n_error+"! "+l+" "+i.labels.i18n_field_is_required),!1)}),s},create_membership_group:function(t){if(r.toggleSaveButtons(!0),r.append_spinner(t),this.validate_membership_group_form()){var s=this.prepare_membership_data();this.send_data({action:"user_registration_membership_create_membership_group",membership_groups_data:JSON.stringify(s)},{success:function(s){s.success?(i.membership_group_id=s.data.membership_group_id,t.text(i.labels.i18n_save),r.show_success_message(s.data.message),e(location).attr("href",i.membership_group_url)):r.show_failure_message(s.data.message)},failure:function(e,t){r.show_failure_message(i.labels.network_error+"("+t+")")},complete:function(){r.remove_spinner(t),r.toggleSaveButtons(!1)}})}else r.remove_spinner(t),r.toggleSaveButtons(!1)},bind_ui_actions:function(){e(document).on("change","#ur-setting-form .ur-general-setting-membership_listing_option select",function(){var i=e(this),t=e("#ur-setting-form .ur-general-setting-membership_group");t.hide(),e(".ur-general-setting-membership_listing_option select").val(i.val()),"group"===i.val()?t.show():r.fetch_memberships(-1)}),e(document).on("change",'[data-field-group="payments"] input[name^="user_registration_enable_"]',function(){e("[data-field-group='payments'] input[name^='user_registration_enable_']").is(":checked")?($membershipField=e(".ur-registered-list").find("li[data-field-id='user_registration_membership']"),$membershipField.draggable("disable"),$membershipField.addClass("ur-membership-field-disabled"),$membershipField.addClass("ur-locked-field")):($membershipField=e(".ur-registered-list").find("li[data-field-id='user_registration_membership']"),$membershipField.draggable("enable"),$membershipField.removeClass("ur-membership-field-disabled"),$membershipField.removeClass("ur-locked-field"))}),e(document).on("change","#ur-setting-form .ur-general-setting-membership_group select",function(){var i=e(this),t=Number(i.val());e(".ur-general-setting-membership_group select").val(t),r.fetch_memberships(t)}),e(document).on("click","#ur-membership-group-create-form .ur-membership-group-save-btn",function(i){i.preventDefault(),i.stopPropagation();var t=e(this);r.create_membership_group(t)}),e("#ur-input-type-membership-group-memberships").select2({placeholder:"Select memberships.",minimumResultsForSearch:-1,multiple:!0}),e("#membership-group-list #doaction,#doaction2").on("click",function(i){i.preventDefault(),i.stopPropagation();var t=e("#membership-group-list");switch(t.find("select#bulk-action-selector-top option:selected").val()){case"delete":r.handle_bulk_delete_action(t)}}),e(".delete-membership-groups").on("click",function(i){i.preventDefault(),i.stopPropagation(),r.delete_single_membership_group(e(this))}),e(document).on("ur_new_field_created",function(){var i=e("#paypal-standard-settings"),t=e("#stripe-settings"),r=e("#ur-setting-form .ur-general-setting-membership_group");if(i.show(),t.show(),r.hide(),e(".ur-selected-inputs").find('div[data-field-key="membership"]').length){user_registration_form_builder_data.form_has_membership_field=!0,i.addClass("disabled"),t.addClass("disabled");var s=e("#ur-tab-field-settings").find(".form-settings-tab[data-field-group='payments']");e.each(s,function(){e(this).addClass("disabled")}),e("#ur-field-settings").find("[data-field-group='payments']").each(function(){e(this).find(":input").prop("disabled",!0),e(this).css("opacity",.25)});var n=e(".ur-registered-from").find(".ur-payment-fields").find("li");e.each(n,function(i,t){$this=e(t);e(".ur-input-grids").find('.ur-field[data-field-key="membership"]').length>0&&($this.draggable("disable"),$this.addClass("ur-locked-field"),$this.addClass("ur-membership-payment-field-disabled"))})}}),e(document).on("ur_field_removed",function(i,t){if("membership"===t.fieldKey){user_registration_form_builder_data.form_has_membership_field=!1;var r=e("#ur-tab-field-settings").find(".form-settings-tab[data-field-group='payments']");e.each(r,function(){e(this).removeClass("disabled")}),e("#ur-field-settings").find("[data-field-group='payments']").each(function(){e(this).find(":input").prop("disabled",!1),e(this).css("opacity",1)});var s=e("#ur-tab-registered-fields").find("ul.ur-registered-list").find("li.ur-membership-payment-field-disabled");e.each(s,function(){var i=e(this);i.hasClass("ur-locked-field")&&i.removeClass("ur-locked-field"),i.removeClass("ur-membership-payment-field-disabled"),i.draggable("enable")})}}),e(document).on("ur_rendered_field_options",function(){var i=e("#ur-setting-form .ur-general-setting-membership_listing_option select"),t=e("#ur-setting-form .ur-general-setting-membership_group");t.show(),"all"===i.val()&&t.hide()}),e(document).on("user_registration_admin_before_form_submit",function(i,t){"all"===e('[data-field="membership_listing_option"]').val()&&e(".urmg-container input").length<1&&(t.data.empty_membership_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_available}]),e('[data-field="membership_group"]').length&&"0"==e('[data-field="membership_group"]').val()&&"group"===e('[data-field="membership_listing_option"]').val()&&(t.data.empty_membership_group_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_group_selected}]),t.data.payment_field_present&&e(".ur-selected-inputs").find('div[data-field-key="membership"]').length&&(t.data.payment_field_present_status=[{validation_status:!1,validation_message:user_registration_form_builder_data.i18n_admin.i18n_prompt_payment_field_present}])}),e(document).on("ur_field_removed",function(i,t){"membership"===t.fieldKey&&e(".ur-general-setting-membership_listing_option").remove()})},delete_single_membership_group:function(t){var r=new URLSearchParams(t.attr("href")).get("form");null===r?Swal.fire({title:'<img src="'+i.delete_icon+'" id="delete-user-icon">'+i.labels.i18n_prompt_title,html:'<p id="html_1">'+i.labels.i18n_prompt_single_subtitle+"</p>",showCancelButton:!0,confirmButtonText:i.labels.i18n_prompt_delete,cancelButtonText:i.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(i){i.isConfirmed&&e(location).attr("href",t.attr("href"))}):Swal.fire({title:'<img src="'+i.delete_icon+'" id="delete-user-icon">'+i.labels.i18n_prompt_title,html:'<p id="html_1">'+i.labels.i18n_prompt_cannot_delete+"`"+r+"`.</p>",allowOutsideClick:!0})},handle_bulk_delete_action:function(t){Swal.fire({title:'<img src="'+i.delete_icon+'" id="delete-user-icon">'+i.labels.i18n_prompt_title,html:'<p id="html_1">'+i.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:i.labels.i18n_prompt_delete,cancelButtonText:i.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(s){if(s.isConfirmed){var n=t.find('input[name="membership_group[]"]:checked'),a=[];if(n.length<1)return void r.show_failure_message(i.labels.i18n_prompt_no_membership_selected);n.each(function(){""!==e(this).val()&&a.push(e(this).val())}),r.send_data({action:"user_registration_membership_delete_membership_groups",membership_group_ids:JSON.stringify(a)},{success:function(e){e.success?(r.show_success_message(e.data.message),r.remove_deleted_memberships(n,!0)):r.show_failure_message(e.data.message)},failure:function(e,t){r.show_failure_message(i.labels.network_error+"("+t+")")},complete:function(){}})}})},remove_deleted_memberships:function(i,t){t?i.each(function(){e(this).parents("tr").remove()}):e(i).parents("tr").remove()},fetch_memberships:function(i){var t=e(".urmg-loader"),s=e(".urmg-container"),n=e(".empty-urmg-label");if(s.empty(),0===i)return n.text(user_registration_form_builder_data.i18n_admin.i18n_empty_membership_group_text),void n.show();n.hide(),r.append_spinner(t),r.send_data({action:"user_registration_membership_get_group_memberships",group_id:i,list_type:-1===i?"all":"group"},{success:function(e){e.success?r.handle_membership_by_group_success_response(e.data,i):(n.text(user_registration_form_builder_data.i18n_admin.i18n_prompt_no_membership_available),n.show())},failure:function(e,i){},complete:function(){r.remove_spinner(t)}})},handle_membership_by_group_success_response:function(i,t){var r="",s=e(".urmg-container");e(i.plans).each(function(e,i){r+='<label><input type="radio" value="'+i.ID+'" disabled/><span class="urm-membership-title">'+i.title+"</span> - <span> "+i.period+" </span></label>"}),s.append(r),e(".ur-selected-inputs .ur-general-setting-membership_group").find('select[data-field="membership_group"]  option[value="'+t+'"]').attr("selected","selected")},send_data:function(t,r){var s="function"==typeof r.success?r.success:function(){},n="function"==typeof r.failure?r.failure:function(){},a="function"==typeof r.beforeSend?r.beforeSend:function(){},o="function"==typeof r.complete?r.complete:function(){};!t._wpnonce&&i&&(t._wpnonce=i._nonce),e.ajax({type:"post",dataType:"json",url:i.ajax_url,data:t,beforeSend:a,success:s,error:n,complete:o})}};e(document).ready(function(){r.init()})}(jQuery,window.urmg_localized_data);