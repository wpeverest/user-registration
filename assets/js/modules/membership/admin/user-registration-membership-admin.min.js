!function(e,r){if(UR_Snackbar)var a=new UR_Snackbar;var s=!1,i=!1;e(".user-membership-enhanced-select2").select2();var t={append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},prepend_spinner:function(e){if(e&&e.prepend){return e.prepend('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},if_empty:function(e,r){return null===e||undefined===e||""===e?r:e},toggleSaveButtons:function(r){r=t.if_empty(r,!0),e(".ur-membership-save-btn").prop("disabled",!!r)},show_success_message:function(e){return!!a&&(a.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!a&&(a.add({type:"failure",message:e,duration:6}),!0)},convert_to_timestamp:function(e,r){var a;switch(r){case"day":a=864e5;break;case"week":a=6048e5;break;case"month":a=2592e6;break;case"year":a=31536e6;break;default:return null}return(new Date).getTime()+e*a},regular_validation:function(a,n,p){return a.every(function(a){var o=e(a),l=o.val(),u=o.attr("required"),m=o.attr("type"),c=o.data("key-name");if(o.removeClass("ur-membership-error"),u&&""===l){n=!1,"form"===p?s=!0:"paypal"===p&&(i=!0);var d=("paypal"===p?r.labels.i18n_paypal:"")+r.labels.i18n_error+"! "+c+" "+r.labels.i18n_field_is_required+" "+("paypal"===p?r.labels.i18n_paypal_setup_error:"");return t.show_failure_message(d),o.addClass("ur-membership-error"),!1}return!("url"===m&&!t.url_validations(l))||(n=!1,"form"===p?s=!0:"paypal"===p&&(i=!0),t.show_failure_message(r.labels.i18n_error+"! "+c+" "+r.labels.i18n_valid_url_field_validation+" "+c),o.addClass("ur-membership-error"),!1)}),n},url_validations:function(e){return new RegExp("^https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b(?:[-a-zA-Z0-9()@:%_\\+.~#?&\\/=]*)$").test(e)},handle_bulk_delete_action:function(a){Swal.fire({title:'<img src="'+r.delete_icon+'" id="delete-user-icon">'+r.labels.i18n_prompt_title,html:'<p id="html_1">'+r.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:r.labels.i18n_prompt_delete,cancelButtonText:r.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(s){if(s.isConfirmed){var i=a.find('input[name="membership[]"]:checked'),p=[];if(i.length<1)return void t.show_failure_message(r.labels.i18n_prompt_no_membership_selected);i.each(function(){""!==e(this).val()&&p.push(e(this).val())}),n.send_data({action:"user_registration_membership_delete_memberships",membership_ids:JSON.stringify(p)},{success:function(e){e.success?(t.show_success_message(e.data.message),n.remove_deleted_memberships(i,!0)):t.show_failure_message(e.data.message)},failure:function(e,a){t.show_failure_message(r.labels.network_error+"("+a+")")},complete:function(){window.location.reload()}})}})}},n={prepare_membership_data:function(){var a={},s={},i=e("#ur-membership-create-form"),t=tinyMCE.get("ur-input-type-membership-description").getContent();if(t=t.replace(/(<img[^>]*?)(")([^>]*?>)/g,function(e,r,a,s){return r+"'"+s.replace(/"/g,"'")}),a={name:i.find("#ur-input-type-membership-name").val(),description:t,status:e("#ur-membership-status").prop("checked")},r.membership_id&&(a.ID=r.membership_id),s.type=i.find('input[name="ur_membership_type"]:checked').val(),s.cancel_subscription=i.find('input[name="ur_membership_cancel_on"]:checked').val(),s.role=i.find("#ur-input-type-membership-role").find(":selected").val(),"free"!==s.type){"paid"!==s.type&&(s.subscription={value:i.find("#ur-membership-duration-value").val(),duration:i.find("#ur-membership-duration").val()},s.trial_status=i.find("#ur-membership-trial-status").val(),"on"===s.trial_status&&(s.trial_data={value:i.find("#ur-membership-trial-duration-value").val(),duration:i.find("#ur-membership-trial-duration").val()}),s.cancel_subscription=i.find('input[name="ur_membership_cancel_on"]:checked').val()),s.amount=i.find("#ur-membership-amount").val();var n=i.find("#ur-membership-pg-paypal:checked").val(),p=i.find("#ur-membership-pg-bank:checked").val(),o=i.find("#ur-membership-pg-stripe:checked").val(),l=i.find("#ur-membership-pg-authorize:checked").val(),u=i.find("#ur-membership-pg-mollie:checked").val();s.payment_gateways={paypal:{status:"off"},stripe:{status:"off"},bank:{status:"off"},authorize:{status:"off"},mollie:{status:"off"}},n&&(s.payment_gateways.paypal={status:n,email:i.find("#ur-input-type-paypal-email").val(),mode:i.find("#ur-membership-paypal-mode").val(),payment_type:i.find("#ur-membership-paypal-payment-type").val(),cancel_url:i.find("#ur-input-type-cancel-url").val(),return_url:i.find("#ur-input-type-return-url").val()},"subscription"===s.type&&(s.payment_gateways.paypal.client_id=i.find("#ur-input-type-client-id").val(),s.payment_gateways.paypal.client_secret=i.find("#ur-input-type-client-secret").val())),p&&(s.payment_gateways.bank={status:p}),o&&(s.payment_gateways.stripe={status:o}),l&&(s.payment_gateways.authorize={status:l}),u&&(s.payment_gateways.mollie={status:u})}return s.upgrade_settings={upgrade_action:i.find("#ur-membership-upgrade-action").is(":checked"),upgrade_path:i.find("#ur-input-type-membership-upgrade-path").val(),upgrade_type:i.find(".urm-upgrade-path-type-container").find('input[name="ur_membership_upgrade_type"]:checked').val()},{post_data:a,post_meta_data:s}},validate_membership_form:function(){s=!1,i=!1;e("#ur-membership-plan-and-price-section");var a=e("#ur-membership-main-fields").find("input"),n=e("#ur-membership-create-form"),p=e("#ur-membership-upgrade-action").is(":checked"),o=!0,l=(a=Object.values(a).reverse().slice(2),t.regular_validation(a,!0,"form"));if(!l)return!1;var u=e("#ur-membership-main-fields").find('input[name="ur_membership_type"]:checked').val(),m=e("#ur-membership-main-fields").find("#ur-membership-amount").val();if("paid"===u||"subscription"===u){e("#ur-membership-amount").removeClass("ur-membership-error"),m<=0&&(o=!1,s=!0,t.show_failure_message(r.labels.i18n_error+"! "+r.labels.i18n_valid_amount_field_validation),e("#ur-membership-amount").addClass("ur-membership-error"));if("on"===e("#ur-membership-trial-status").val()&&"subscription"===u){var c=e("#ur-membership-trial-duration").val(),d=e("#ur-membership-trial-duration-value").val(),_=e("#ur-membership-duration").val(),h=e("#ur-membership-duration-value").val(),b=t.convert_to_timestamp(parseInt(d,10),c),f=t.convert_to_timestamp(parseInt(h,10),_);e("#ur-membership-trial-duration-value").removeClass("ur-membership-error"),e("#ur-membership-trial-duration").removeClass("ur-membership-error"),b>=f&&(o=!1,i=!0,t.show_failure_message(r.labels.i18n_error+"! "+r.labels.i18n_valid_trial_period_field_validation),e("#ur-membership-trial-duration-value").addClass("ur-membership-error"),e("#ur-membership-trial-duration").addClass("ur-membership-error")),e("#ur-membership-duration-value").removeClass("ur-membership-error"),e("#ur-membership-trial-duration-value").removeClass("ur-membership-error"),d<1&&(o=!1,i=!0,t.show_failure_message(r.labels.i18n_error+"! "+r.labels.i18n_valid_min_trial_period_field_validation),e("#ur-membership-trial-duration-value").addClass("ur-membership-error"))}"subscription"===u&&h<1&&(o=!1,s=!0,t.show_failure_message(r.labels.i18n_error+"! "+r.labels.i18n_valid_min_subs_period_field_validation),e("#ur-membership-duration-value").addClass("ur-membership-error"));var v=!1;e("#payment-gateway-container .user-registration-switch__control").each(function(r,a){e(a).is(":checked")&&(v=!0)}),e("#payment-gateway-container .user-registration-card").removeClass("ur-membership-error"),v||(o=!1,i=!0,t.show_failure_message(r.labels.i18n_error+"! "+r.labels.i18n_pg_validation_error),e("#payment-gateway-container .user-registration-card").addClass("ur-membership-error"));if(n.find("#ur-membership-pg-paypal:checked").val()){var g=e("#paypal-section"),y=g.find("input");if(e("#paypal-section").removeClass("ur-membership-error"),"subscription"!==u)y=g.find("input").not('[name^="ur_membership_client_"]'),y=Object.values(y).reverse().slice(2).reverse(),(l=t.regular_validation(y,!0,"paypal"))||(o=!1,i=!0,e("#paypal-section").addClass("ur-membership-error"));else{var w=g.find("#ur-input-type-client-id").val(),k=g.find("#ur-input-type-client-secret").val();""!==w&&""!==k||(o=!1,i=!0,t.show_failure_message(r.labels.i18n_paypal+" "+r.labels.i18n_error+"! "+r.labels.i18n_paypal_client_secret_id_error),e("#paypal-section").addClass("ur-membership-error"))}}}if(p){var C=e("#ur-input-type-membership-upgrade-path"),S=e(".urm-upgrade-path-type-container"),B=S.find('input[name="ur_membership_upgrade_type"]:checked').val();e(".ur-input-type-membership-upgrade-path .select2-selection--multiple").removeClass("ur-membership-error"),C.val().length<1&&(o=!1,i=!0,t.show_failure_message(r.labels.i18n_error+"! "+C.data("key-name")+" "+r.labels.i18n_field_is_required),e(".ur-input-type-membership-upgrade-path .select2-selection--multiple").addClass("ur-membership-error")),B===undefined&&(o=!1,i=!0,t.show_failure_message(r.labels.i18n_error+"! "+S.data("key-name")+" "+r.labels.i18n_field_is_required))}return o},create_membership:function(a){if(t.toggleSaveButtons(!0),t.append_spinner(a),this.validate_membership_form()){var n=this.prepare_membership_data();this.send_data({action:"user_registration_membership_create_membership",membership_data:JSON.stringify(n)},{success:function(s){s.success?(r.membership_id=s.data.membership_id,a.text(r.labels.i18n_save),t.show_success_message(s.data.message),e(location).attr("href",r.membership_page_url)):t.show_failure_message(s.data.message)},failure:function(e,a){t.show_failure_message(r.labels.network_error+"("+a+")")},complete:function(){t.remove_spinner(a),t.toggleSaveButtons(!1)}})}else s?e("#ur-basic-tab").trigger("click"):i&&e("#ur-advanced-tab").trigger("click"),t.remove_spinner(a),t.toggleSaveButtons(!1)},update_membership:function(a){if(t.toggleSaveButtons(!0),t.append_spinner(a),this.validate_membership_form()){var n=this.prepare_membership_data();this.send_data({action:"user_registration_membership_update_membership",membership_data:JSON.stringify(n),membership_id:r.membership_id},{success:function(e){e.success?t.show_success_message(e.data.message):t.show_failure_message(e.data.message)},failure:function(e,a){t.show_failure_message(r.labels.network_error+"("+a+")")},complete:function(){t.remove_spinner(a),t.toggleSaveButtons(!1)}})}else s?e("#ur-basic-tab").trigger("click"):i&&e("#ur-advanced-tab").trigger("click"),t.remove_spinner(a),t.toggleSaveButtons(!1)},update_membership_status:function(a){t.prepend_spinner(a.parents(".row-actions")),a.attr("disabled",!0);var s=a.prop("checked"),i=a.data("ur-membership-id");this.send_data({action:"user_registration_membership_update_membership_status",membership_data:JSON.stringify({status:s,ID:i})},{success:function(e){e.success?t.show_success_message(e.data.message):t.show_failure_message(e.data.message)},failure:function(e,a){t.show_failure_message(r.labels.network_error+"("+a+")")},complete:function(){t.remove_spinner(a.parents(".row-actions")),a.attr("disabled",!1);var r=s?"Active":"Inactive",n=e("#ur-membership-list-status-"+i);n.text(r),"Inactive"===r?(n.removeClass("user-registration-badge--success-subtle"),n.addClass("user-registration-badge--secondary-subtle")):(n.removeClass("user-registration-badge--secondary-subtle"),n.addClass("user-registration-badge--success-subtle"))}})},validate_payment_gateway:function(a){var s=a.closest(".ur-toggle-section "),i=a.attr("id").split("ur-membership-pg-")[1],n=e("input:radio[name=ur_membership_type]:checked").val();t.prepend_spinner(s),this.send_data({action:"user_registration_membership_validate_pg",pg:i,membership_type:n},{success:function(e){e.status?(a.prop("checked",!0),a.closest(".user-registration-switch").closest(".ur-payment-option-header").siblings(".payment-option-body").hide()):(t.show_failure_message(e.message),a.prop("checked",!1),a.closest(".user-registration-switch").closest(".ur-payment-option-header").siblings(".payment-option-body").show())},failure:function(e,a){t.show_failure_message(r.labels.network_error+"("+a+")")},complete:function(){t.remove_spinner(s),t.toggleSaveButtons(!1)}})},send_data:function(a,s){var i="function"==typeof s.success?s.success:function(){},t="function"==typeof s.failure?s.failure:function(){},n="function"==typeof s.beforeSend?s.beforeSend:function(){},p="function"==typeof s.complete?s.complete:function(){};!a._wpnonce&&r&&(a._wpnonce=r._nonce),e.ajax({type:"post",dataType:"json",url:r.ajax_url,data:a,beforeSend:n,success:i,error:t,complete:p})},remove_deleted_memberships:function(r,a){a?r.each(function(){e(this).parents("tr").remove()}):e(r).parents("tr").remove()}};e(document).on("click","input:radio[name=ur_membership_type]",function(){var r=e(this).val(),a=e("#paid-plan-container"),s=e(".ur-membership-subscription-field-container"),i=e("#payment-gateway-container"),t=e('label.ur-membership-upgrade-types[for="ur-membership-upgrade-type-pro-rata"]'),n=e("#ur-membership-duration"),p=e("#ur-membership-duration-container");a.addClass("ur-d-none"),i.addClass("ur-d-none"),t.addClass("ur-d-none"),n.addClass("ur-d-none"),p.removeClass("ur-d-flex"),p.addClass("ur-d-none"),s.show(),"free"!==r&&("paid"===r?s.hide():(s.removeClass("ur-d-none"),n.removeClass("ur-d-none"),p.addClass("ur-d-flex"),p.removeClass("ur-d-none")),t.removeClass("ur-d-none"),i.removeClass("ur-d-none"),a.removeClass("ur-d-none"))}),e(document).on("click","#ur-membership-upgrade-action",function(){e("#upgrade-settings-container").toggle(),e("input:radio[name=ur_membership_type]:checked").trigger("click")}),e(document).on("keydown",function(r){r.ctrlKey&&"s"===r.key&&(r.preventDefault(),e(".ur-membership-save-btn").trigger("click"))}),e(".ur-membership-save-btn").on("click",function(a){a.preventDefault(),a.stopPropagation();var s=e(this);e(this).find(".ur-spinner.is-active").length?t.show_failure_message(r.labels.i18n_previous_save_action_ongoing):r.membership_id&&""!==r.membership_id?n.update_membership(s):n.create_membership(s)}),e("#ur-membership-trial-status").on("click",function(){var r=e(this).prop("checked"),a=e(".trial-container");e(this).val("on"),r||e(this).val("off"),a.toggleClass("ur-d-none")}),e(".ur-membership-change-status").on("change",function(){n.update_membership_status(e(this))}),e(document).on("click",".ur-payment-option-header",function(){e(this).find("input").trigger("click")}),e(document).on("click",".pg-switch",function(r){r.stopImmediatePropagation(),e(this).is(":checked")&&e(this).closest(".user-registration-switch").find(".ur-spinner.is-active").length<1&&n.validate_payment_gateway(e(this))}),e(".delete-membership").on("click",function(a){a.preventDefault(),a.stopPropagation();var s=e(this),i=s.data("membership-id"),p=s.closest(".delete");p.find("span").hasClass("is-active")||(t.append_spinner(p),Swal.fire({title:'<img src="'+r.delete_icon+'" id="delete-user-icon">'+r.labels.i18n_prompt_title,html:'<p id="html_1">'+r.labels.i18n_prompt_single_subtitle+"</p>",showCancelButton:!0,confirmButtonText:r.labels.i18n_prompt_delete,cancelButtonText:r.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(e){e.isConfirmed?n.send_data({action:"user_registration_membership_delete_membership",membership_id:i},{success:function(e){e.success?(t.show_success_message(e.data.message),n.remove_deleted_memberships(s,!1)):Swal.fire({title:'<img src="'+r.delete_icon+'" id="delete-user-icon">'+r.labels.i18n_prompt_title,html:e.data.message,confirmButtonText:r.labels.i18n_prompt_ok,allowOutsideClick:!1})},failure:function(e,a){t.show_failure_message(r.labels.network_error+"("+a+")")},complete:function(){t.remove_spinner(s.closest(".delete"))}}):t.remove_spinner(s.closest(".delete"))}))}),e("#membership-list #doaction,#doaction2").on("click",function(r){r.preventDefault(),r.stopPropagation();var a=e("#membership-list");switch(a.find("select#bulk-action-selector-top option:selected").val()){case"delete":t.handle_bulk_delete_action(a)}});var p=e(".ur-page-title__wrapper--steps .ur-page-title__wrapper--steps-btn"),o=e(".user-registration-card--form-step");p.on("click",function(){!function(e){o.removeClass("user-registration-card--form-step-active"),p.removeClass("ur-page-title__wrapper--steps-btn-active"),o.eq(e).addClass("user-registration-card--form-step-active"),p.eq(e).addClass("ur-page-title__wrapper--steps-btn-active"),e}(e(this).data("step"))})}(jQuery,window.ur_membership_localized_data);