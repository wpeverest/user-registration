!function(e,r){e(document).on("ready",function(){var t={},n={append_spinner:function(e){if(e&&e.append){return e.append('<span class="urm-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".urm-spinner").remove(),!0)},convert_to_array:function(e){return Object.values(e).reverse().slice(2).reverse()},toggleSaveButtons:function(r,t){r=this.if_empty(r,!0),e(t).prop("disabled",!!r)},if_empty:function(e,r){return null===e||undefined===e||""===e?r:e},clear_validation_error:function(){e("span.notice_red").each(function(){e(this).text("")})},show_validation_error:function(r,t){r.removeClass("notice_blue").addClass("notice_red").text(t),this.clear_validation_error();r.siblings("input");e("html, body").animate({scrollTop:r.parent().offset().top},200),r.text(t)},toggleNotice:function(){e(".notice-container").toggleClass("active"),setTimeout(this.toggleNotice,5e3)},show_failure_message:function(r){e(".notice-container .notice_blue").removeClass("notice_blue").addClass("notice_red"),e(".notice_message").text(r),this.toggleNotice()},show_success_message:function(r){e(".notice-container .notice_red").removeClass("notice_red").addClass("notice_blue"),e(".notice_message").text(r),this.toggleNotice()},show_form_success_message:function(t,n){var s=t.data,o=user_registration_params.ursL10n,i=e("#user-registration-form-"+t.form_id),u=e('<ul class=""/>'),_=s.success_message_positon,m=r.thank_you_page_url;"undefined"!=typeof s.role_based_redirect_url&&(m=s.role_based_redirect_url),"undefined"!=typeof s.redirect_url&&(m=s.redirect_url),i.find(".ur-submit-button").find("span").removeClass("ur-front-spinner"),"admin_approval"==s.form_login_option?u.append("<li>"+o.user_under_approval+"</li>"):"email_confirmation"===s.form_login_option||"admin_approval_after_email_confirmation"===s.form_login_option?u.append("<li>"+o.user_email_pending+"</li>"):u.append("<li>"+o.user_successfully_saved+"</li>"),i.find("form")[0].reset();var c=e('<div class="ur-message user-registration-message" id="ur-submit-message-node"/>');c.append(u),"1"===_?(i.find("form").append(c),e(window).scrollTop(i.find("form").find(".ur-button-container").offset().top)):(i.find("form").prepend(c),e(window).scrollTop(i.find("form").closest(".ur-frontend-form").offset().top)),i.find("form").find(".ur-submit-button").prop("disabled",!1),void 0!==m&&""!==m?a.show_default_response(m,n):"undefined"!=typeof s.auto_login&&s.auto_login&&a.show_default_response(m,n)},isEventRegistered:function(r,t){var n=e._data(e(r)[0],"events");return n&&n[t]}},a={prepare_members_data:function(){var r={},t=e("#ur-membership-registration").find("input.ur_membership_input_class");(t=n.convert_to_array(t)).forEach(function(t){var n=e(t);if(n.attr("name")!==undefined){var a=n.attr("name").toLowerCase().replace("urm_","");r[a]=n.val()}});var a=e('input[name="urm_membership"]:checked');r.membership=a.val(),r.payment_method="free","free"!==a.data("urm-pg-type")&&(r.payment_method=e('input[name="urm_payment_method"]:checked').val());var s=new Date;return r.start_date=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate(),r},prepare_coupons_apply_data:function(){var r={};return r.coupon=e("#ur-membership-coupon").val(),r.membership_id=e('input[name="urm_membership"]:checked').val(),r},validate_membership_form:function(){var a=!0,s=e('input[name="urm_payment_method"]:visible');return s.length>0&&s.each(function(){if("stripe"===e(this).val()&&e(this).is(":checked")){if(e(".ur-frontend-form").find(".stripe-input-container .StripeElement--empty").length){a=!1;var n={error:{message:r.labels.i18n_empty_card_details}};t.card.emit("change",n)}}}),a&&n.clear_validation_error(),a},validate_coupon_data:function(){var t=e("#ur-membership-coupon").val(),a=e('input[name="urm_membership"]:checked'),s=e("#coupon-validation-error"),o=!0;return n.clear_validation_error(),t.length<1?(o=!1,n.show_validation_error(s,r.labels.i18n_error+"! "+r.labels.i18n_coupon_empty_error),o):0===a.length?(o=!1,n.show_validation_error(s,r.labels.i18n_error+"! "+r.labels.i18n_membership_required),o):"free"===a.data("urm-pg-type")?(o=!1,n.show_validation_error(s,r.labels.i18n_error+"! "+r.labels.i18n_coupon_free_membership_error),o):o},create_member:function(e){var t=this.prepare_members_data();t.username=e.data.username,this.send_data({action:"user_registration_membership_register_member",members_data:JSON.stringify(t),form_response:JSON.stringify(e.data)},{success:function(r){r.success?a.handle_response(r,t,e):n.show_failure_message(r.data.message)},failure:function(e,t){n.show_failure_message(r.labels.network_error+"("+t+")")},complete:function(){n.remove_spinner($this),n.toggleSaveButtons(!1,$this)}})},handle_response:function(e,r,t){switch(r.payment_method){case"paypal":n.show_success_message(e.data.message),window.location.replace(e.data.pg_data.payment_url);break;case"bank":this.show_bank_response(e,r,t);break;case"stripe":o.handle_stripe_response(e,r,t);break;case"authorize":n.show_success_message(e.data.message);break;case"mollie":n.show_success_message(e.data.message),window.location.replace(e.data.pg_data.payment_url);break;default:n.show_form_success_message(t,{username:r.username})}},show_bank_response:function(e,r,t){var a={transaction_id:e.data.transaction_id,payment_type:"unpaid",info:e.data.pg_data.data,username:r.username};n.show_form_success_message(t,a)},show_default_response:function(r,t){var n=e.param(t).toString();window.setTimeout(function(){window.location.replace(r+"?"+n)},1e3)},validate_coupon:function(t){n.toggleSaveButtons(!0,t),n.append_spinner(t),this.validate_coupon_data()?this.send_data({action:"user_registration_membership_validate_coupon",coupon_data:this.prepare_coupons_apply_data()},{success:function(e){e.success?a.handle_coupon_validation_response(e):n.show_failure_message(e.data.message)},failure:function(t,a){500===t.status?n.show_failure_message(r.labels.network_error+"("+a+")"):n.show_validation_error(e("#coupon-validation-error"),r.labels.i18n_error+"! "+t.responseJSON.data.message)},complete:function(){n.remove_spinner(t),n.toggleSaveButtons(!1,t)}}):(n.toggleSaveButtons(!1,t),n.remove_spinner(t))},handle_coupon_validation_response:function(t){e(".urm_apply_coupon").hide(),n.clear_validation_error(),e("#coupon-validation-error").removeClass("notice_red").addClass("notice_blue").text(t.data.message),t=JSON.parse(t.data.data);var s=e('input[name="urm_membership"]:checked'),o="";s.attr("data-ur-discount-amount",t.discount_amount),a.calculate_total(s),o="fixed"===t.coupon_details.coupon_discount_type?r.currency_symbol+""+t.coupon_details.coupon_discount:t.coupon_details.coupon_discount+"%",e("#total-input-notice").text(o+" "+r.labels.i18n_coupon_discount_message)},send_data:function(t,n){var a="function"==typeof n.success?n.success:function(){},s="function"==typeof n.failure?n.failure:function(){},o="function"==typeof n.beforeSend?n.beforeSend:function(){},i="function"==typeof n.complete?n.complete:function(){};!t._wpnonce&&r&&(t._wpnonce=r._nonce),e.ajax({type:"post",dataType:"json",url:r.ajax_url,data:t,beforeSend:o,success:a,error:s,complete:i})},calculate_total:function(t){var n=t.data("urm-pg-calculated-amount"),a=e("#ur-membership-total"),s=t.data("ur-discount-amount"),o=s!==undefined&&""!==s?n-s:n;a.val(r.currency_symbol+o)}},s=function(r){var t=e("#user-registration-form-"+r);t.find(".ur-submit-button").find("span").removeClass("ur-spinner"),t.find("form").find(".ur-submit-button").prop("disabled",!1)},o={show_stripe_error:function(e){if($membership_registration_form.find("#stripe-errors").length>0)$membership_registration_form.find("#stripe-errors").html(e).show();else{var r='<label id="stripe-errors" class="user-registration-error" role="alert">'+e+"</label>";$membership_registration_form.find(".stripe-container").closest(".ur_membership_frontend_input_container").append(r)}},init:function(){t=o.setupElements(),$membership_registration_form=e("#ur-membership-registration"),this.triggerInputChange()},triggerInputChange:function(){t.card.addEventListener("change",function(e){e.error?o.show_stripe_error(e.error.message):$membership_registration_form.find("#stripe-errors").length>0&&$membership_registration_form.find("#stripe-errors").remove()})},setupElements:function(){var e=Stripe(r.stripe_publishable_key),t=e.elements(),n={base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"14px","::placeholder":{color:"#8f9194"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},a=t.create("card",{style:n}),s=t.create("idealBank",{style:n});return a.mount("#card-element"),{stripe:e,card:a,ideal:s,clientSecret:""}},handle_stripe_response:function(e,r,n){"paid"===e.data.pg_data.type?this.handle_one_time_payment(e,r,n):this.handle_recurring_payment(e,{paymentElements:t,user_id:e.data.member_id,response_data:e,prepare_members_data:r,form_response:n})},handle_one_time_payment:function(r,a,s){t.stripe.confirmCardPayment(r.data.pg_data.client_secret,{payment_method:{card:t.card}}).then(function(t){var i=e(".membership_register_button");n.toggleSaveButtons(!0,i),n.append_spinner(i),o.update_order_status(t,r,a,s)})},update_order_status:function(t,i,u,_){a.send_data({_wpnonce:r._confirm_payment_nonce,action:"user_registration_membership_confirm_payment",members_data:JSON.stringify(u),member_id:i.data.member_id,payment_status:t.error?"failed":"succeeded",form_response:JSON.stringify(_.data),payment_result:t},{success:function(e){e.success?a.show_default_response(r.thank_you_page_url,{username:u.username,transaction_id:t.paymentIntent.id}):(o.show_stripe_error(e.data.message),s(_.form_id))},failure:function(e,t){n.show_failure_message(r.labels.network_error+"("+t+")")},complete:function(){var r=e(".membership_register_button");n.toggleSaveButtons(!1,r),n.remove_spinner(r)}})},handle_recurring_payment:function(r,t){Promise.resolve(e.extend({},t,{customer_id:r.data.pg_data.stripe_cus_id})).then(o.createPaymentMethod).then(o.createSubscription).then(o.handleCustomerActionRequired).then(o.handleOnComplete)["catch"](function(e,n){o.update_order_status({error:{}},r,t.prepare_members_data,t.form_response)})},createPaymentMethod:function(r){return new Promise(function(t,a){var s=e(".membership_register_button");n.toggleSaveButtons(!0,s),n.append_spinner(s),r.paymentElements.stripe.createPaymentMethod({type:"card",card:r.paymentElements.card}).then(function(n){n.error?a(n.error.message,n):t(e.extend({},r,{payment_method_id:n.paymentMethod.id}))})["catch"](function(e){a(e,result)})})},createSubscription:function(t){return new Promise(function(o,i){a.send_data({_wpnonce:r._confirm_payment_nonce,action:"user_registration_membership_create_stripe_subscription",member_id:t.user_id,customer_id:t.customer_id,payment_method_id:t.payment_method_id,form_response:JSON.stringify(t.form_response.data)},{success:function(r){if(r.success){var n=r.data.subscription.latest_invoice.payment_intent;if(r.error){var a=r.error.message;return void i(a,t)}if("trialing"!==r.data.subscription.status&&n&&"requires_payment_method"===n.status){i(r,a="Your card was declined")}o(e.extend({},t,{subscription:r.data.subscription,message:r.data.message}))}else s(t.form_id),i(r,a)},failure:function(e,t){n.show_failure_message(r.labels.network_error+"("+t+")")}})})},handleCustomerActionRequired:function(e){return new Promise(function(r,t){!e.subscription||"active"!==e.subscription.status&&"trialing"!==e.subscription.status||r({subscription:e.subscription,response_data:e.response_data,message:e.message,prepare_members_data:e.prepare_members_data,form_response:e.form_response});var n=e.subscription.latest_invoice.payment_intent;"trialing"!==e.subscription.status&&"requires_action"===n.status&&e.paymentElements.stripe.confirmCardPayment(n.client_secret,{payment_method:e.paymentMethodId}).then(function(n){if(n.error){var a=n.error.message;t(a,e)}else if("succeeded"===n.paymentIntent.status)e.subscription.status="active",r({subscription:e.subscription,form_id:e.form_id,response_data:e.response_data,form_response:e.form_response});else{t(a="Unable to complete the payment.",e)}})})},handleOnComplete:function(e){!e.subscription||"active"!==e.subscription.status&&"trialing"!==e.subscription.status||n.show_form_success_message(e.form_response,{username:e.prepare_members_data.username,transaction_id:e.subscription.id})}};e('input[name="urm_membership"]').on("change",function(){e("#total-input-notice").text("");var r=e(this).data("urm-pg"),t=e(this).data("urm-pg-type"),n=e(".ur_payment_gateway_container").find("input"),s=e(".urm_hidden_payment_container"),o=e(".stripe-container"),i=e("#stripe-errors"),u=e("#authorize-net-container");e("#authorize-errors").remove(),i.remove(),e('input[name="urm_payment_method"]').prop("checked",!1),o.addClass("urm-d-none"),u.addClass("urm-d-none"),s.addClass("urm-d-none"),e(".urm_apply_coupon").show(),"free"!==t&&(s.removeClass("urm-d-none"),n.each(function(t,n){var a=e(n).val(),s=e('label[for="ur-membership-'+a+'"]');s.removeClass("urm-d-none"),r.hasOwnProperty(a)||s.addClass("urm-d-none")}),a.calculate_total(e(this)))});new URLSearchParams(window.location.search).has("membership_id")&&e('input[name="urm_membership"]:checked').change(),e(".close_notice").on("click",n.toggleNotice),e("#ur-membership-password").on("keyup change",function(){var t=e(this).val(),a=e("#password-notice"),s=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!@#$%^&*()_+}{\"':;?/>.<,]).*$");if(n.show_validation_error(a,""),t.length<8)n.show_validation_error(a,r.labels.i18n_field_password_field_length_validation);else{if(s.test(t))return!0;n.show_validation_error(a,r.labels.i18n_field_password_field_regex_validation)}}),e("#ur-membership-confirm-password").on("keyup",function(){var t=e(this).val(),a=e("#ur-membership-password").val(),s=e("#confirm-password-notice");if(n.show_validation_error(s,""),0===a.length&&n.show_validation_error(s,r.labels.i18n_field_password_empty_validation),t===a)return!0;n.show_validation_error(s,r.labels.i18n_field_confirm_password_field_validation)}),e(document).on("click",".urm_apply_coupon",function(){a.validate_coupon(e(this))}),e(document).on("click",".ur_clear_coupon",function(){e("#ur-membership-coupon").val(""),e("#coupon-validation-error").text(""),e(".urm_apply_coupon").show(),e("#total-input-notice").text("");var r=e('input[name="urm_membership"]:checked');r.removeData("ur-discount-amount").removeAttr("data-ur-discount-amount"),a.calculate_total(r)}),e(document).on("click","#membership-old-selection-form .membership-signup-button",function(){var r=e(this),t=r.siblings('input[name="membership_id"]').val(),n=r.siblings('input[name="redirection_url"]').val(),a=r.siblings('input[name="thank_you_page_id"]').val(),s=n+"?membership_id="+t+"&urm_uuid="+r.siblings('input[name="urm_uuid"]').val()+"&thank_you="+a;window.location.replace(s)}),e(document).on("user_registration_frontend_validate_before_form_submit",function(){a.validate_membership_form()}),e(document).on("user_registration_frontend_before_form_submit",function(r,t,n,a){e(n).find("#ur-membership-registration").length>0&&(t.is_membership_active=e(n).find('input[name="urm_membership"]:checked').val(),t.membership_type=e('input[name="urm_membership"]:checked').val())}),e(document).on("user_registration_frontend_before_ajax_complete_success_message",function(r,t,n,s){var o=!0,i=JSON.parse(t.responseText),u={data:i.data,form_id:e(s).data("form-id")};"undefined"!=typeof i.data.registration_type&&"membership"===i.data.registration_type&&(o=!1,a.create_member(u)),n.status=o}),e('input[name="urm_payment_method"]').on("change",function(){var a=e(this).val(),s=e(".stripe-container"),i=e("#stripe-errors"),u=e("#authorize-net-container"),_=e("#authorize-errors");if(s.addClass("urm-d-none"),i.remove(),u.addClass("urm-d-none"),_.remove(),t={},"stripe"===a){if(0==r.stripe_publishable_key.length)return void n.show_failure_message(r.labels.i18n_incomplete_stripe_setup_error);s.removeClass("urm-d-none"),o.init()}"authorize"===a&&u.removeClass("urm-d-none")}),e(document).on("click",".cancel-membership-button",function(){var t=e(this),n=e("#membership-error-div"),a=t.text();Swal.fire({icon:"warning",title:r.labels.i18n_cancel_membership_text,text:r.labels.i18n_cancel_membership_subtitle,customClass:"user-registration-swal2-modal user-registration-swal2-modal--center",showConfirmButton:!0,showCancelButton:!0}).then(function(s){s.isConfirmed&&e.ajax({url:r.ajax_url,type:"POST",data:{action:"user_registration_membership_cancel_subscription",security:r._nonce,subscription_id:t.data("id")},beforeSend:function(){t.text(r.labels.i18n_sending_text)},success:function(e){e.success?(n.hasClass("btn-error")&&(n.removeClass("btn-error"),n.addClass("btn-success")),n.text(e.data.message),n.show(),location.reload()):(n.hasClass("btn-success")&&(n.removeClass("btn-success"),n.addClass("btn-error")),n.text(e.data.message),n.show())},complete:function(){t.text(a)}})})}),e(".field-membership").length&&e(".field-membership").each(function(r,t){if(e(t).find(".no-membership")){var n=e(t).find(".no-membership").attr("data-form-id");e("#user-registration-form-"+n).find(".ur-submit-button").prop("disabled",!0)}})})}(jQuery,window.ur_membership_frontend_localized_data);